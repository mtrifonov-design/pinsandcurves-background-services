'use strict';

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise, SuppressedError, Symbol, Iterator */


var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e;}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)};function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return {next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value);}catch(t){i={error:t};}finally{try{r&&!r.done&&(n=o.return)&&n.call(o);}finally{if(i)throw i.error}}return a}function o(t,e,n){if(2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;(function(){function t(){this._project={metaData:{name:"Empty Project",pinsAndCurvesVersion:"0.0.1"},orgData:{signalIds:[],signalIdByPinId:{},pinIds:[],signalNames:{},signalTypes:{},activeSignalIds:[]},timelineData:{numberOfFrames:100,framesPerSecond:30,playheadPosition:0,focusRange:[0,100],playing:false},signalData:{},templateData:{}};}return t.prototype.setName=function(t){this._project.metaData.name=t;},t.prototype.addStaticStringSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="discrete",this._project.signalData[t]={id:t,type:"discrete",pinIds:[],pinTimes:{},pinValues:{},defaultValue:n,isStatic:true};},t.prototype.addStaticNumberSignal=function(t,e,n,r){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",pinIds:[],pinTimes:{},pinValues:{},defaultValue:r,isStatic:true,range:n,defaultCurve:"return easyLinear();",curves:{}};},t.prototype.addDiscreteSignal=function(t,e){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="discrete",this._project.signalData[t]={id:t,type:"discrete",pinIds:[],pinTimes:{},pinValues:{},defaultValue:"default value",displayValues:true};},t.prototype.addContinuousSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",range:n,pinIds:[],pinTimes:{},pinValues:{},curves:{},defaultCurve:"return easyLinear();",defaultValue:n[0]};},t.prototype.addContinuousBezierSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",range:n,pinIds:[],pinTimes:{},pinValues:{},curves:{},defaultCurve:"return bezier();",defaultValue:n[0],bezierControlPoints:{},bezier:true};},t.prototype.addPin=function(t,e,n,r){var i=this._project.signalData[t],o=Math.random().toString(36).substring(7);if(this._project.orgData.pinIds.push(o),this._project.orgData.signalIdByPinId[o]=t,"continuous"===i.type){if(i.pinIds.push(o),i.pinTimes[o]=e,"number"!=typeof n)throw new Error("Continuous signal pin value must be a number");if(i.pinValues[o]=n,r)i.curves[o]=r;else {var a=i.defaultCurve;i.curves[o]=a;}if("bezier"in i){this._project.timelineData.numberOfFrames;i.bezierControlPoints[o]=[-5,0,5,0];}}if("discrete"===i.type){if(i.pinIds.push(o),i.pinTimes[o]=e,"string"!=typeof n)throw new Error("Discrete signal pin value must be a string");i.pinValues[o]=n;}},t.prototype.setTimelineData=function(t,e,r){this._project.timelineData=n(n({},this._project.timelineData),{numberOfFrames:t,framesPerSecond:e,playheadPosition:r});},t.prototype.setSignalActiveStatus=function(t,e){e?this._project.orgData.activeSignalIds.push(t):this._project.orgData.activeSignalIds=this._project.orgData.activeSignalIds.filter((function(e){return e!==t}));},t.prototype.getProject=function(){return this._project},t.prototype.addCurveTemplate=function(t,e){this._project.templateData[t]=e;},t})();var s=function(){function t(t,e,n){if(void 0===n&&(n=1e4),this.content=t,this.__transformer=e,"number"==typeof n){if(n<1)throw new Error("Max size must be greater than 0");this.__internal={namedStates:{},states:{initial:{forward:[],backward:[],nextState:void 0,previousState:void 0}},cursor:"initial",maxSize:n};}else this.__internal=n;this.__MAX_ITERATIONS=this.__internal.maxSize+1;}return t.deserialize=function(e,n){var r=JSON.parse(e);return new t(r.content,n,r.__internal)},t.prototype.serialize=function(){return JSON.stringify({content:this.content,__internal:this.__internal})},t.prototype.next=function(){var t=this.__internal.states[this.__internal.cursor].nextState;if(!t)return {success:false,message:"No next state"};var e=this.__internal.cursor,n=this.__internal.states[e].forward;return this.__internal.cursor=t,this.content=this.__transformer(this.content,n),{success:true,message:"Next state reached"}},t.prototype.previous=function(){var t=this.__internal.states[this.__internal.cursor].previousState;if(!t)return {success:false,message:"No previous state"};var e=this.__internal.cursor,n=this.__internal.states[e].backward;return this.__internal.cursor=t,this.content=this.__transformer(this.content,n),{success:true,message:"Previous state reached"}},t.prototype.goToNamedState=function(t){var e=this.__internal.namedStates[t];if(!e)return {success:false,message:"Named state not found"};if(!this.__internal.states[e])throw new Error("Named state has no corresponding state");var n=this.__internal.cursor;if(e===n)return {success:true,message:"Already at named state"};for(var r="forward",i=n,o=0;i&&o<this.__MAX_ITERATIONS;)o++,i===e&&(r="backward"),i=this.__internal.states[i].previousState;if("forward"===r)for(o=0;this.__internal.cursor!==e&&o<this.__MAX_ITERATIONS;){if(o++,!(a=this.next()).success)throw new Error(a.message)}else for(o=0;this.__internal.cursor!==e&&o<this.__MAX_ITERATIONS;){var a;if(o++,!(a=this.previous()).success)throw new Error(a.message)}return {success:true,message:"Moved to named state"}},t.prototype.saveAsNamedState=function(t){this.__internal.namedStates[t]=this.__internal.cursor;},t.prototype.appendToCurrentState=function(t,e){this.content=this.__transformer(this.content,t);var n=this.__internal.cursor,r=this.__internal.states[n].forward,i=this.__internal.states[n].backward;this.__internal.states[n].forward=r.concat(t),this.__internal.states[n].backward=e.concat(i);},t.prototype.addNextState=function(t,e){for(var n=this,r=[],i=a=this.__internal.cursor,o=0;i&&o<this.__MAX_ITERATIONS;)o++,(i=this.__internal.states[i].nextState)&&r.push(i);r.forEach((function(t){delete n.__internal.states[t];}));var a=this.__internal.cursor,u="state".concat(function(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<10;n++)t+=e.charAt(Math.floor(52*Math.random()));return t}());this.__internal.states[u]={forward:t,backward:e,nextState:void 0,previousState:a},this.__internal.states[a].nextState=u,this.__internal.cursor=u,this.content=this.__transformer(this.content,t);var s=1,c=(i=a=this.__internal.cursor,[a]);for(o=0;i&&s<this.__internal.maxSize&&o<this.__MAX_ITERATIONS;)o++,(i=this.__internal.states[i].previousState)&&c.push(i),s++;var f=Object.keys(this.__internal.states).filter((function(t){return !c.includes(t)}));f.forEach((function(t){delete n.__internal.states[t];})),c.forEach((function(t,e){var r=n.__internal.states[t].previousState,i=n.__internal.states[t].nextState;r&&!n.__internal.states[r]&&(n.__internal.states[t].previousState=void 0),i&&!n.__internal.states[i]&&(n.__internal.states[t].nextState=void 0);})),Object.keys(this.__internal.namedStates).forEach((function(t){var e=n.__internal.namedStates[t];if(!e)throw new Error("Named state has no corresponding state");n.__internal.states[e]||delete n.__internal.namedStates[t];}));},t.prototype.executeCommand=function(t){switch(t.type){case "next":this.next();break;case "previous":this.previous();break;case "goToNamedState":this.goToNamedState(t.namedState);break;case "saveAsNamedState":this.saveAsNamedState(t.namedState);break;case "addNextState":this.addNextState(t.forward,t.backward);break;case "appendToCurrentState":this.appendToCurrentState(t.forward,t.backward);break;default:throw new Error("Invalid command")}},t.prototype.executeCommands=function(t){var e=this;t.forEach((function(t){return e.executeCommand(t)}));},t}(),f=function(){function t(t){this.subscribers=[],this.update=[],this.dispatch=t,this.authorId="a".concat(d());}return t.prototype.subscribeToProjectUpdates=function(t){var e=this;if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");return this.subscribers.push(t),function(){e.subscribers=e.subscribers.filter((function(e){return e!==t}));}},t.prototype.getProject=function(){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");return this.worm.content},t.prototype.pushCommand=function(t){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");try{var e=t();this.worm.executeCommand(e),this.update.push(e);}catch(t){console.error(t);}},t.prototype.pushCommands=function(t){var e;if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");try{var n=t();this.worm.executeCommands(n),(e=this.update).push.apply(e,o([],i(n),!1));}catch(t){console.error(t);}},t.prototype.pushUpdate=function(){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");var t=this.update;this.update=[];var e=this.projectStateId;this.projectStateId="ps".concat(d()),this.subscribers.forEach((function(t){return t()})),this.dispatch({authorId:this.authorId,authorIsHost:this.host,type:"pushUpdate",instructions:t,lastAgreedProjectStateId:e,newProjectStateId:this.projectStateId});},t.prototype.processUpdate=function(t){if(this.worm&&this.projectStateId){var e=t.lastAgreedProjectStateId,n=t.newProjectStateId;(this.host?e===this.projectStateId&&false===t.authorIsHost&&0===this.update.length:e===this.projectStateId)?(this.update=[],this.worm.executeCommands(t.instructions),this.projectStateId=n,this.subscribers.forEach((function(t){return t()}))):this.host||this.dispatch({authorId:this.authorId,authorIsHost:false,type:"requestProject"});}},t}(),l=function(t){function n(e,n){var r=t.call(this,e.dispatch)||this;return r.host=true,r.worm=n,r.projectStateId="ps".concat(d()),r.dispatch({authorId:r.authorId,authorIsHost:true,type:"hostIsConnected"}),r}return e(n,t),Object.defineProperty(n.prototype,"initialized",{get:function(){return  true},enumerable:false,configurable:true}),n.fromProject=function(t,e){return new n(t,new s(e,t.projectTransformer))},n.fromSerializedWorm=function(t,e){return new n(t,s.deserialize(e,t.projectTransformer))},n.prototype.receive=function(t){if(t.authorId!==this.authorId)switch(t.type){case "requestProject":this.pushProject(t.requestId);break;case "hostIsConnected":case "pushProject":break;case "pushUpdate":this.processUpdate(t);break;default:throw new Error("Invalid event type")}},n.prototype.pushProject=function(t){this.dispatch({authorId:this.authorId,authorIsHost:true,type:"pushProject",serializedWorm:this.worm.serialize(),initialProjectStateId:this.projectStateId,requestId:t});},n}(f),p=function(t){function n(e){var n=t.call(this,e.dispatch)||this;return n.host=false,n.projectRequestCallbacks={},n.__projectTransformer=e.projectTransformer,n}return e(n,t),Object.defineProperty(n.prototype,"initialized",{get:function(){return void 0!==this.worm&&void 0!==this.projectStateId},enumerable:false,configurable:true}),n.prototype.receive=function(t){if(t.authorId!==this.authorId)switch(t.type){case "requestProject":break;case "hostIsConnected":this.requestProject();break;case "pushProject":this.worm=s.deserialize(t.serializedWorm,this.__projectTransformer),this.projectStateId=t.initialProjectStateId,t.requestId&&this.projectRequestCallbacks[t.requestId]&&(this.projectRequestCallbacks[t.requestId](),delete this.projectRequestCallbacks[t.requestId]),this.subscribers.forEach((function(t){return t()}));break;case "pushUpdate":this.processUpdate(t);break;default:throw new Error("Invalid event type")}},n.prototype.requestProject=function(t){var e;t&&(e="r".concat(d()),this.projectRequestCallbacks[e]=t),this.dispatch({authorId:this.authorId,authorIsHost:false,type:"requestProject",requestId:e});},n}(f),d=function(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<10;n++)t+=e.charAt(Math.floor(52*Math.random()));return t},v=Symbol.for("immer-nothing"),g=Symbol.for("immer-draftable"),y=Symbol.for("immer-state");function m(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var w=Object.getPrototypeOf;function b(t){return !!t&&!!t[y]}function S(t){return !!t&&(P(t)||Array.isArray(t)||!!t[g]||!!t.constructor?.[g]||N(t)||O(t))}var I=Object.prototype.constructor.toString();function P(t){if(!t||"object"!=typeof t)return  false;const e=w(t);if(null===e)return  true;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===I}function x(t,e){0===j(t)?Reflect.ownKeys(t).forEach((n=>{e(n,t[n],t);})):t.forEach(((n,r)=>e(r,n,t)));}function j(t){const e=t[y];return e?e.type_:Array.isArray(t)?1:N(t)?2:O(t)?3:0}function D(t,e){return 2===j(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function E(t,e,n){const r=j(t);2===r?t.set(e,n):3===r?t.add(n):t[e]=n;}function N(t){return t instanceof Map}function O(t){return t instanceof Set}function C(t){return t.copy_||t.base_}function T(t,e){if(N(t))return new Map(t);if(O(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=P(t);if(true===e||"class_only"===e&&!n){const e=Object.getOwnPropertyDescriptors(t);delete e[y];let n=Reflect.ownKeys(e);for(let r=0;r<n.length;r++){const i=n[r],o=e[i];false===o.writable&&(o.writable=true,o.configurable=true),(o.get||o.set)&&(e[i]={configurable:true,writable:true,enumerable:o.enumerable,value:t[i]});}return Object.create(w(t),e)}{const e=w(t);if(null!==e&&n)return {...t};const r=Object.create(e);return Object.assign(r,t)}}function U(t,e=false){return A(t)||b(t)||!S(t)||(j(t)>1&&(t.set=t.add=t.clear=t.delete=z),Object.freeze(t),e&&Object.entries(t).forEach((([t,e])=>U(e,true)))),t}function z(){m(2);}function A(t){return Object.isFrozen(t)}var k,M={};function R(t){const e=M[t];return e||m(0,t),e}function V(){return k}function B(t,e){e&&(R("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e);}function F(t){W(t),t.drafts_.forEach(q),t.drafts_=null;}function W(t){t===k&&(k=t.parent_);}function L(t){return k={drafts_:[],parent_:k,immer_:t,canAutoFreeze_:true,unfinalizedDrafts_:0}}function q(t){const e=t[y];0===e.type_||1===e.type_?e.revoke_():e.revoked_=true;}function H(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return void 0!==t&&t!==n?(n[y].modified_&&(F(e),m(4)),S(t)&&(t=$(e,t),e.parent_||G(e,t)),e.patches_&&R("Patches").generateReplacementPatches_(n[y].base_,t,e.patches_,e.inversePatches_)):t=$(e,n,[]),F(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==v?t:void 0}function $(t,e,n){if(A(e))return e;const r=e[y];if(!r)return x(e,((i,o)=>K(t,r,e,i,o,n))),e;if(r.scope_!==t)return e;if(!r.modified_)return G(t,r.base_,true),r.base_;if(!r.finalized_){r.finalized_=true,r.scope_.unfinalizedDrafts_--;const e=r.copy_;let i=e,o=false;3===r.type_&&(i=new Set(e),e.clear(),o=true),x(i,((i,a)=>K(t,r,e,i,a,n,o))),G(t,e,false),n&&t.patches_&&R("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_);}return r.copy_}function K(t,e,n,r,i,o,a){if(b(i)){const a=$(t,i,o&&e&&3!==e.type_&&!D(e.assigned_,r)?o.concat(r):void 0);if(E(n,r,a),!b(a))return;t.canAutoFreeze_=false;}else a&&n.add(i);if(S(i)&&!A(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;$(t,i),e&&e.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||G(t,i);}}function G(t,e,n=false){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&U(e,n);}var X={get(t,e){if(e===y)return t;const n=C(t);if(!D(n,e))return function(t,e,n){const r=Y(e,n);return r?"value"in r?r.value:r.get?.call(t.draft_):void 0}(t,n,e);const r=n[e];return t.finalized_||!S(r)?r:r===Z(t.base_,e)?(tt(t),t.copy_[e]=et(r,t)):r},has:(t,e)=>e in C(t),ownKeys:t=>Reflect.ownKeys(C(t)),set(t,e,n){const r=Y(C(t),e);if(r?.set)return r.set.call(t.draft_,n),true;if(!t.modified_){const r=Z(C(t),e),a=r?.[y];if(a&&a.base_===n)return t.copy_[e]=n,t.assigned_[e]=false,true;if(((i=n)===(o=r)?0!==i||1/i==1/o:i!=i&&o!=o)&&(void 0!==n||D(t.base_,e)))return  true;tt(t),Q(t);}var i,o;return t.copy_[e]===n&&(void 0!==n||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=true),true},deleteProperty:(t,e)=>(void 0!==Z(t.base_,e)||e in t.base_?(t.assigned_[e]=false,tt(t),Q(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],true),getOwnPropertyDescriptor(t,e){const n=C(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r?{writable:true,configurable:1!==t.type_||"length"!==e,enumerable:r.enumerable,value:n[e]}:r},defineProperty(){m(11);},getPrototypeOf:t=>w(t.base_),setPrototypeOf(){m(12);}},J={};function Z(t,e){const n=t[y];return (n?C(n):t)[e]}function Y(t,e){if(!(e in t))return;let n=w(t);for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=w(n);}}function Q(t){t.modified_||(t.modified_=true,t.parent_&&Q(t.parent_));}function tt(t){t.copy_||(t.copy_=T(t.base_,t.scope_.immer_.useStrictShallowCopy_));}x(X,((t,e)=>{J[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)};})),J.deleteProperty=function(t,e){return J.set.call(this,t,e,void 0)},J.set=function(t,e,n){return X.set.call(this,t[0],e,n,t[0])};function et(t,e){const n=N(t)?R("MapSet").proxyMap_(t,e):O(t)?R("MapSet").proxySet_(t,e):function(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:V(),modified_:false,finalized_:false,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:false};let i=r,o=X;n&&(i=[r],o=J);const{revoke:a,proxy:u}=Proxy.revocable(i,o);return r.draft_=u,r.revoke_=a,u}(t,e);return (e?e.scope_:V()).drafts_.push(n),n}function nt(t){if(!S(t)||A(t))return t;const e=t[y];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=true,n=T(t,e.scope_.immer_.useStrictShallowCopy_);}else n=T(t,true);return x(n,((t,e)=>{E(n,t,nt(e));})),e&&(e.finalized_=false),n}var rt=new class{constructor(t){this.autoFreeze_=true,this.useStrictShallowCopy_=false,this.produce=(t,e,n)=>{if("function"==typeof t&&"function"!=typeof e){const n=e;e=t;const r=this;return function(t=n,...i){return r.produce(t,(t=>e.call(this,t,...i)))}}let r;if("function"!=typeof e&&m(6),void 0!==n&&"function"!=typeof n&&m(7),S(t)){const i=L(this),o=et(t,void 0);let a=true;try{r=e(o),a=!1;}finally{a?F(i):W(i);}return B(i,n),H(r,i)}if(!t||"object"!=typeof t){if(r=e(t),void 0===r&&(r=t),r===v&&(r=void 0),this.autoFreeze_&&U(r,true),n){const e=[],i=[];R("Patches").generateReplacementPatches_(t,r,e,i),n(e,i);}return r}m(1,t);},this.produceWithPatches=(t,e)=>{if("function"==typeof t)return (e,...n)=>this.produceWithPatches(e,(e=>t(e,...n)));let n,r;return [this.produce(t,e,((t,e)=>{n=t,r=e;})),n,r]},"boolean"==typeof t?.autoFreeze&&this.setAutoFreeze(t.autoFreeze),"boolean"==typeof t?.useStrictShallowCopy&&this.setUseStrictShallowCopy(t.useStrictShallowCopy);}createDraft(t){S(t)||m(8),b(t)&&(t=function(t){b(t)||m(10,t);return nt(t)}(t));const e=L(this),n=et(t,void 0);return n[y].isManual_=true,W(e),n}finishDraft(t,e){const n=t&&t[y];n&&n.isManual_||m(9);const{scope_:r}=n;return B(r,e),H(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t;}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t;}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const r=e[n];if(0===r.path.length&&"replace"===r.op){t=r.value;break}}n>-1&&(e=e.slice(n+1));const r=R("Patches").applyPatches_;return b(t)?r(t,e):this.produce(t,(t=>r(t,e)))}},it=rt.produce;function ot(t,e){var n=e.pinId,r=false;for(var i in t.signalData){var o=t.signalData[i],a=o.pinIds.indexOf(n);if(-1!==a){o.pinIds.splice(a,1),delete o.pinTimes[n],delete o.pinValues[n],"continuous"===o.type&&(delete o.curves[n],"bezier"in o&&delete o.bezierControlPoints[n]),r=true;break}}if(!r)throw new Error("Pin with id ".concat(n," not found"));t.orgData.pinIds=t.orgData.pinIds.filter((function(t){return t!==n})),delete t.orgData.signalIdByPinId[n];}rt.produceWithPatches.bind(rt),rt.setAutoFreeze.bind(rt),rt.setUseStrictShallowCopy.bind(rt),rt.applyPatches.bind(rt),rt.createDraft.bind(rt),rt.finishDraft.bind(rt);var at={addPin:function(t,e){var n=e.signalId,r=e.pinId,o=e.pinTime,a=e.pinValue,u=e.functionString,s=e.bezierControlPoints,c=t.signalData[n];if(!c)throw new Error("Signal with id ".concat(n," not found"));var f=c.type;if("continuous"===f&&"number"!=typeof a)throw new Error("Pin value must be a number for continuous signals");if("discrete"===f&&"string"!=typeof a)throw new Error("Pin value must be a string for discrete signals");for(var l in t.signalData){if(t.signalData[l].pinIds.includes(r))throw new Error("Pin with id ".concat(r," already exists"))}if(Object.values(c.pinTimes).includes(o))throw new Error("Pin time must be unique within the signal");var p=t.timelineData.numberOfFrames;if(o<0||o>p)throw new Error("Pin time must be between 0 and ".concat(p));if("continuous"===f){var d=i(c.range,2),h=d[0],v=d[1];if(a<h||a>v)throw new Error("Pin value must be between ".concat(h," and ").concat(v));if(!u)throw new Error("Curve is required for continuous signals");if("bezier"in c){if(!c.bezierControlPoints)throw new Error("Bezier control points are required for continuous bezier signals");if(!s)throw new Error("Bezier control points are required for continuous bezier signals");c.bezierControlPoints[r]=s;}}var g=c.pinIds;if(0===g.length)c.pinIds.push(r);else {var y=g.findIndex((function(t){return c.pinTimes[t]>=o}));-1===y&&(y=g.length),c.pinIds.splice(y,0,r);}c.pinTimes[r]=o,c.pinValues[r]=a,"continuous"===f&&(c.curves[r]=u),t.orgData.pinIds.push(r),t.orgData.signalIdByPinId[r]=n;},deletePin:ot,updatePinTime:function(t,e){var n=e.pinId,r=e.pinTime,i=t.timelineData.numberOfFrames;if(r<0||r>i)throw new Error("Pin time must be between 0 and ".concat(i));var o=false,a=function(e){var i=t.signalData[e];if(i.pinIds.includes(n)){i.pinTimes[n]=r;var a=i.pinIds,u=a.indexOf(n);a.splice(u,1);var s=a.findIndex((function(t){return i.pinTimes[t]>=r}));return  -1===s&&(s=a.length),a.splice(s,0,n),o=true,"break"}};for(var u in t.signalData){if("break"===a(u))break}if(!o)throw new Error("Pin with id ".concat(n," not found"))},updatePinValue:function(t,e){var n=e.pinId,r=e.pinValue,o=false;for(var a in t.signalData){var u=t.signalData[a];if(u.pinIds.includes(n)){if("continuous"===u.type&&"number"!=typeof r)throw new Error("Pin value must be a number for continuous signals");if("discrete"===u.type&&"string"!=typeof r)throw new Error("Pin value must be a string for discrete signals");if("continuous"===u.type){var s=i(u.range,2),c=s[0],f=s[1];if(r<c||r>f)throw new Error("Pin value must be between ".concat(c," and ").concat(f))}u.pinValues[n]=r,o=true;break}}if(!o)throw new Error("Pin with id ".concat(n," not found"))},updatePins:function(t,e){var n,o,a=e.pins,u=function(e){var n=e.pinId,r=e.pinTime,o=e.pinValue,a=e.functionString,u=t.orgData.signalIdByPinId[n];if(!u)throw new Error("Pin with id ".concat(n," not found"));var s=t.signalData[u];if("continuous"===s.type&&"number"!=typeof o)throw new Error("Pin value must be a number for continuous signals");if("discrete"===s.type&&"string"!=typeof o)throw new Error("Pin value must be a string for discrete signals");if("continuous"===s.type){var c=i(s.range,2),f=c[0],l=c[1];if(o<f||o>l)throw new Error("Pin value must be between ".concat(f," and ").concat(l));if(!a)throw new Error("Curve is required for continuous signals")}s.pinTimes[n]=r,s.pinValues[n]=o;var p=s.pinIds,d=p.indexOf(n);p.splice(d,1);var h=p.findIndex((function(t){return s.pinTimes[t]>=r}));-1===h&&(h=p.length),p.splice(h,0,n),"continuous"===s.type&&(s.curves[n]=a);};try{for(var s=r(a),c=s.next();!c.done;c=s.next()){u(c.value);}}catch(t){n={error:t};}finally{try{c&&!c.done&&(o=s.return)&&o.call(s);}finally{if(n)throw n.error}}},updateCurve:function(t,e){var n=e.pinId,r=e.functionString,i=false;for(var o in t.signalData){var a=t.signalData[o];if("discrete"!==a.type&&a.pinIds.includes(n)){a.curves[n]=r,i=true;break}}if(!i)throw new Error("Pin with id ".concat(n," not found"))},createSignal:function(t,e){var n,r=e.signalId,o=e.signalType,a=e.signalName,u=e.range,s=e.defaultValue,c=e.displayValues,f=e.isStatic,l=e.bezier,p=e.defaultCurve;if(t.signalData[r])throw new Error("Signal with id ".concat(r," already exists"));if("continuous"!==o&&"discrete"!==o)throw new Error("Signal type must be continuous or discrete");if("continuous"===o){if(!u)throw new Error("Range is required for continuous signals");var d=i(u,2);if(d[0]>=d[1])throw new Error("Min value must be less than max value");if("number"!=typeof s)throw new Error("Default value must be a number for continuous signals");if(!p)throw new Error("Default curve is required for continuous signals");n=l?{id:r,type:o,range:u,defaultValue:s,isStatic:f,bezier:true,bezierControlPoints:{},defaultCurve:p,pinIds:[],pinTimes:{},pinValues:{},curves:{}}:{id:r,type:o,range:u,defaultValue:s,isStatic:f,defaultCurve:p,pinIds:[],pinTimes:{},pinValues:{},curves:{}};}if("discrete"===o){if("string"!=typeof s)throw new Error("Default value must be a string for discrete signals");n={id:r,type:o,pinIds:[],defaultValue:s,displayValues:c,isStatic:f,pinTimes:{},pinValues:{}};}t.signalData[r]=n,t.orgData.signalIds.push(r),t.orgData.signalNames[r]=a,t.orgData.signalTypes[r]=o,t.orgData.activeSignalIds.push(r);},deleteSignal:function(t,e){var n=e.signalId;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var r=t.signalData[n].pinIds;r.forEach((function(e){return delete t.orgData.signalIdByPinId[e]})),r.forEach((function(e){return t.orgData.pinIds=t.orgData.pinIds.filter((function(t){return t!==e}))})),delete t.signalData[n],t.orgData.signalIds=t.orgData.signalIds.filter((function(t){return t!==n})),delete t.orgData.signalNames[n],t.orgData.activeSignalIds=t.orgData.activeSignalIds.filter((function(t){return t!==n})),delete t.orgData.signalTypes[n];},updateSignalName:function(t,e){var n=e.signalId,r=e.signalName;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));t.orgData.signalNames[n]=r;},updateSignalRange:function(t,e){var n=e.signalId,r=e.range;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));if("continuous"!==t.signalData[n].type)throw new Error("Range can only be updated for continuous signals");var o=i(r,2);if(o[0]>=o[1])throw new Error("Min value must be less than max value");t.signalData[n].range=r;},updateSignalIndex:function(t,e){var n=e.signalId,r=e.index,i=t.orgData.signalIds,o=i.indexOf(n);if(-1===o)throw new Error("Signal with id ".concat(n," not found"));i.splice(o,1),i.splice(r,0,n);},updateSignalActiveStatus:function(t,e){var n=e.signalId,r=e.active;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var i=t.orgData.activeSignalIds,o=i.indexOf(n);r&&-1===o&&i.push(n),r||-1===o||i.splice(o,1);},updateFramesPerSecond:function(t,e){var n=e.framesPerSecond;if(n<=0)throw new Error("Frames per second must be greater than 0");t.timelineData.framesPerSecond=n;},updatePlayheadPosition:function(t,e){var n=e.playheadPosition;if(n<0||n>t.timelineData.numberOfFrames)throw new Error("Playhead position must be between 0 and ".concat(t.timelineData.numberOfFrames));t.timelineData.playheadPosition=n;},updateNumberOfFrames:function(t,e){var n,i,o=e.numberOfFrames;if(o<=0)throw new Error("Number of frames must be greater than 0");for(var a in t.timelineData.numberOfFrames=o,t.signalData){var u=t.signalData[a];try{for(var s=(n=void 0,r(u.pinIds)),c=s.next();!c.done;c=s.next()){var f=c.value;u.pinTimes[f]>o&&ot(t,{type:"deletePin",pinId:f});}}catch(t){n={error:t};}finally{try{c&&!c.done&&(i=s.return)&&i.call(s);}finally{if(n)throw n.error}}}},updateProjectName:function(t,e){var n=e.projectName;t.metaData.name=n;},updateFocusRange:function(t,e){var n=e.focusRange,r=i(n,2),o=r[0],a=r[1];if(o<0||a>t.timelineData.numberOfFrames||o>=a)throw new Error("Invalid focus range");t.timelineData.focusRange=n;},updateCurveTemplate:function(t,e){var n=e.curveId,r=e.functionString;if(!t.templateData[n])throw new Error("Curve template with id ".concat(n," not found"));t.templateData[n]=r;},addCurveTemplate:function(t,e){var n=e.curveId,r=e.functionString;if(t.templateData[n])throw new Error("Curve template with id ".concat(n," already exists"));t.templateData[n]=r;},deleteCurveTemplate:function(t,e){var n=e.curveId;if(!t.templateData[n])throw new Error("Curve template with id ".concat(n," not found"));delete t.templateData[n];},updatePinBezierControlPoints:function(t,e){var n=e.pinId,r=e.bezierControlPoints,i=t.orgData.signalIdByPinId[n];if(!i)throw new Error("Pin with id ".concat(n," not found"));t.signalData[i].bezierControlPoints[n]=r;},updateSignalDefaultValue:function(t,e){var n=e.signalId,r=e.defaultValue;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var i=t.signalData[n];if("continuous"===i.type&&"number"!=typeof r)throw new Error("Default value must be a number for continuous signals");if("discrete"===i.type&&"string"!=typeof r)throw new Error("Default value must be a string for discrete signals");i.defaultValue=r;},updateSignalDefaultCurve:function(t,e){var n=e.signalId,r=e.defaultCurve;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));t.signalData[n].defaultCurve=r;},updatePlaying:function(t,e){var n=e.playing;t.timelineData.playing=n;}};function ut(t,e){return it(t,(function(t){for(var n=0;n<e.length;n++){var r=e[n];(0, at[r.type])(t,r);}}))}function ct(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}var ft={type:"saveAsNamedState",namedState:"commit"},lt={type:"goToNamedState",namedState:"commit"};function pt(t,e,n,r,i,o,a){if(o&&!a){t.timelineData.numberOfFrames;a=[-5,0,5,0];}return {type:"addPin",signalId:e,pinId:n,pinTime:r,pinValue:i,functionString:o,bezierControlPoints:a}}function dt(t,e){var n=t(),r=Object.keys(n.signalData).find((function(t){var r;return null===(r=n.signalData[t])||void 0===r?void 0:r.pinIds.includes(e)}));if(!r)throw new Error("Pin not found");var i=n.signalData[r].type,o="continuous"===i&&"bezier"in n.signalData[r],a=n.signalData[r].pinTimes[e],u=n.signalData[r].pinValues[e],s="continuous"===i?n.signalData[r].curves[e]:void 0,c=o?n.signalData[r].bezierControlPoints[e]:void 0;return {type:"addNextState",forward:[{type:"deletePin",pinId:e}],backward:[pt(n,r,e,a,u,s,c)]}}var ht=l,vt=p,gt=ut,yt=function(){function t(t,e,n,r){if(e){if(!n&&!r)throw new Error("Project or worm must be provided to host project controller");var i=void 0;if(n&&(i=ht.fromProject({dispatch:t,projectTransformer:gt},n)).worm.saveAsNamedState("commit"),r&&(i=ht.fromSerializedWorm({dispatch:t,projectTransformer:gt},r)),!i)throw new Error("Project node not created");this.projectNode=i,this.connectToHost=function(){throw new Error("Host project controller cannot connect to host")};}else {this.projectNode=new vt({dispatch:t,projectTransformer:gt});var o=this.projectNode.requestProject.bind(this.projectNode);this.connectToHost=o;}}return t.Host=function(e,n){return new t(e,true,n)},t.HostFromProject=function(e,n){return new t(e,true,n)},t.prototype.serializeWorm=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");if(!this.projectNode.worm)throw new Error("Project node worm not found");return this.projectNode.worm.serialize()},t.HostFromSerializedWorm=function(e,n){return new t(e,true,void 0,n)},t.Client=function(e){return new t(e,false,void 0)},t.prototype.receive=function(t){this.projectNode.receive(t);},Object.defineProperty(t.prototype,"projectTools",{get:function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");var t=this.projectNode.pushUpdate.bind(this.projectNode),e=this.projectNode.getProject.bind(this.projectNode),n=this.projectNode.pushCommand.bind(this.projectNode);this.projectNode.pushCommands.bind(this.projectNode);return function(t,e,n,r){function o(){e((function(){return lt}));}function a(){e((function(){return ft}));}return {returnToLastCommit:function(){o();},pushUpdate:t,addPinContinuous:function(n,i,u,s,c,f){f&&o(),e((function(){var t=r(),e=t.signalData[n],o=e.pinTimes,a=e.pinIds.findIndex((function(t){return o[t]===u})),f=[];-1!==a&&f.push({type:"deletePin",pinId:e.pinIds[a]}),f.push(pt(t,n,i,u,s,c));var l=[];if(l.push({type:"deletePin",pinId:i}),-1!==a){var p=e.pinIds[a];l.push(pt(t,n,p,e.pinTimes[p],e.pinValues[p],e.curves[p]));}return {type:"addNextState",forward:f,backward:l}})),f&&(a(),t());},addPinDiscrete:function(n,i,u,s,c){c&&o(),e((function(){var t=r(),e=t.signalData[n],o=e.pinTimes,a=e.pinIds.findIndex((function(t){return o[t]===u})),c=[];-1!==a&&c.push({type:"deletePin",pinId:e.pinIds[a]}),c.push(pt(t,n,i,u,s));var f=[];if(f.push({type:"deletePin",pinId:i}),-1!==a){var l=e.pinIds[a];f.push(pt(t,n,l,e.pinTimes[l],e.pinValues[l]));}return {type:"addNextState",forward:c,backward:f}})),c&&(a(),t());},deletePin:function(n){o(),e((function(){return dt(r,n)})),a(),t();},deletePins:function(n){o(),n.forEach((function(t){e((function(){return dt(r,t)}));})),a(),t();},updatePins:function(n,i){i&&o();var u=r(),s={type:"updatePins",pins:[]},c={type:"updatePins",pins:[]};n.forEach((function(t){var e=t.pinId,n=u.orgData.signalIdByPinId[e],r=t.pinTime,i=t.pinValue,o="continuous"===t.pinType?t.functionString:void 0,a=u.signalData[n].pinTimes[e],f=u.signalData[n].pinValues[e],l="continuous"===t.pinType?u.signalData[n].curves[e]:void 0,p={pinId:e,pinTime:null!=r?r:a,pinValue:null!=i?i:f,functionString:null!=o?o:l},d={pinId:e,pinTime:a,pinValue:f,functionString:l};s.pins.push(p),c.pins.push(d);})),e((function(){return {type:"addNextState",forward:[s],backward:[c]}})),i&&a(),t();},updateCurve:function(n,i){o(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update curve of discrete signal");return {type:"addNextState",forward:[{type:"updateCurve",pinId:n,functionString:i}],backward:[{type:"updateCurve",pinId:n,functionString:t.signalData[e].curves[n]}]}})),a(),t();},updatePinBezierControlPoints:function(n,i,u){u&&o(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update bezier control points of discrete signal");if(!("bezier"in t.signalData[e]))throw new Error("Signal is not a bezier signal");return {type:"addNextState",forward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:i}],backward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:t.signalData[e].bezierControlPoints[n]}]}})),u&&a(),t();},createDiscreteSignal:function(n,r,i,u){o(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:i,isStatic:u,displayValues:true}],backward:[{type:"deleteSignal",signalId:n}]}})),a(),t();},createDiscreteBeatSignal:function(n,r){o(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:"beat"}],backward:[{type:"deleteSignal",signalId:n}]}})),a(),t();},createContinuousSignal:function(n,r,i,u,s,c){o(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c}],backward:[{type:"deleteSignal",signalId:n}]}})),a(),t();},createContinuousBezierSignal:function(n,r,i,u,s,c){o(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c,bezier:true}],backward:[{type:"deleteSignal",signalId:n}]}})),a(),t();},duplicateSignal:function(n){o();var i=ct();e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");var o=t.orgData.signalNames[n],a=e.defaultValue,u="continuous"===e.type?e.defaultCurve:void 0,s=e.isStatic,c="continuous"===e.type&&"bezier"in e,f="discrete"===e.type?e.displayValues:void 0,l=o+"_copy",p="continuous"===e.type?e.range:void 0;return {type:"addNextState",forward:[{type:"createSignal",signalId:i,signalType:e.type,signalName:l,range:p,defaultValue:a,defaultCurve:u,isStatic:s,bezier:!!c||void 0,displayValues:!!f||void 0}],backward:[{type:"deleteSignal",signalId:i}]}})),e((function(){var t=r(),e=t.signalData[n].pinIds,o=t.signalData[n].type,a=e.map((function(e){var r,i=t.signalData[n].pinTimes[e],a=t.signalData[n].pinValues[e];return "continuous"===o&&(r=t.signalData[n].curves[e]),{pinTime:i,pinValue:a,functionString:r,pinId:ct()}}));return {type:"addNextState",forward:a.map((function(e){return pt(t,i,e.pinId,e.pinTime,e.pinValue,e.functionString)})),backward:a.map((function(t){return {type:"deletePin",pinId:t.pinId}}))}})),a(),t();},deleteSignal:function(n){o(),e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"deleteSignal",signalId:n}],backward:[{type:"createSignal",signalId:n,signalType:e.type,signalName:t.orgData.signalNames[n],range:"continuous"===e.type?e.range:void 0,defaultValue:e.defaultValue,defaultCurve:"continuous"===e.type?e.defaultCurve:void 0,isStatic:e.isStatic,bezier:"continuous"===e.type&&"bezier"in e||void 0,bezierControlPoints:"continuous"===e.type&&"bezier"in e?e.bezierControlPoints:void 0,displayValues:"discrete"===e.type?e.displayValues:void 0}]}})),a(),t();},updateSignalDefaultValue:function(n,i){o(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:i}],backward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:t.defaultValue}]}})),a(),t();},updateSignalName:function(n,i){o(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalName",signalId:n,signalName:i}],backward:[{type:"updateSignalName",signalId:n,signalName:t.orgData.signalNames[n]}]}})),a(),t();},updateSignalRange:function(n,i){o(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");if("discrete"===t.type)throw new Error("Cannot update range of discrete signal");return {type:"addNextState",forward:[{type:"updateSignalRange",signalId:n,range:i}],backward:[{type:"updateSignalRange",signalId:n,range:t.range}]}})),a(),t();},updateSignalIndex:function(n,i,u){u&&o(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalIndex",signalId:n,index:i}],backward:[{type:"updateSignalIndex",signalId:n,index:t.orgData.activeSignalIds.indexOf(n)}]}})),u&&a(),t();},updateSignalActiveStatus:function(n,i){o(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalActiveStatus",signalId:n,active:i}],backward:[{type:"updateSignalActiveStatus",signalId:n,active:t.orgData.activeSignalIds.includes(n)}]}})),a(),t();},updateFramesPerSecond:function(n){o(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFramesPerSecond",framesPerSecond:n}],backward:[{type:"updateFramesPerSecond",framesPerSecond:t.timelineData.framesPerSecond}]}})),a(),t();},updatePlayheadPosition:function(n,i){i&&o(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:t.timelineData.playheadPosition}]}})),i&&a(),t();},playNextFrame:function(n){var a=r(),u=a.timelineData.playheadPosition,s=i(a.timelineData.focusRange,2);s[0],s[1],o(),e((function(){return {type:"addNextState",forward:[{type:"updatePlaying",playing:true},{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:u},{type:"updatePlaying",playing:false}]}})),t();},updateFocusRange:function(n){var u=i(n,2),s=u[0],c=u[1];o(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFocusRange",focusRange:[s,c]}],backward:[{type:"updateFocusRange",focusRange:t.timelineData.focusRange}]}})),a(),t();},updateNumberOfFrames:function(n){o(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateNumberOfFrames",numberOfFrames:n}],backward:[{type:"updateNumberOfFrames",numberOfFrames:t.timelineData.numberOfFrames}]}})),a(),t();},updateProjectName:function(n){o(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateProjectName",projectName:n}],backward:[{type:"updateProjectName",projectName:t.metaData.name}]}})),a(),t();},undo:function(){o(),e((function(){return {type:"previous"}})),a(),t();},redo:function(){o(),e((function(){return {type:"next"}})),a(),t();},addCurveTemplate:function(n,r){e((function(){return {type:"appendToCurrentState",forward:[{type:"addCurveTemplate",curveId:n,functionString:r}],backward:[{type:"deleteCurveTemplate",curveId:n}]}})),t();},deleteCurveTemplate:function(n){e((function(){return {type:"appendToCurrentState",forward:[{type:"deleteCurveTemplate",curveId:n}],backward:[{type:"addCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();},updateCurveTemplate:function(n,i){e((function(){return {type:"appendToCurrentState",forward:[{type:"updateCurveTemplate",curveId:n,functionString:i}],backward:[{type:"updateCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();}}}(t,n,0,e)},enumerable:false,configurable:true}),t.prototype.getProject=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");return this.projectNode.getProject()},t.prototype.prettyPrintProject=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");console.log(JSON.stringify(this.projectNode.getProject(),null,2));},t.prototype.subscribeToProjectUpdates=function(t){return this.projectNode.subscribeToProjectUpdates(t)},t.prototype.interpolateSignalValueAtTime=function(t,e){if(!this.projectNode.initialized)throw new Error("Project not initialized");var n=this.projectNode.getProject();return Vt(n,t,e)},t}();var _t=Object.freeze({__proto__:null,dispatchProjectEvent:function(t,e,n){ void 0===n&&(n="default");var r=new URL(e).origin;return function(e){var i={type:"projectNodeEvent",event:e,channel:n};t.postMessage(i,r);}},subscribeToProjectEvents:function(t,e){ void 0===e&&(e="default");var n=new URL(t).origin;return function(t){function r(r){if(r.origin===n&&"projectNodeEvent"===r.data.type&&r.data.channel===e){var i=r.data.event;t(i);}}return window.addEventListener("message",r),function(){return window.removeEventListener("message",r)}}}});var mt=Object.freeze({__proto__:null,dispatchProjectEvent:function(t){return void 0===t&&(t="default"),function(e){var n=new CustomEvent("projectNodeEvent",{detail:{event:e,channel:t}});window.dispatchEvent(n);}},subscribeToProjectEvents:function(t){return void 0===t&&(t="default"),function(e){function n(n){if("projectNodeEvent"===n.type&&n.detail.channel===t){var r=n.detail.event;e(r);}}return window.addEventListener("projectNodeEvent",n),function(){return window.removeEventListener("projectNodeEvent",n)}}}}),wt=Object.freeze({__proto__:null,CustomEventAPI:mt,PinsAndCurvesProjectController:yt,PostMessageAPI:_t});function bt(t,e,n){var r=i(t,2),o=r[0],a=r[1],u=i(e,2),s=u[0],c=u[1],f=i(n,2),l=f[0],p=f[1],d=(o-s)*(o-l)*(s-l);return 0===d?{a:0,b:0,c:0}:{a:(a*(s-l)+c*(l-o)+p*(o-s))/d,b:(a*(Math.pow(l,2)-Math.pow(s,2))+c*(Math.pow(o,2)-Math.pow(l,2))+p*(Math.pow(s,2)-Math.pow(o,2)))/d,c:(a*(s*l*(s-l))+c*(l*o*(l-o))+p*(o*s*(o-s)))/d}}var St=function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds.indexOf(t.pinId);return 0===r?t.range[0]:0===(r-1)%2?function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds,i=r.indexOf(t.pinId);if(0===i)return t.previousPinValue;if(i===r.length-1)return t.nextPinValue;var o=r[i-1],a=r[i+1],u=bt([e.signalData[n].pinTimes[o],e.signalData[n].pinValues[o]],[t.nextPinTime,t.nextPinValue],[e.signalData[n].pinTimes[a],e.signalData[n].pinValues[a]]),s=u.a,c=u.b,f=u.c,l=t.frame,p=s*l*l+c*l+f;return isNaN(p)?t.nextPinValue:p}(t):function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds,i=r.indexOf(t.pinId);if(i<2)return t.previousPinValue;var o=r[i-1],a=r[i-2],u=e.signalData[n].pinTimes[o],s=e.signalData[n].pinValues[o],c=t.nextPinTime,f=t.nextPinValue,l=bt([e.signalData[n].pinTimes[a],e.signalData[n].pinValues[a]],[u,s],[c,f]),p=l.a,d=l.b,h=l.c,v=t.frame,g=p*v*v+d*v+h;return isNaN(g)?t.nextPinValue:g}(t)};var It=function(t){var e,n=((e=t%2147483647)<=0&&(e+=2147483646),function(){return ((e=16807*e%2147483647)-1)/2147483646}),r=Array(256).fill(0).map((function(){return 2*n()-1})),a=Array(256).fill(0).map((function(t,e){return e})).sort((function(){return n()-.5})),u=o(o([],i(a),false),i(a),false);return function(t){var e,n=255&Math.floor(t),i=t-Math.floor(t),o=(e=i)*e*e*(e*(6*e-15)+10);return function(t,e,n){return t+n*(e-t)}(r[u[n]]*i,r[u[n+1]]*(i-1),o)}}(42);function Pt(t,e,n){return t+(e-t)*n}function xt(t){return t*t*t}function jt(t){return 1-Math.pow(1-t,3)}function Dt(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}function Et(t){var e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}var Nt={};function Ot(t,e){t in Nt||(Nt[t]=e);}function Ct(t){return t in Nt?Nt[t]:null}function Tt(t){var e=t.nextPinTime,n=t.project,r=t.range,o=t.defaultValue,a=t.pinId,u=t.frame,s=t.numberOfFrames,c=t.framesPerSecond,f=t.nextPinValue,l=t.previousPinTime,p=t.previousPinValue,d=t.relativeTime,h=t.interpolateSignalValueAtTime,v=i(r,2),g=v[0],y=v[1];return {nextPinTime:e,nextPinValue:f,project:n,previousPinTime:l,defaultValue:o,previousPinValue:p,relativeTime:d,frame:u,pinId:a,numberOfFrames:s,framesPerSecond:c,maxValue:y,minValue:g,linearInterpolation:Pt,easeInCubic:xt,easeOutCubic:jt,easeInOutCubic:Dt,easeOutElastic:Et,easyLinear:function(){return d*(f-p)+p},bezier:function(){var r=n.orgData.signalIdByPinId[t.pinId],a=n.signalData[r];if(a&&"bezier"in a){var u=i(a.bezierControlPoints[t.pinId],2);u[0];var c=u[1];c+=f;var h=a.pinIds.indexOf(t.pinId)-1;h=h<0?0:h;var v=a.pinIds[h],g=i(a.bezierControlPoints[v],4);g[0],g[1];g[2];var _=g[3];return function(t,e,n,r,i){var o=t.y;var a=e.y;var u=n.y;var s=r.y;return function(t){return Math.pow(1-t,3)*o+3*Math.pow(1-t,2)*t*a+3*(1-t)*Math.pow(t,2)*u+Math.pow(t,3)*s}(i)}({y:p},{y:_+=p},{y:c},{y:f},d)}return o},easyStep:function(){return f},easyEaseIn:function(){return p+xt(d)*(f-p)},easyEaseOut:function(){return p+jt(d)*(f-p)},easyEase:function(){return p+Dt(d)*(f-p)},easyEaseOutElastic:function(){return p+Et(d)*(f-p)},easyInOut:function(){return 1},noise:It,easyThreshold:function(){return f>(y-g)/2?y:g},easyRepeat:function(){return d},easyParabola:function(){return St(t)},interpolateSignalValueAtTime:h,signal:function(t){return h(t,u)},cloneSignal:function(t){var e=n.orgData.signalIds.find((function(e){return n.orgData.signalNames[e]===t}));if(!e)throw new Error("Signal ".concat(t," not found"));var r=n.signalData[e];if(!r)throw new Error("Signal ".concat(t," not found"));var i=r.pinIds;if(i.length<2)return o;var a=r.pinTimes[i[0]],u=r.pinTimes[i[i.length-1]];return h(t,a+(u-a)*d)},fitSignal:function(t,e,r){var i=n.orgData.signalIds.find((function(e){return n.orgData.signalNames[e]===t}));if(!i)throw new Error("Signal ".concat(t," not found"));var o=null!=e?e:g,a=null!=r?r:y,s=n.signalData[i].range;return o+(h(t,u)-s[0])/(s[1]-s[0])*(a-o)},flip:function(t){return y-t+g},useAsset:Ct,saveAsset:Ot}}var Ut={};var At={},kt=1e-6,Mt=function(t,e,n,r){var a=t.signalData[e],u=i(a.range,2),s=u[0],c=u[1],f=a.defaultValue,l=Object.entries(a.pinTimes).sort((function(t,e){return t[1]-e[1]})),p=l.find((function(t){var e=i(t,2);return e[0],e[1]>=n}));if(void 0===p)return [f,[]];var d,h=i(p,2),v=h[0],g=h[1],y=a.pinValues[v],_=a.curves[v],m=s,w=0,b=l.findIndex((function(t){var e=i(t,2),n=e[0];return e[1],n===v}));if(b>0){var S=i(l[b-1],2),I=S[0],P=S[1];m=a.pinValues[I],w=P;}else if(n<g)return [f,[]];var x=At[e+v];if(void 0===x||x.functionString!==_){var j="\n            let nextPinTime = context.nextPinTime;\n            let nextPinValue = context.nextPinValue;\n            let previousPinTime = context.previousPinTime;\n            let previousPinValue = context.previousPinValue;\n            let relativeTime = context.relativeTime;\n            let frame = context.frame;\n            let numberOfFrames = context.numberOfFrames;\n            let framesPerSecond = context.framesPerSecond;\n\n            let interpolateSignalValue = context.interpolateSignalValue;\n            let signal = context.signal;\n\n            let bezier = context.bezier;\n\n            let easyLinear = context.easyLinear;\n            let easyEaseIn = context.easyEaseIn;\n            let easyEaseOut = context.easyEaseOut;\n            let easyStep = context.easyStep;\n            let easyEase = context.easyEase;\n            let easyEaseOutElastic = context.easyEaseOutElastic;\n            let easyRepeat = context.easyRepeat;\n            let easyThreshold = context.easyThreshold;\n            let easyParabola = context.easyParabola;\n            let easyInOut = context.easyInOut;\n            let noise = context.noise;\n            let fitSignal = context.fitSignal;\n            let flip = context.flip;\n            let cloneSignal = context.cloneSignal;\n\n\n            ".concat(_);d=new Function("context","templates",j),At[e+v]={functionString:_,cachedFunction:d};}else d=x.cachedFunction;var D=(n-w)/(g!==w?g-w:1),E=f,N=[];try{var O=Tt({nextPinTime:g,nextPinValue:y,previousPinTime:w,project:t,previousPinValue:m,defaultValue:f,relativeTime:D,pinId:v,frame:n,range:[s,c],numberOfFrames:t.timelineData.numberOfFrames,framesPerSecond:t.timelineData.framesPerSecond,interpolateSignalValueAtTime:function(e,n){var a=t.orgData.signalIds.find((function(n){return t.orgData.signalNames[n]===e}));if(void 0===a)throw new Error("Signal not found");var u=i(Vt(t,a,n,r),2),s=u[0],c=u[1];if("string"==typeof s)throw new Error("Interpolation function returned string");return N.push.apply(N,o([],i(c),!1)),s}}),C=function(t){var e={};return Object.entries(t.templateData).forEach((function(t){var n=i(t,2),r=n[0],o=n[1];if(void 0!==Ut[r]){if(Ut[r].functionString===o){var a=Ut[r].cachedFunction;return void(e[r]=a)}}else a=new Function("return ".concat(o,";"))(),e[r]=a,Ut[r]={functionString:o,cachedFunction:a};})),e}(t);E=d(O,C);}catch(t){N.push({signalId:e,frame:n,error:t.message});}if(isNaN(E)&&(E=f,N.push({signalId:e,frame:n,error:"Interpolated value is NaN"})),E<s&&(E=s,Math.abs(E-s)>kt&&N.push({signalId:e,frame:n,error:"Interpolated value below minimum"})),E>c){var T=E;E=c,Math.abs(T-c)>kt&&N.push({signalId:e,frame:n,error:"Interpolated value above maximum: "+T});}return [E,N]},Rt=function(t,e,n,r){var o=t.signalData[e],a=o.defaultValue,u=Object.entries(o.pinTimes).sort((function(t,e){return t[1]-e[1]})).find((function(t){var e=i(t,2);return e[0],e[1]>=n}));if(void 0===u)return a;var s=i(u,2),c=s[0];return s[1],o.pinValues[c]},Vt=function(t,e,n,r){if(void 0===r&&(r=0),++r>1e3)throw new Error("Exceeded maximum iteration count");var i=t.timelineData.numberOfFrames;if(n<0||n>i)throw new Error("Time out of range");var o=t.signalData[e].type;if("discrete"===o)return [Rt(t,e,n),[]];if("continuous"===o)return Mt(t,e,n,r);throw new Error("Invalid signal type")};function Lt(t,e){return [t[0]+e[0],t[1]+e[1]]}function qt(t,e){return [t[0]-e[0],t[1]-e[1]]}function Ht(t,e){return [t[0]*e[0],t[1]*e[1]]}function $t(t,e){var n=i([t[0][0],t[0][1],t[2][0],t[2][1]],4),r=n[0],o=n[1],a=n[2],u=n[3],s=i([e[0][0],e[0][1],e[2][0],e[2][1]],4),c=s[0],f=s[1],l=s[2],p=s[3];return !(r>l||a<c)&&!(o>p||u<f)}var Kt=function(){function t(t,e,n){ void 0===t&&(t=[0,0]),void 0===e&&(e=0),void 0===n&&(n=0),this._o=t,this._w=e,this._h=n;}return Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t;},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t;},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"o",{get:function(){return this._o},set:function(t){this._o=t;},enumerable:false,configurable:true}),t.prototype.pointInside=function(t){var e={x:t[0],y:t[1]},n=e.x,r=e.y,i={oX:this.o[0],oY:this.o[1]},o=i.oX,a=i.oY;return !(n<o||n>o+this.w)&&!(r<a||r>a+this.h)},t.prototype.clone=function(){return new t(o([],i(this.o),false),this.w,this.h)},t.prototype.getBoundingBox=function(){return [this.o,Lt(this.o,[this.w,0]),Lt(this.o,[this.w,this.h]),Lt(this.o,[0,this.h])]},t.prototype.getCenter=function(){return Lt(this.o,[this.w/2,this.h/2])},t}();(function(t){function r(){var e=t.call(this)||this;return e.layer=0,e.children=[],e._isPrimaryCamera=false,e._needsUpdate=false,e._needsUpdate_root=false,e._renderAlways=false,e.updateWhenCameraChanges=false,e.state=void 0,e.context={},e.windowDidMountPrimitiveIsRunning=false,e.childIndex=0,e.isCanvasRoot=false,e.props={},e.globalPositioning=false,e}return e(r,t),Object.defineProperty(r.prototype,"_cameraSnapshot",{get:function(){var t;if(!this._root)throw new Error("Root not connected");return null===(t=this._root)||void 0===t?void 0:t.cameraSnapshot},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"_canvas",{get:function(){var t;if(!this._root)throw new Error("Root not connected");return null===(t=this._root)||void 0===t?void 0:t.canvas},enumerable:false,configurable:true}),r.prototype.setAsPrimaryCamera=function(){var t;null===(t=this._root)||void 0===t||t.installCamera(this);},r.prototype.setState=function(t){var e,n;if(this.state===t)throw new Error("Cannot set state to previous state. ");this.windowDidMountPrimitiveIsRunning?this.state=t:(this._isPrimaryCamera&&(null===(e=this._root)||void 0===e||e.windows.forEach((function(t){t.updateWhenCameraChanges&&(t._needsUpdate=true);}))),null===(n=this._root)||void 0===n||n.scheduleStateUpdate(this,t));},r.prototype.setContext=function(t,e){var n,r;this.windowDidMountPrimitiveIsRunning?this.context[t]=e:(this._isPrimaryCamera&&(null===(n=this._root)||void 0===n||n.windows.forEach((function(t){t.updateWhenCameraChanges&&(t._needsUpdate=true);}))),this.context[t]=e,null===(r=this._root)||void 0===r||r.scheduleContextUpdate(this,t,e));},r.prototype.windowDidMountPrimitive=function(t){this.windowDidMountPrimitiveIsRunning=true,this.windowDidMount(t),this.windowDidMountPrimitiveIsRunning=false;},r.prototype.windowDidMount=function(t){},r.prototype.windowDidUpdate=function(t){},r.prototype.cameraDidUpdate=function(){},r.prototype.windowWillUnmount=function(){},r.prototype.getBoxPrimitive=function(){if(this._boxSnapshot)return this._boxSnapshot;var t=this.getBox();return this._boxSnapshot=t,t},r.prototype.getBox=function(){return new Kt([0,0],0,0)},Object.defineProperty(r.prototype,"o",{get:function(){return this.getBoxPrimitive().o},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"w",{get:function(){return this.getBoxPrimitive().w},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"h",{get:function(){return this.getBoxPrimitive().h},enumerable:false,configurable:true}),r.prototype.cameraPassUpdateSelf=function(){var t,e,r=this;this._isPrimaryCamera?null===(t=this._root)||void 0===t||t.windows.forEach((function(t){var e;null===(e=r._root)||void 0===e||e.taintLayer(t.layer);})):(this._needsUpdate&&(this._boxSnapshot=void 0,null===(e=this._root)||void 0===e||e.taintLayer(this.layer)),this.cameraPassUpdateChildren(),this._needsUpdate&&this.windowDidUpdate(n({},this.props)));},r.prototype.cameraPassUpdateChildren=function(){var t=this;this.childIndex=0;var e=this.getChildren(this.props).map((function(e){return e(t)})),n=this.children.filter((function(t){return !e.includes(t)})),r=e.filter((function(e){return !t.children.includes(e)}));this.children=e,n.forEach((function(t){return t.windowWillUnmount()})),r.forEach((function(t){return t.windowDidMountPrimitive(t.props)}));var i=this.children.find((function(t){return t._needsUpdate}));this.children.forEach((function(t){t._needsUpdate=true;})),i&&i.cameraPassUpdateSelf();},r.prototype.regularPassUpdateSelf=function(){var t;this._boxSnapshot=void 0,null===(t=this._root)||void 0===t||t.taintLayer(this.layer),this.regularPassUpdateChildren(),this.windowDidUpdate(n({},this.props));},r.prototype.regularPassUpdateChildren=function(){var t=this;this.childIndex=0;var e=this.getChildren(this.props).map((function(e){return e(t)})),n=this.children.filter((function(t){return !e.includes(t)})),r=e.filter((function(e){return !t.children.includes(e)}));this.children=e,n.forEach((function(t){return t.windowWillUnmount()})),r.forEach((function(t){t.windowDidMountPrimitive(t.props);})),this.children.forEach((function(t){t.regularPassUpdateSelf();}));},r.prototype.getChildren=function(t){return []},r.prototype.incChildIndex=function(){this.childIndex++;},r.Node=function(t){var e=this,r=this.name;return function(i){if(i.isCanvasRoot){var o=void 0;return (o=new e)._root=i,o.setKey("root"),o.props=t||{},o.context=n({},o.context),o}var a=i.childIndex;t||(t={});var u=t.key?t.key:"".concat(r,"[").concat(a,"]");o=void 0;return  -1!==i.children.findIndex((function(t){return t.key===u}))?o=i.children.find((function(t){return t.key===u})):((o=new e)._parent=i,o._root=i._root,o.setKey(u)),o.props=n({},t),o.context=n(n({},o.context),i.context),i.incChildIndex(),o}},Object.defineProperty(r.prototype,"parentO",{get:function(){return this._parent?this._parent.globalO:[0,0]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"parentW",{get:function(){return this._parent?this._parent.w:0},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"parentH",{get:function(){return this._parent?this._parent.h:0},enumerable:false,configurable:true}),r.prototype.getChildByKey=function(t){return this.children.find((function(e){return e.key===t}))},r.prototype.getBoundingBox=function(){var t=i(this.globalO,2),e=t[0],n=t[1];return [[e,n],[e+this.w,n],[e+this.w,n+this.h],[e,n+this.h]]},r.prototype.pointInside=function(e){return t.prototype.pointInside.call(this,qt(e,this.parentO))},Object.defineProperty(r.prototype,"globalO",{get:function(){if(!this._parent||this.globalPositioning)return this.o;var t=i(this._parent.globalO,2),e=t[0],n=t[1],r=i(this.o,2);return [e+r[0],n+r[1]]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"globalKey",{get:function(){return this._parent?this._parent.globalKey+"@"+this.key:"root"},enumerable:false,configurable:true}),r.prototype.getLayer=function(){return this.layer},r.prototype.setLayer=function(t){this.layer=t;},r.prototype.setKey=function(t){this.key=t;},Object.defineProperty(r.prototype,"displayConnected",{get:function(){return this._cameraSnapshot&&this._canvas},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvasUnit",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._cameraSnapshot.w/this._canvas.width,this._cameraSnapshot.h/this._canvas.height]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"absoluteUnit",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._canvas.width/this._cameraSnapshot.w,this._canvas.height/this._cameraSnapshot.h]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvasO",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._cameraSnapshot.o[0],this._cameraSnapshot.o[1]]},enumerable:false,configurable:true}),r.prototype.absoluteToCanvasMeasure=function(t){return Ht(t,[this._canvas.width/this._cameraSnapshot.w,this._canvas.height/this._cameraSnapshot.h])},r.prototype.canvasToAbsoluteMeasure=function(t){return Ht(t,[this._cameraSnapshot.w/this._canvas.width,this._cameraSnapshot.h/this._canvas.height])},Object.defineProperty(r.prototype,"cameraSnapshot",{get:function(){return this._cameraSnapshot},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvas",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return this._canvas},enumerable:false,configurable:true}),r.prototype.prepareHandlerProps=function(){var t=this.cameraSnapshot,e=this.canvas,n=this.absoluteToCanvasMeasure.bind(this),r=this.canvasToAbsoluteMeasure.bind(this),i=this.canvasUnit,o=this.absoluteUnit,a=this.canvasO;return {canvasDimensions:[e.width,e.height],absoluteToCanvasMeasure:n,canvasToAbsoluteMeasure:r,camera:t,canvasUnit:i,canvasO:a,absoluteUnit:o}},r.prototype.preparePostBoxHandlerProps=function(){var t=this,e=this._cameraSnapshot,r=this._canvas,o=function(n){var o=t.globalO,a=i(n,2),u=a[0],s=a[1],c=i(o,2),f=i([c[0]+u,c[1]+s],2),l=f[0],p=f[1],d=i(e.o,2),h=i([l-d[0],p-d[1]],2),v=h[0],g=h[1];return [v*(r.width/e.w),g*(r.height/e.h)]},a=o([0,0]);return n(n({},this.prepareHandlerProps()),{localToCanvas:o,canvasToLocal:function(n){var i=t.globalO;return qt(Lt(Ht(n,[e.w/r.width,e.h/r.height]),e.o),i)},absoluteO:a})},r.prototype.prepareMouseHandlerProps=function(t,e){var r=this.preparePostBoxHandlerProps(),o=i(this.canvasUnit,2),a=o[0],u=o[1],s=i(this.canvasO,2),c=s[0],f=s[1],l=i(t,2),p=[c+l[0]*a,f+l[1]*u],d=qt(p,this.globalO),h=this.pointInside(p);return n(n({},r),{relativePos:d,canvasPos:t,absolutePos:p,pointInside:h,terminateEvent:e})},r.prototype.prepareWheelHandlerProps=function(t){var e=this.preparePostBoxHandlerProps();return n(n({},e),{terminateEvent:t})},r.prototype.renderPrimitive=function(t){if(this.render){var e=this.preparePostBoxHandlerProps();this.render(n(n({},e),{ctx:t}));}},r.prototype.render=function(t){},r.prototype.onMouseDownPrimitive=function(t,e,n){this.onMouseDown&&this.onMouseDown(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseDown=function(t,e){},r.prototype.onMouseMovePrimitive=function(t,e,n){this.onMouseMove&&this.onMouseMove(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseMove=function(t,e){},r.prototype.onMouseUpPrimitive=function(t,e,n){this.onMouseUp&&this.onMouseUp(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseUp=function(t,e){},r.prototype.onClickPrimitive=function(t,e,n){this.onClick&&this.onClick(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onClick=function(t,e){},r.prototype.onWheelPrimitive=function(t,e){this.onWheel&&this.onWheel(this.prepareWheelHandlerProps(t),e);},r.prototype.onWheel=function(t,e){},r.prototype.strokeOutline=function(t,e){t.ctx.strokeStyle=e;var n=t.absoluteO,r=t.absoluteUnit,o=i(n,2),a=o[0],u=o[1],s=i(r,2),c=s[0],f=s[1];t.ctx.strokeRect(a,u,this.w*c,this.h*f);},r})(Kt);var Xt={};function Jt(t,e,n,a,u){var s=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),c=e.filter((function(t){return t._renderAlways||$t(t.getBoundingBox(),s)})),f=Array.from(new Set(c.map((function(t){return t.getLayer()})))).sort((function(t,e){return t-e}));a.clearRect(0,0,n.width,n.height);for(var l=function(t){var e,i,o=f[t],s=c.filter((function(e){return e.getLayer()===f[t]}));if(u.includes(o)){var l=o+"";if(void 0===Xt[l]){var p=document.createElement("canvas");p.width=n.width,p.height=n.height,Xt[l]=p;}var d=Xt[l],h=d.getContext("2d");h.clearRect(0,0,d.width,d.height);try{for(var v=(e=void 0,r(s)),g=v.next();!g.done;g=v.next()){g.value.renderPrimitive(h);}}catch(t){e={error:t};}finally{try{g&&!g.done&&(i=v.return)&&i.call(v);}finally{if(e)throw e.error}}}var y=o+"";Xt[y]&&a.drawImage(Xt[y],0,0);},p=0;p<f.length;p++)l(p);}function Zt(t,e,n,a,u){var s,c,f=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),l=e.filter((function(t){return $t(t.getBoundingBox(),f)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(l),v=h.next();!v.done;v=h.next()){if(v.value.onClickPrimitive(a,d,u),!p)break}}catch(t){s={error:t};}finally{try{v&&!v.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function Yt(t,e,n,a,u){var s,c,f=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),l=e.filter((function(t){return $t(t.getBoundingBox(),f)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(l),v=h.next();!v.done;v=h.next()){if(v.value.onMouseDownPrimitive(a,d,u),!p)break}}catch(t){s={error:t};}finally{try{v&&!v.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function Qt(t,e,n,a,u){var s,c,f=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),l=e.filter((function(t){return $t(t.getBoundingBox(),f)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(l),v=h.next();!v.done;v=h.next()){if(v.value.onMouseMovePrimitive(a,d,u),!p)break}}catch(t){s={error:t};}finally{try{v&&!v.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function te(t,e,n,a,u){var s,c,f=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),l=e.filter((function(t){return $t(t.getBoundingBox(),f)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(l),v=h.next();!v.done;v=h.next()){if(v.value.onMouseUpPrimitive(a,d,u),!p)break}}catch(t){s={error:t};}finally{try{v&&!v.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function ee(t,e,n,a){var u,s,c=(t=new Kt(o([],i(t.o),false),t.w,t.h)).getBoundingBox(),f=e.filter((function(t){return $t(t.getBoundingBox(),c)})).reverse(),l=true,p=function(){l=false;};try{for(var d=r(f),h=d.next();!h.done;h=d.next()){if(h.value.onWheelPrimitive(p,a),!l)break}}catch(t){u={error:t};}finally{try{h&&!h.done&&(s=d.return)&&s.call(d);}finally{if(u)throw u.error}}}var ne,re="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ie={exports:{}};var oe,ae,ue=(ne||(ne=1,oe=ie,ae=ie.exports,function(){var t,e="Expected a function",n="__lodash_hash_undefined__",r="__lodash_placeholder__",i=16,o=32,a=64,u=128,s=256,c=1/0,f=9007199254740991,l=NaN,p=4294967295,d=[["ary",u],["bind",1],["bindKey",2],["curry",8],["curryRight",i],["flip",512],["partial",o],["partialRight",a],["rearg",s]],h="[object Arguments]",v="[object Array]",g="[object Boolean]",y="[object Date]",_="[object Error]",m="[object Function]",w="[object GeneratorFunction]",b="[object Map]",S="[object Number]",I="[object Object]",P="[object Promise]",x="[object RegExp]",j="[object Set]",D="[object String]",E="[object Symbol]",N="[object WeakMap]",O="[object ArrayBuffer]",C="[object DataView]",T="[object Float32Array]",U="[object Float64Array]",z="[object Int8Array]",A="[object Int16Array]",k="[object Int32Array]",M="[object Uint8Array]",R="[object Uint8ClampedArray]",V="[object Uint16Array]",B="[object Uint32Array]",F=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,L=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,$=RegExp(q.source),K=RegExp(H.source),G=/<%-([\s\S]+?)%>/g,X=/<%([\s\S]+?)%>/g,J=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/[\\^$.*+?()[\]{}|]/g,et=RegExp(tt.source),nt=/^\s+/,rt=/\s/,it=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ot=/\{\n\/\* \[wrapped with (.+)\] \*/,at=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,st=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,ft=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,lt=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,ht=/^\[object .+?Constructor\]$/,vt=/^0o[0-7]+$/i,gt=/^(?:0|[1-9]\d*)$/,yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,_t=/($^)/,mt=/['\n\r\u2028\u2029\\]/g,wt="\\ud800-\\udfff",bt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",It="a-z\\xdf-\\xf6\\xf8-\\xff",Pt="A-Z\\xc0-\\xd6\\xd8-\\xde",xt="\\ufe0e\\ufe0f",jt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Dt="['’]",Et="["+wt+"]",Nt="["+jt+"]",Ot="["+bt+"]",Ct="\\d+",Tt="["+St+"]",Ut="["+It+"]",zt="[^"+wt+jt+Ct+St+It+Pt+"]",At="\\ud83c[\\udffb-\\udfff]",kt="[^"+wt+"]",Mt="(?:\\ud83c[\\udde6-\\uddff]){2}",Rt="[\\ud800-\\udbff][\\udc00-\\udfff]",Vt="["+Pt+"]",Bt="\\u200d",Ft="(?:"+Ut+"|"+zt+")",Wt="(?:"+Vt+"|"+zt+")",Lt="(?:['’](?:d|ll|m|re|s|t|ve))?",qt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+Ot+"|"+At+")?",$t="["+xt+"]?",Kt=$t+Ht+"(?:"+Bt+"(?:"+[kt,Mt,Rt].join("|")+")"+$t+Ht+")*",Gt="(?:"+[Tt,Mt,Rt].join("|")+")"+Kt,Xt="(?:"+[kt+Ot+"?",Ot,Mt,Rt,Et].join("|")+")",Jt=RegExp(Dt,"g"),Zt=RegExp(Ot,"g"),Yt=RegExp(At+"(?="+At+")|"+Xt+Kt,"g"),Qt=RegExp([Vt+"?"+Ut+"+"+Lt+"(?="+[Nt,Vt,"$"].join("|")+")",Wt+"+"+qt+"(?="+[Nt,Vt+Ft,"$"].join("|")+")",Vt+"?"+Ft+"+"+Lt,Vt+"+"+qt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ct,Gt].join("|"),"g"),te=RegExp("["+Bt+wt+bt+xt+"]"),ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ne=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ie=-1,ue={};ue[T]=ue[U]=ue[z]=ue[A]=ue[k]=ue[M]=ue[R]=ue[V]=ue[B]=true,ue[h]=ue[v]=ue[O]=ue[g]=ue[C]=ue[y]=ue[_]=ue[m]=ue[b]=ue[S]=ue[I]=ue[x]=ue[j]=ue[D]=ue[N]=false;var se={};se[h]=se[v]=se[O]=se[C]=se[g]=se[y]=se[T]=se[U]=se[z]=se[A]=se[k]=se[b]=se[S]=se[I]=se[x]=se[j]=se[D]=se[E]=se[M]=se[R]=se[V]=se[B]=true,se[_]=se[m]=se[N]=false;var ce={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},fe=parseFloat,le=parseInt,pe="object"==typeof re&&re&&re.Object===Object&&re,de="object"==typeof self&&self&&self.Object===Object&&self,he=pe||de||Function("return this")(),ve=ae&&!ae.nodeType&&ae,ge=ve&&oe&&!oe.nodeType&&oe,ye=ge&&ge.exports===ve,_e=ye&&pe.process,me=function(){try{var t=ge&&ge.require&&ge.require("util").types;return t||_e&&_e.binding&&_e.binding("util")}catch(t){}}(),we=me&&me.isArrayBuffer,be=me&&me.isDate,Se=me&&me.isMap,Ie=me&&me.isRegExp,Pe=me&&me.isSet,xe=me&&me.isTypedArray;function je(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function De(t,e,n,r){for(var i=-1,o=null==t?0:t.length;++i<o;){var a=t[i];e(r,a,n(a),t);}return r}function Ee(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&false!==e(t[n],n,t););return t}function Ne(t,e){for(var n=null==t?0:t.length;n--&&false!==e(t[n],n,t););return t}function Oe(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return  false;return  true}function Ce(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a);}return o}function Te(t,e){return !(null==t||!t.length)&&We(t,e,0)>-1}function Ue(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return  true;return  false}function ze(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function Ae(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function ke(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function Me(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Re(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return  true;return  false}var Ve=$e("length");function Be(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,false})),r}function Fe(t,e,n,r){for(var i=t.length,o=n+(r?1:-1);r?o--:++o<i;)if(e(t[o],o,t))return o;return  -1}function We(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return  -1}(t,e,n):Fe(t,qe,n)}function Le(t,e,n,r){for(var i=n-1,o=t.length;++i<o;)if(r(t[i],e))return i;return  -1}function qe(t){return t!=t}function He(t,e){var n=null==t?0:t.length;return n?Xe(t,e)/n:l}function $e(e){return function(n){return null==n?t:n[e]}}function Ke(e){return function(n){return null==e?t:e[n]}}function Ge(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=false,t):e(n,t,i,o);})),n}function Xe(e,n){for(var r,i=-1,o=e.length;++i<o;){var a=n(e[i]);a!==t&&(r=r===t?a:r+a);}return r}function Je(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ze(t){return t?t.slice(0,vn(t)+1).replace(nt,""):t}function Ye(t){return function(e){return t(e)}}function Qe(t,e){return ze(e,(function(e){return t[e]}))}function tn(t,e){return t.has(e)}function en(t,e){for(var n=-1,r=t.length;++n<r&&We(e,t[n],0)>-1;);return n}function nn(t,e){for(var n=t.length;n--&&We(e,t[n],0)>-1;);return n}var rn=Ke({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),on=Ke({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function an(t){return "\\"+ce[t]}function un(t){return te.test(t)}function sn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t];})),n}function cn(t,e){return function(n){return t(e(n))}}function fn(t,e){for(var n=-1,i=t.length,o=0,a=[];++n<i;){var u=t[n];u!==e&&u!==r||(t[n]=r,a[o++]=n);}return a}function ln(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t;})),n}function pn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t];})),n}function dn(t){return un(t)?function(t){for(var e=Yt.lastIndex=0;Yt.test(t);)++e;return e}(t):Ve(t)}function hn(t){return un(t)?function(t){return t.match(Yt)||[]}(t):function(t){return t.split("")}(t)}function vn(t){for(var e=t.length;e--&&rt.test(t.charAt(e)););return e}var gn=Ke({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),yn=function rt(wt){var bt,St=(wt=null==wt?he:yn.defaults(he.Object(),wt,yn.pick(he,ne))).Array,It=wt.Date,Pt=wt.Error,xt=wt.Function,jt=wt.Math,Dt=wt.Object,Et=wt.RegExp,Nt=wt.String,Ot=wt.TypeError,Ct=St.prototype,Tt=xt.prototype,Ut=Dt.prototype,zt=wt["__core-js_shared__"],At=Tt.toString,kt=Ut.hasOwnProperty,Mt=0,Rt=(bt=/[^.]+$/.exec(zt&&zt.keys&&zt.keys.IE_PROTO||""))?"Symbol(src)_1."+bt:"",Vt=Ut.toString,Bt=At.call(Dt),Ft=he._,Wt=Et("^"+At.call(kt).replace(tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lt=ye?wt.Buffer:t,qt=wt.Symbol,Ht=wt.Uint8Array,$t=Lt?Lt.allocUnsafe:t,Kt=cn(Dt.getPrototypeOf,Dt),Gt=Dt.create,Xt=Ut.propertyIsEnumerable,Yt=Ct.splice,te=qt?qt.isConcatSpreadable:t,re=qt?qt.iterator:t,oe=qt?qt.toStringTag:t,ae=function(){try{var t=po(Dt,"defineProperty");return t({},"",{}),t}catch(t){}}(),ce=wt.clearTimeout!==he.clearTimeout&&wt.clearTimeout,pe=It&&It.now!==he.Date.now&&It.now,de=wt.setTimeout!==he.setTimeout&&wt.setTimeout,ve=jt.ceil,ge=jt.floor,_e=Dt.getOwnPropertySymbols,me=Lt?Lt.isBuffer:t,Ve=wt.isFinite,Ke=Ct.join,_n=cn(Dt.keys,Dt),mn=jt.max,wn=jt.min,bn=It.now,Sn=wt.parseInt,In=jt.random,Pn=Ct.reverse,xn=po(wt,"DataView"),jn=po(wt,"Map"),Dn=po(wt,"Promise"),En=po(wt,"Set"),Nn=po(wt,"WeakMap"),On=po(Dt,"create"),Cn=Nn&&new Nn,Tn={},Un=Vo(xn),zn=Vo(jn),An=Vo(Dn),kn=Vo(En),Mn=Vo(Nn),Rn=qt?qt.prototype:t,Vn=Rn?Rn.valueOf:t,Bn=Rn?Rn.toString:t;function Fn(t){if(nu(t)&&!Ha(t)&&!(t instanceof Hn)){if(t instanceof qn)return t;if(kt.call(t,"__wrapped__"))return Bo(t)}return new qn(t)}var Wn=function(){function e(){}return function(n){if(!eu(n))return {};if(Gt)return Gt(n);e.prototype=n;var r=new e;return e.prototype=t,r}}();function Ln(){}function qn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=t;}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=false,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[];}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Kn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Gn;++e<n;)this.add(t[e]);}function Jn(t){var e=this.__data__=new Kn(t);this.size=e.size;}function Zn(t,e){var n=Ha(t),r=!n&&qa(t),i=!n&&!r&&Xa(t),o=!n&&!r&&!i&&fu(t),a=n||r||i||o,u=a?Je(t.length,Nt):[],s=u.length;for(var c in t)!e&&!kt.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wo(c,s))||u.push(c);return u}function Yn(e){var n=e.length;return n?e[Xr(0,n-1)]:t}function Qn(t,e){return ko(Oi(t),sr(e,0,t.length))}function tr(t){return ko(Oi(t))}function er(e,n,r){(r!==t&&!Fa(e[n],r)||r===t&&!(n in e))&&ar(e,n,r);}function nr(e,n,r){var i=e[n];kt.call(e,n)&&Fa(i,r)&&(r!==t||n in e)||ar(e,n,r);}function rr(t,e){for(var n=t.length;n--;)if(Fa(t[n][0],e))return n;return  -1}function ir(t,e,n,r){return dr(t,(function(t,i,o){e(r,t,n(t),o);})),r}function or(t,e){return t&&Ci(e,Tu(e),t)}function ar(t,e,n){"__proto__"==e&&ae?ae(t,e,{configurable:true,enumerable:true,value:n,writable:true}):t[e]=n;}function ur(e,n){for(var r=-1,i=n.length,o=St(i),a=null==e;++r<i;)o[r]=a?t:Du(e,n[r]);return o}function sr(e,n,r){return e==e&&(r!==t&&(e=e<=r?e:r),n!==t&&(e=e>=n?e:n)),e}function cr(e,n,r,i,o,a){var u,s=1&n,c=2&n,f=4&n;if(r&&(u=o?r(e,i,o,a):r(e)),u!==t)return u;if(!eu(e))return e;var l=Ha(e);if(l){if(u=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&kt.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(e),!s)return Oi(e,u)}else {var p=go(e),d=p==m||p==w;if(Xa(e))return Pi(e,s);if(p==I||p==h||d&&!o){if(u=c||d?{}:_o(e),!s)return c?function(t,e){return Ci(t,vo(t),e)}(e,function(t,e){return t&&Ci(e,Uu(e),t)}(u,e)):function(t,e){return Ci(t,ho(t),e)}(e,or(u,e))}else {if(!se[p])return o?e:{};u=function(t,e,n){var r,i=t.constructor;switch(e){case O:return xi(t);case g:case y:return new i(+t);case C:return function(t,e){var n=e?xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case T:case U:case z:case A:case k:case M:case R:case V:case B:return ji(t,n);case b:return new i;case S:case D:return new i(t);case x:return function(t){var e=new t.constructor(t.source,lt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case j:return new i;case E:return r=t,Vn?Dt(Vn.call(r)):{}}}(e,p,s);}}a||(a=new Jn);var v=a.get(e);if(v)return v;a.set(e,u),uu(e)?e.forEach((function(t){u.add(cr(t,n,r,t,e,a));})):ru(e)&&e.forEach((function(t,i){u.set(i,cr(t,n,r,i,e,a));}));var _=l?t:(f?c?oo:io:c?Uu:Tu)(e);return Ee(_||e,(function(t,i){_&&(t=e[i=t]),nr(u,i,cr(t,n,r,i,e,a));})),u}function fr(e,n,r){var i=r.length;if(null==e)return !i;for(e=Dt(e);i--;){var o=r[i],a=n[o],u=e[o];if(u===t&&!(o in e)||!a(u))return  false}return  true}function lr(n,r,i){if("function"!=typeof n)throw new Ot(e);return To((function(){n.apply(t,i);}),r)}function pr(t,e,n,r){var i=-1,o=Te,a=true,u=t.length,s=[],c=e.length;if(!u)return s;n&&(e=ze(e,Ye(n))),r?(o=Ue,a=false):e.length>=200&&(o=tn,a=false,e=new Xn(e));t:for(;++i<u;){var f=t[i],l=null==n?f:n(f);if(f=r||0!==f?f:0,a&&l==l){for(var p=c;p--;)if(e[p]===l)continue t;s.push(f);}else o(e,l,r)||s.push(f);}return s}Fn.templateSettings={escape:G,evaluate:X,interpolate:J,variable:"",imports:{_:Fn}},Fn.prototype=Ln.prototype,Fn.prototype.constructor=Fn,qn.prototype=Wn(Ln.prototype),qn.prototype.constructor=qn,Hn.prototype=Wn(Ln.prototype),Hn.prototype.constructor=Hn,$n.prototype.clear=function(){this.__data__=On?On(null):{},this.size=0;},$n.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},$n.prototype.get=function(e){var r=this.__data__;if(On){var i=r[e];return i===n?t:i}return kt.call(r,e)?r[e]:t},$n.prototype.has=function(e){var n=this.__data__;return On?n[e]!==t:kt.call(n,e)},$n.prototype.set=function(e,r){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=On&&r===t?n:r,this},Kn.prototype.clear=function(){this.__data__=[],this.size=0;},Kn.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return !(n<0||(n==e.length-1?e.pop():Yt.call(e,n,1),--this.size,0))},Kn.prototype.get=function(e){var n=this.__data__,r=rr(n,e);return r<0?t:n[r][1]},Kn.prototype.has=function(t){return rr(this.__data__,t)>-1},Kn.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Gn.prototype.clear=function(){this.size=0,this.__data__={hash:new $n,map:new(jn||Kn),string:new $n};},Gn.prototype.delete=function(t){var e=fo(this,t).delete(t);return this.size-=e?1:0,e},Gn.prototype.get=function(t){return fo(this,t).get(t)},Gn.prototype.has=function(t){return fo(this,t).has(t)},Gn.prototype.set=function(t,e){var n=fo(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Xn.prototype.add=Xn.prototype.push=function(t){return this.__data__.set(t,n),this},Xn.prototype.has=function(t){return this.__data__.has(t)},Jn.prototype.clear=function(){this.__data__=new Kn,this.size=0;},Jn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Jn.prototype.get=function(t){return this.__data__.get(t)},Jn.prototype.has=function(t){return this.__data__.has(t)},Jn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Kn){var r=n.__data__;if(!jn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Gn(r);}return n.set(t,e),this.size=n.size,this};var dr=zi(br),hr=zi(Sr,true);function vr(t,e){var n=true;return dr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function gr(e,n,r){for(var i=-1,o=e.length;++i<o;){var a=e[i],u=n(a);if(null!=u&&(s===t?u==u&&!cu(u):r(u,s)))var s=u,c=a;}return c}function yr(t,e){var n=[];return dr(t,(function(t,r,i){e(t,r,i)&&n.push(t);})),n}function _r(t,e,n,r,i){var o=-1,a=t.length;for(n||(n=mo),i||(i=[]);++o<a;){var u=t[o];e>0&&n(u)?e>1?_r(u,e-1,n,r,i):Ae(i,u):r||(i[i.length]=u);}return i}var mr=Ai(),wr=Ai(true);function br(t,e){return t&&mr(t,e,Tu)}function Sr(t,e){return t&&wr(t,e,Tu)}function Ir(t,e){return Ce(e,(function(e){return Ya(t[e])}))}function Pr(e,n){for(var r=0,i=(n=wi(n,e)).length;null!=e&&r<i;)e=e[Ro(n[r++])];return r&&r==i?e:t}function xr(t,e,n){var r=e(t);return Ha(t)?r:Ae(r,n(t))}function jr(e){return null==e?e===t?"[object Undefined]":"[object Null]":oe&&oe in Dt(e)?function(e){var n=kt.call(e,oe),r=e[oe];try{e[oe]=t;var i=!0;}catch(t){}var o=Vt.call(e);return i&&(n?e[oe]=r:delete e[oe]),o}(e):function(t){return Vt.call(t)}(e)}function Dr(t,e){return t>e}function Er(t,e){return null!=t&&kt.call(t,e)}function Nr(t,e){return null!=t&&e in Dt(t)}function Or(e,n,r){for(var i=r?Ue:Te,o=e[0].length,a=e.length,u=a,s=St(a),c=1/0,f=[];u--;){var l=e[u];u&&n&&(l=ze(l,Ye(n))),c=wn(l.length,c),s[u]=!r&&(n||o>=120&&l.length>=120)?new Xn(u&&l):t;}l=e[0];var p=-1,d=s[0];t:for(;++p<o&&f.length<c;){var h=l[p],v=n?n(h):h;if(h=r||0!==h?h:0,!(d?tn(d,v):i(f,v,r))){for(u=a;--u;){var g=s[u];if(!(g?tn(g,v):i(e[u],v,r)))continue t}d&&d.push(v),f.push(h);}}return f}function Cr(e,n,r){var i=null==(e=No(e,n=wi(n,e)))?e:e[Ro(Zo(n))];return null==i?t:je(i,e,r)}function Tr(t){return nu(t)&&jr(t)==h}function Ur(e,n,r,i,o){return e===n||(null==e||null==n||!nu(e)&&!nu(n)?e!=e&&n!=n:function(e,n,r,i,o,a){var u=Ha(e),s=Ha(n),c=u?v:go(e),f=s?v:go(n),l=(c=c==h?I:c)==I,p=(f=f==h?I:f)==I,d=c==f;if(d&&Xa(e)){if(!Xa(n))return  false;u=true,l=false;}if(d&&!l)return a||(a=new Jn),u||fu(e)?no(e,n,r,i,o,a):function(t,e,n,r,i,o,a){switch(n){case C:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return  false;t=t.buffer,e=e.buffer;case O:return !(t.byteLength!=e.byteLength||!o(new Ht(t),new Ht(e)));case g:case y:case S:return Fa(+t,+e);case _:return t.name==e.name&&t.message==e.message;case x:case D:return t==e+"";case b:var u=sn;case j:var s=1&r;if(u||(u=ln),t.size!=e.size&&!s)return  false;var c=a.get(t);if(c)return c==e;r|=2,a.set(t,e);var f=no(u(t),u(e),r,i,o,a);return a.delete(t),f;case E:if(Vn)return Vn.call(t)==Vn.call(e)}return  false}(e,n,c,r,i,o,a);if(!(1&r)){var m=l&&kt.call(e,"__wrapped__"),w=p&&kt.call(n,"__wrapped__");if(m||w){var P=m?e.value():e,N=w?n.value():n;return a||(a=new Jn),o(P,N,r,i,a)}}return !!d&&(a||(a=new Jn),function(e,n,r,i,o,a){var u=1&r,s=io(e),c=s.length,f=io(n),l=f.length;if(c!=l&&!u)return  false;for(var p=c;p--;){var d=s[p];if(!(u?d in n:kt.call(n,d)))return  false}var h=a.get(e),v=a.get(n);if(h&&v)return h==n&&v==e;var g=true;a.set(e,n),a.set(n,e);for(var y=u;++p<c;){var _=e[d=s[p]],m=n[d];if(i)var w=u?i(m,_,d,n,e,a):i(_,m,d,e,n,a);if(!(w===t?_===m||o(_,m,r,i,a):w)){g=false;break}y||(y="constructor"==d);}if(g&&!y){var b=e.constructor,S=n.constructor;b==S||!("constructor"in e)||!("constructor"in n)||"function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S||(g=false);}return a.delete(e),a.delete(n),g}(e,n,r,i,o,a))}(e,n,r,i,Ur,o))}function zr(e,n,r,i){var o=r.length,a=o,u=!i;if(null==e)return !a;for(e=Dt(e);o--;){var s=r[o];if(u&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return  false}for(;++o<a;){var c=(s=r[o])[0],f=e[c],l=s[1];if(u&&s[2]){if(f===t&&!(c in e))return  false}else {var p=new Jn;if(i)var d=i(f,l,c,e,n,p);if(!(d===t?Ur(l,f,3,i,p):d))return  false}}return  true}function Ar(t){return !(!eu(t)||(e=t,Rt&&Rt in e))&&(Ya(t)?Wt:ht).test(Vo(t));var e;}function kr(t){return "function"==typeof t?t:null==t?is:"object"==typeof t?Ha(t)?Wr(t[0],t[1]):Fr(t):ds(t)}function Mr(t){if(!xo(t))return _n(t);var e=[];for(var n in Dt(t))kt.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Rr(t){if(!eu(t))return function(t){var e=[];if(null!=t)for(var n in Dt(t))e.push(n);return e}(t);var e=xo(t),n=[];for(var r in t)("constructor"!=r||!e&&kt.call(t,r))&&n.push(r);return n}function Vr(t,e){return t<e}function Br(t,e){var n=-1,r=Ka(t)?St(t.length):[];return dr(t,(function(t,i,o){r[++n]=e(t,i,o);})),r}function Fr(t){var e=lo(t);return 1==e.length&&e[0][2]?Do(e[0][0],e[0][1]):function(n){return n===t||zr(n,t,e)}}function Wr(e,n){return So(e)&&jo(n)?Do(Ro(e),n):function(r){var i=Du(r,e);return i===t&&i===n?Eu(r,e):Ur(n,i,3)}}function Lr(e,n,r,i,o){e!==n&&mr(n,(function(a,u){if(o||(o=new Jn),eu(a))!function(e,n,r,i,o,a,u){var s=Oo(e,r),c=Oo(n,r),f=u.get(c);if(f)er(e,r,f);else {var l=a?a(s,c,r+"",e,n,u):t,p=l===t;if(p){var d=Ha(c),h=!d&&Xa(c),v=!d&&!h&&fu(c);l=c,d||h||v?Ha(s)?l=s:Ga(s)?l=Oi(s):h?(p=false,l=Pi(c,true)):v?(p=false,l=ji(c,true)):l=[]:ou(c)||qa(c)?(l=s,qa(s)?l=_u(s):eu(s)&&!Ya(s)||(l=_o(c))):p=false;}p&&(u.set(c,l),o(l,c,i,a,u),u.delete(c)),er(e,r,l);}}(e,n,u,r,Lr,i,o);else {var s=i?i(Oo(e,u),a,u+"",e,n,o):t;s===t&&(s=a),er(e,u,s);}}),Uu);}function qr(e,n){var r=e.length;if(r)return wo(n+=n<0?r:0,r)?e[n]:t}function Hr(t,e,n){e=e.length?ze(e,(function(t){return Ha(t)?function(e){return Pr(e,1===t.length?t[0]:t)}:t})):[is];var r=-1;e=ze(e,Ye(co()));var i=Br(t,(function(t,n,i){var o=ze(e,(function(e){return e(t)}));return {criteria:o,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,o=e.criteria,a=i.length,u=n.length;++r<a;){var s=Di(i[r],o[r]);if(s)return r>=u?s:s*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function $r(t,e,n){for(var r=-1,i=e.length,o={};++r<i;){var a=e[r],u=Pr(t,a);n(u,a)&&ti(o,wi(a,t),u);}return o}function Kr(t,e,n,r){var i=r?Le:We,o=-1,a=e.length,u=t;for(t===e&&(e=Oi(e)),n&&(u=ze(t,Ye(n)));++o<a;)for(var s=0,c=e[o],f=n?n(c):c;(s=i(u,f,s,r))>-1;)u!==t&&Yt.call(u,s,1),Yt.call(t,s,1);return t}function Gr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==o){var o=i;wo(i)?Yt.call(t,i,1):pi(t,i);}}return t}function Xr(t,e){return t+ge(In()*(e-t+1))}function Jr(t,e){var n="";if(!t||e<1||e>f)return n;do{e%2&&(n+=t),(e=ge(e/2))&&(t+=t);}while(e);return n}function Zr(t,e){return Uo(Eo(t,e,is),t+"")}function Yr(t){return Yn(Fu(t))}function Qr(t,e){var n=Fu(t);return ko(n,sr(e,0,n.length))}function ti(e,n,r,i){if(!eu(e))return e;for(var o=-1,a=(n=wi(n,e)).length,u=a-1,s=e;null!=s&&++o<a;){var c=Ro(n[o]),f=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(o!=u){var l=s[c];(f=i?i(l,c,s):t)===t&&(f=eu(l)?l:wo(n[o+1])?[]:{});}nr(s,c,f),s=s[c];}return e}var ei=Cn?function(t,e){return Cn.set(t,e),t}:is,ni=ae?function(t,e){return ae(t,"toString",{configurable:true,enumerable:false,value:es(e),writable:true})}:is;function ri(t){return ko(Fu(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=St(i);++r<i;)o[r]=t[r+e];return o}function oi(t,e){var n;return dr(t,(function(t,r,i){return !(n=e(t,r,i))})),!!n}function ai(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=t[o];null!==a&&!cu(a)&&(n?a<=e:a<e)?r=o+1:i=o;}return i}return ui(t,e,is,n)}function ui(e,n,r,i){var o=0,a=null==e?0:e.length;if(0===a)return 0;for(var u=(n=r(n))!=n,s=null===n,c=cu(n),f=n===t;o<a;){var l=ge((o+a)/2),p=r(e[l]),d=p!==t,h=null===p,v=p==p,g=cu(p);if(u)var y=i||v;else y=f?v&&(i||d):s?v&&d&&(i||!h):c?v&&d&&!h&&(i||!g):!h&&!g&&(i?p<=n:p<n);y?o=l+1:a=l;}return wn(a,4294967294)}function si(t,e){for(var n=-1,r=t.length,i=0,o=[];++n<r;){var a=t[n],u=e?e(a):a;if(!n||!Fa(u,s)){var s=u;o[i++]=0===a?0:a;}}return o}function ci(t){return "number"==typeof t?t:cu(t)?l:+t}function fi(t){if("string"==typeof t)return t;if(Ha(t))return ze(t,fi)+"";if(cu(t))return Bn?Bn.call(t):"";var e=t+"";return "0"==e&&1/t==-1/0?"-0":e}function li(t,e,n){var r=-1,i=Te,o=t.length,a=true,u=[],s=u;if(n)a=false,i=Ue;else if(o>=200){var c=e?null:Ji(t);if(c)return ln(c);a=false,i=tn,s=new Xn;}else s=e?[]:u;t:for(;++r<o;){var f=t[r],l=e?e(f):f;if(f=n||0!==f?f:0,a&&l==l){for(var p=s.length;p--;)if(s[p]===l)continue t;e&&s.push(l),u.push(f);}else i(s,l,n)||(s!==u&&s.push(l),u.push(f));}return u}function pi(t,e){return null==(t=No(t,e=wi(e,t)))||delete t[Ro(Zo(e))]}function di(t,e,n,r){return ti(t,e,n(Pr(t,e)),r)}function hi(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?ii(t,r?0:o,r?o+1:i):ii(t,r?o+1:0,r?i:o)}function vi(t,e){var n=t;return n instanceof Hn&&(n=n.value()),ke(e,(function(t,e){return e.func.apply(e.thisArg,Ae([t],e.args))}),n)}function gi(t,e,n){var r=t.length;if(r<2)return r?li(t[0]):[];for(var i=-1,o=St(r);++i<r;)for(var a=t[i],u=-1;++u<r;)u!=i&&(o[i]=pr(o[i]||a,t[u],e,n));return li(_r(o,1),e,n)}function yi(e,n,r){for(var i=-1,o=e.length,a=n.length,u={};++i<o;){var s=i<a?n[i]:t;r(u,e[i],s);}return u}function _i(t){return Ga(t)?t:[]}function mi(t){return "function"==typeof t?t:is}function wi(t,e){return Ha(t)?t:So(t,e)?[t]:Mo(mu(t))}var bi=Zr;function Si(e,n,r){var i=e.length;return r=r===t?i:r,!n&&r>=i?e:ii(e,n,r)}var Ii=ce||function(t){return he.clearTimeout(t)};function Pi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function xi(t){var e=new t.constructor(t.byteLength);return new Ht(e).set(new Ht(t)),e}function ji(t,e){var n=e?xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Di(e,n){if(e!==n){var r=e!==t,i=null===e,o=e==e,a=cu(e),u=n!==t,s=null===n,c=n==n,f=cu(n);if(!s&&!f&&!a&&e>n||a&&u&&c&&!s&&!f||i&&u&&c||!r&&c||!o)return 1;if(!i&&!a&&!f&&e<n||f&&r&&o&&!i&&!a||s&&r&&o||!u&&o||!c)return  -1}return 0}function Ei(t,e,n,r){for(var i=-1,o=t.length,a=n.length,u=-1,s=e.length,c=mn(o-a,0),f=St(s+c),l=!r;++u<s;)f[u]=e[u];for(;++i<a;)(l||i<o)&&(f[n[i]]=t[i]);for(;c--;)f[u++]=t[i++];return f}function Ni(t,e,n,r){for(var i=-1,o=t.length,a=-1,u=n.length,s=-1,c=e.length,f=mn(o-u,0),l=St(f+c),p=!r;++i<f;)l[i]=t[i];for(var d=i;++s<c;)l[d+s]=e[s];for(;++a<u;)(p||i<o)&&(l[d+n[a]]=t[i++]);return l}function Oi(t,e){var n=-1,r=t.length;for(e||(e=St(r));++n<r;)e[n]=t[n];return e}function Ci(e,n,r,i){var o=!r;r||(r={});for(var a=-1,u=n.length;++a<u;){var s=n[a],c=i?i(r[s],e[s],s,r,e):t;c===t&&(c=e[s]),o?ar(r,s,c):nr(r,s,c);}return r}function Ti(t,e){return function(n,r){var i=Ha(n)?De:ir,o=e?e():{};return i(n,t,co(r,2),o)}}function Ui(e){return Zr((function(n,r){var i=-1,o=r.length,a=o>1?r[o-1]:t,u=o>2?r[2]:t;for(a=e.length>3&&"function"==typeof a?(o--,a):t,u&&bo(r[0],r[1],u)&&(a=o<3?t:a,o=1),n=Dt(n);++i<o;){var s=r[i];s&&e(n,s,i,a);}return n}))}function zi(t,e){return function(n,r){if(null==n)return n;if(!Ka(n))return t(n,r);for(var i=n.length,o=e?i:-1,a=Dt(n);(e?o--:++o<i)&&false!==r(a[o],o,a););return n}}function Ai(t){return function(e,n,r){for(var i=-1,o=Dt(e),a=r(e),u=a.length;u--;){var s=a[t?u:++i];if(false===n(o[s],s,o))break}return e}}function ki(e){return function(n){var r=un(n=mu(n))?hn(n):t,i=r?r[0]:n.charAt(0),o=r?Si(r,1).join(""):n.slice(1);return i[e]()+o}}function Mi(t){return function(e){return ke(Yu(qu(e).replace(Jt,"")),t,"")}}function Ri(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Wn(t.prototype),r=t.apply(n,e);return eu(r)?r:n}}function Vi(e){return function(n,r,i){var o=Dt(n);if(!Ka(n)){var a=co(r,3);n=Tu(n),r=function(t){return a(o[t],t,o)};}var u=e(n,r,i);return u>-1?o[a?n[u]:u]:t}}function Bi(n){return ro((function(r){var i=r.length,o=i,a=qn.prototype.thru;for(n&&r.reverse();o--;){var u=r[o];if("function"!=typeof u)throw new Ot(e);if(a&&!s&&"wrapper"==uo(u))var s=new qn([],true);}for(o=s?o:i;++o<i;){var c=uo(u=r[o]),f="wrapper"==c?ao(u):t;s=f&&Io(f[0])&&424==f[1]&&!f[4].length&&1==f[9]?s[uo(f[0])].apply(s,f[3]):1==u.length&&Io(u)?s[c]():s.thru(u);}return function(){var t=arguments,e=t[0];if(s&&1==t.length&&Ha(e))return s.plant(e).value();for(var n=0,o=i?r[n].apply(this,t):e;++n<i;)o=r[n].call(this,o);return o}}))}function Fi(e,n,r,i,o,a,s,c,f,l){var p=n&u,d=1&n,h=2&n,v=24&n,g=512&n,y=h?t:Ri(e);return function u(){for(var _=arguments.length,m=St(_),w=_;w--;)m[w]=arguments[w];if(v)var b=so(u),S=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(m,b);if(i&&(m=Ei(m,i,o,v)),a&&(m=Ni(m,a,s,v)),_-=S,v&&_<l){var I=fn(m,b);return Gi(e,n,Fi,u.placeholder,r,m,I,c,f,l-_)}var P=d?r:this,x=h?P[e]:e;return _=m.length,c?m=function(e,n){for(var r=e.length,i=wn(n.length,r),o=Oi(e);i--;){var a=n[i];e[i]=wo(a,r)?o[a]:t;}return e}(m,c):g&&_>1&&m.reverse(),p&&f<_&&(m.length=f),this&&this!==he&&this instanceof u&&(x=y||Ri(x)),x.apply(P,m)}}function Wi(t,e){return function(n,r){return function(t,e,n,r){return br(t,(function(t,i,o){e(r,n(t),i,o);})),r}(n,t,e(r),{})}}function Li(e,n){return function(r,i){var o;if(r===t&&i===t)return n;if(r!==t&&(o=r),i!==t){if(o===t)return i;"string"==typeof r||"string"==typeof i?(r=fi(r),i=fi(i)):(r=ci(r),i=ci(i)),o=e(r,i);}return o}}function qi(t){return ro((function(e){return e=ze(e,Ye(co())),Zr((function(n){var r=this;return t(e,(function(t){return je(t,r,n)}))}))}))}function Hi(e,n){var r=(n=n===t?" ":fi(n)).length;if(r<2)return r?Jr(n,e):n;var i=Jr(n,ve(e/dn(n)));return un(n)?Si(hn(i),0,e).join(""):i.slice(0,e)}function $i(e){return function(n,r,i){return i&&"number"!=typeof i&&bo(n,r,i)&&(r=i=t),n=hu(n),r===t?(r=n,n=0):r=hu(r),function(t,e,n,r){for(var i=-1,o=mn(ve((e-t)/(n||1)),0),a=St(o);o--;)a[r?o:++i]=t,t+=n;return a}(n,r,i=i===t?n<r?1:-1:hu(i),e)}}function Ki(t){return function(e,n){return "string"==typeof e&&"string"==typeof n||(e=yu(e),n=yu(n)),t(e,n)}}function Gi(e,n,r,i,u,s,c,f,l,p){var d=8&n;n|=d?o:a,4&(n&=~(d?a:o))||(n&=-4);var h=[e,n,u,d?s:t,d?c:t,d?t:s,d?t:c,f,l,p],v=r.apply(t,h);return Io(e)&&Co(v,h),v.placeholder=i,zo(v,e,n)}function Xi(t){var e=jt[t];return function(t,n){if(t=yu(t),(n=null==n?0:wn(vu(n),292))&&Ve(t)){var r=(mu(t)+"e").split("e");return +((r=(mu(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Ji=En&&1/ln(new En([,-0]))[1]==c?function(t){return new En(t)}:cs;function Zi(t){return function(e){var n=go(e);return n==b?sn(e):n==j?pn(e):function(t,e){return ze(e,(function(e){return [e,t[e]]}))}(e,t(e))}}function Yi(n,c,f,l,p,d,h,v){var g=2&c;if(!g&&"function"!=typeof n)throw new Ot(e);var y=l?l.length:0;if(y||(c&=-97,l=p=t),h=h===t?h:mn(vu(h),0),v=v===t?v:vu(v),y-=p?p.length:0,c&a){var _=l,m=p;l=p=t;}var w=g?t:ao(n),b=[n,c,f,l,p,_,m,d,h,v];if(w&&function(t,e){var n=t[1],i=e[1],o=n|i,a=o<131,c=i==u&&8==n||i==u&&n==s&&t[7].length<=e[8]||384==i&&e[7].length<=e[8]&&8==n;if(!a&&!c)return t;1&i&&(t[2]=e[2],o|=1&n?0:4);var f=e[3];if(f){var l=t[3];t[3]=l?Ei(l,f,e[4]):f,t[4]=l?fn(t[3],r):e[4];}(f=e[5])&&(l=t[5],t[5]=l?Ni(l,f,e[6]):f,t[6]=l?fn(t[5],r):e[6]),(f=e[7])&&(t[7]=f),i&u&&(t[8]=null==t[8]?e[8]:wn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=o;}(b,w),n=b[0],c=b[1],f=b[2],l=b[3],p=b[4],!(v=b[9]=b[9]===t?g?0:n.length:mn(b[9]-y,0))&&24&c&&(c&=-25),c&&1!=c)S=8==c||c==i?function(e,n,r){var i=Ri(e);return function o(){for(var a=arguments.length,u=St(a),s=a,c=so(o);s--;)u[s]=arguments[s];var f=a<3&&u[0]!==c&&u[a-1]!==c?[]:fn(u,c);return (a-=f.length)<r?Gi(e,n,Fi,o.placeholder,t,u,f,t,t,r-a):je(this&&this!==he&&this instanceof o?i:e,this,u)}}(n,c,v):c!=o&&33!=c||p.length?Fi.apply(t,b):function(t,e,n,r){var i=1&e,o=Ri(t);return function e(){for(var a=-1,u=arguments.length,s=-1,c=r.length,f=St(c+u),l=this&&this!==he&&this instanceof e?o:t;++s<c;)f[s]=r[s];for(;u--;)f[s++]=arguments[++a];return je(l,i?n:this,f)}}(n,c,f,l);else var S=function(t,e,n){var r=1&e,i=Ri(t);return function e(){return (this&&this!==he&&this instanceof e?i:t).apply(r?n:this,arguments)}}(n,c,f);return zo((w?ei:Co)(S,b),n,c)}function Qi(e,n,r,i){return e===t||Fa(e,Ut[r])&&!kt.call(i,r)?n:e}function to(e,n,r,i,o,a){return eu(e)&&eu(n)&&(a.set(n,e),Lr(e,n,t,to,a),a.delete(n)),e}function eo(e){return ou(e)?t:e}function no(e,n,r,i,o,a){var u=1&r,s=e.length,c=n.length;if(s!=c&&!(u&&c>s))return  false;var f=a.get(e),l=a.get(n);if(f&&l)return f==n&&l==e;var p=-1,d=true,h=2&r?new Xn:t;for(a.set(e,n),a.set(n,e);++p<s;){var v=e[p],g=n[p];if(i)var y=u?i(g,v,p,n,e,a):i(v,g,p,e,n,a);if(y!==t){if(y)continue;d=false;break}if(h){if(!Re(n,(function(t,e){if(!tn(h,e)&&(v===t||o(v,t,r,i,a)))return h.push(e)}))){d=false;break}}else if(v!==g&&!o(v,g,r,i,a)){d=false;break}}return a.delete(e),a.delete(n),d}function ro(e){return Uo(Eo(e,t,$o),e+"")}function io(t){return xr(t,Tu,ho)}function oo(t){return xr(t,Uu,vo)}var ao=Cn?function(t){return Cn.get(t)}:cs;function uo(t){for(var e=t.name+"",n=Tn[e],r=kt.call(Tn,e)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function so(t){return (kt.call(Fn,"placeholder")?Fn:t).placeholder}function co(){var t=Fn.iteratee||os;return t=t===os?kr:t,arguments.length?t(arguments[0],arguments[1]):t}function fo(t,e){var n,r,i=t.__data__;return ("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function lo(t){for(var e=Tu(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,jo(i)];}return e}function po(e,n){var r=function(e,n){return null==e?t:e[n]}(e,n);return Ar(r)?r:t}var ho=_e?function(t){return null==t?[]:(t=Dt(t),Ce(_e(t),(function(e){return Xt.call(t,e)})))}:gs,vo=_e?function(t){for(var e=[];t;)Ae(e,ho(t)),t=Kt(t);return e}:gs,go=jr;function yo(t,e,n){for(var r=-1,i=(e=wi(e,t)).length,o=false;++r<i;){var a=Ro(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a];}return o||++r!=i?o:!!(i=null==t?0:t.length)&&tu(i)&&wo(a,i)&&(Ha(t)||qa(t))}function _o(t){return "function"!=typeof t.constructor||xo(t)?{}:Wn(Kt(t))}function mo(t){return Ha(t)||qa(t)||!!(te&&t&&t[te])}function wo(t,e){var n=typeof t;return !!(e=null==e?f:e)&&("number"==n||"symbol"!=n&&gt.test(t))&&t>-1&&t%1==0&&t<e}function bo(t,e,n){if(!eu(n))return  false;var r=typeof e;return !!("number"==r?Ka(n)&&wo(e,n.length):"string"==r&&e in n)&&Fa(n[e],t)}function So(t,e){if(Ha(t))return  false;var n=typeof t;return !("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!cu(t))||Y.test(t)||!Z.test(t)||null!=e&&t in Dt(e)}function Io(t){var e=uo(t),n=Fn[e];if("function"!=typeof n||!(e in Hn.prototype))return  false;if(t===n)return  true;var r=ao(n);return !!r&&t===r[0]}(xn&&go(new xn(new ArrayBuffer(1)))!=C||jn&&go(new jn)!=b||Dn&&go(Dn.resolve())!=P||En&&go(new En)!=j||Nn&&go(new Nn)!=N)&&(go=function(e){var n=jr(e),r=n==I?e.constructor:t,i=r?Vo(r):"";if(i)switch(i){case Un:return C;case zn:return b;case An:return P;case kn:return j;case Mn:return N}return n});var Po=zt?Ya:ys;function xo(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ut)}function jo(t){return t==t&&!eu(t)}function Do(e,n){return function(r){return null!=r&&r[e]===n&&(n!==t||e in Dt(r))}}function Eo(e,n,r){return n=mn(n===t?e.length-1:n,0),function(){for(var t=arguments,i=-1,o=mn(t.length-n,0),a=St(o);++i<o;)a[i]=t[n+i];i=-1;for(var u=St(n+1);++i<n;)u[i]=t[i];return u[n]=r(a),je(e,this,u)}}function No(t,e){return e.length<2?t:Pr(t,ii(e,0,-1))}function Oo(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Co=Ao(ei),To=de||function(t,e){return he.setTimeout(t,e)},Uo=Ao(ni);function zo(t,e,n){var r=e+"";return Uo(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(it,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Ee(d,(function(n){var r="_."+n[0];e&n[1]&&!Te(t,r)&&t.push(r);})),t.sort()}(function(t){var e=t.match(ot);return e?e[1].split(at):[]}(r),n)))}function Ao(e){var n=0,r=0;return function(){var i=bn(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(t,arguments)}}function ko(e,n){var r=-1,i=e.length,o=i-1;for(n=n===t?i:n;++r<n;){var a=Xr(r,o),u=e[a];e[a]=e[r],e[r]=u;}return e.length=n,e}var Mo=function(t){var e=Aa(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,(function(t,n,r,i){e.push(r?i.replace(ct,"$1"):n||t);})),e}));function Ro(t){if("string"==typeof t||cu(t))return t;var e=t+"";return "0"==e&&1/t==-1/0?"-0":e}function Vo(t){if(null!=t){try{return At.call(t)}catch(t){}try{return t+""}catch(t){}}return ""}function Bo(t){if(t instanceof Hn)return t.clone();var e=new qn(t.__wrapped__,t.__chain__);return e.__actions__=Oi(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Fo=Zr((function(t,e){return Ga(t)?pr(t,_r(e,1,Ga,true)):[]})),Wo=Zr((function(e,n){var r=Zo(n);return Ga(r)&&(r=t),Ga(e)?pr(e,_r(n,1,Ga,true),co(r,2)):[]})),Lo=Zr((function(e,n){var r=Zo(n);return Ga(r)&&(r=t),Ga(e)?pr(e,_r(n,1,Ga,true),t,r):[]}));function qo(t,e,n){var r=null==t?0:t.length;if(!r)return  -1;var i=null==n?0:vu(n);return i<0&&(i=mn(r+i,0)),Fe(t,co(e,3),i)}function Ho(e,n,r){var i=null==e?0:e.length;if(!i)return  -1;var o=i-1;return r!==t&&(o=vu(r),o=r<0?mn(i+o,0):wn(o,i-1)),Fe(e,co(n,3),o,true)}function $o(t){return null!=t&&t.length?_r(t,1):[]}function Ko(e){return e&&e.length?e[0]:t}var Go=Zr((function(t){var e=ze(t,_i);return e.length&&e[0]===t[0]?Or(e):[]})),Xo=Zr((function(e){var n=Zo(e),r=ze(e,_i);return n===Zo(r)?n=t:r.pop(),r.length&&r[0]===e[0]?Or(r,co(n,2)):[]})),Jo=Zr((function(e){var n=Zo(e),r=ze(e,_i);return (n="function"==typeof n?n:t)&&r.pop(),r.length&&r[0]===e[0]?Or(r,t,n):[]}));function Zo(e){var n=null==e?0:e.length;return n?e[n-1]:t}var Yo=Zr(Qo);function Qo(t,e){return t&&t.length&&e&&e.length?Kr(t,e):t}var ta=ro((function(t,e){var n=null==t?0:t.length,r=ur(t,e);return Gr(t,ze(e,(function(t){return wo(t,n)?+t:t})).sort(Di)),r}));function ea(t){return null==t?t:Pn.call(t)}var na=Zr((function(t){return li(_r(t,1,Ga,true))})),ra=Zr((function(e){var n=Zo(e);return Ga(n)&&(n=t),li(_r(e,1,Ga,true),co(n,2))})),ia=Zr((function(e){var n=Zo(e);return n="function"==typeof n?n:t,li(_r(e,1,Ga,true),t,n)}));function oa(t){if(!t||!t.length)return [];var e=0;return t=Ce(t,(function(t){if(Ga(t))return e=mn(t.length,e),true})),Je(e,(function(e){return ze(t,$e(e))}))}function aa(e,n){if(!e||!e.length)return [];var r=oa(e);return null==n?r:ze(r,(function(e){return je(n,t,e)}))}var ua=Zr((function(t,e){return Ga(t)?pr(t,e):[]})),sa=Zr((function(t){return gi(Ce(t,Ga))})),ca=Zr((function(e){var n=Zo(e);return Ga(n)&&(n=t),gi(Ce(e,Ga),co(n,2))})),fa=Zr((function(e){var n=Zo(e);return n="function"==typeof n?n:t,gi(Ce(e,Ga),t,n)})),la=Zr(oa),pa=Zr((function(e){var n=e.length,r=n>1?e[n-1]:t;return r="function"==typeof r?(e.pop(),r):t,aa(e,r)}));function da(t){var e=Fn(t);return e.__chain__=true,e}function ha(t,e){return e(t)}var va=ro((function(e){var n=e.length,r=n?e[0]:0,i=this.__wrapped__,o=function(t){return ur(t,e)};return !(n>1||this.__actions__.length)&&i instanceof Hn&&wo(r)?((i=i.slice(r,+r+(n?1:0))).__actions__.push({func:ha,args:[o],thisArg:t}),new qn(i,this.__chain__).thru((function(e){return n&&!e.length&&e.push(t),e}))):this.thru(o)})),ga=Ti((function(t,e,n){kt.call(t,n)?++t[n]:ar(t,n,1);})),ya=Vi(qo),_a=Vi(Ho);function ma(t,e){return (Ha(t)?Ee:dr)(t,co(e,3))}function wa(t,e){return (Ha(t)?Ne:hr)(t,co(e,3))}var ba=Ti((function(t,e,n){kt.call(t,n)?t[n].push(e):ar(t,n,[e]);})),Sa=Zr((function(t,e,n){var r=-1,i="function"==typeof e,o=Ka(t)?St(t.length):[];return dr(t,(function(t){o[++r]=i?je(e,t,n):Cr(t,e,n);})),o})),Ia=Ti((function(t,e,n){ar(t,n,e);}));function Pa(t,e){return (Ha(t)?ze:Br)(t,co(e,3))}var xa=Ti((function(t,e,n){t[n?0:1].push(e);}),(function(){return [[],[]]})),ja=Zr((function(t,e){if(null==t)return [];var n=e.length;return n>1&&bo(t,e[0],e[1])?e=[]:n>2&&bo(e[0],e[1],e[2])&&(e=[e[0]]),Hr(t,_r(e,1),[])})),Da=pe||function(){return he.Date.now()};function Ea(e,n,r){return n=r?t:n,n=e&&null==n?e.length:n,Yi(e,u,t,t,t,t,n)}function Na(n,r){var i;if("function"!=typeof r)throw new Ot(e);return n=vu(n),function(){return --n>0&&(i=r.apply(this,arguments)),n<=1&&(r=t),i}}var Oa=Zr((function(t,e,n){var r=1;if(n.length){var i=fn(n,so(Oa));r|=o;}return Yi(t,r,e,n,i)})),Ca=Zr((function(t,e,n){var r=3;if(n.length){var i=fn(n,so(Ca));r|=o;}return Yi(e,r,t,n,i)}));function Ta(n,r,i){var o,a,u,s,c,f,l=0,p=false,d=false,h=true;if("function"!=typeof n)throw new Ot(e);function v(e){var r=o,i=a;return o=a=t,l=e,s=n.apply(i,r)}function g(e){var n=e-f;return f===t||n>=r||n<0||d&&e-l>=u}function y(){var t=Da();if(g(t))return _(t);c=To(y,function(t){var e=r-(t-f);return d?wn(e,u-(t-l)):e}(t));}function _(e){return c=t,h&&o?v(e):(o=a=t,s)}function m(){var e=Da(),n=g(e);if(o=arguments,a=this,f=e,n){if(c===t)return function(t){return l=t,c=To(y,r),p?v(t):s}(f);if(d)return Ii(c),c=To(y,r),v(f)}return c===t&&(c=To(y,r)),s}return r=yu(r)||0,eu(i)&&(p=!!i.leading,u=(d="maxWait"in i)?mn(yu(i.maxWait)||0,r):u,h="trailing"in i?!!i.trailing:h),m.cancel=function(){c!==t&&Ii(c),l=0,o=f=a=c=t;},m.flush=function(){return c===t?s:_(Da())},m}var Ua=Zr((function(t,e){return lr(t,1,e)})),za=Zr((function(t,e,n){return lr(t,yu(e)||0,n)}));function Aa(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new Ot(e);var r=function(){var e=arguments,i=n?n.apply(this,e):e[0],o=r.cache;if(o.has(i))return o.get(i);var a=t.apply(this,e);return r.cache=o.set(i,a)||o,a};return r.cache=new(Aa.Cache||Gn),r}function ka(t){if("function"!=typeof t)throw new Ot(e);return function(){var e=arguments;switch(e.length){case 0:return !t.call(this);case 1:return !t.call(this,e[0]);case 2:return !t.call(this,e[0],e[1]);case 3:return !t.call(this,e[0],e[1],e[2])}return !t.apply(this,e)}}Aa.Cache=Gn;var Ma=bi((function(t,e){var n=(e=1==e.length&&Ha(e[0])?ze(e[0],Ye(co())):ze(_r(e,1),Ye(co()))).length;return Zr((function(r){for(var i=-1,o=wn(r.length,n);++i<o;)r[i]=e[i].call(this,r[i]);return je(t,this,r)}))})),Ra=Zr((function(e,n){var r=fn(n,so(Ra));return Yi(e,o,t,n,r)})),Va=Zr((function(e,n){var r=fn(n,so(Va));return Yi(e,a,t,n,r)})),Ba=ro((function(e,n){return Yi(e,s,t,t,t,n)}));function Fa(t,e){return t===e||t!=t&&e!=e}var Wa=Ki(Dr),La=Ki((function(t,e){return t>=e})),qa=Tr(function(){return arguments}())?Tr:function(t){return nu(t)&&kt.call(t,"callee")&&!Xt.call(t,"callee")},Ha=St.isArray,$a=we?Ye(we):function(t){return nu(t)&&jr(t)==O};function Ka(t){return null!=t&&tu(t.length)&&!Ya(t)}function Ga(t){return nu(t)&&Ka(t)}var Xa=me||ys,Ja=be?Ye(be):function(t){return nu(t)&&jr(t)==y};function Za(t){if(!nu(t))return  false;var e=jr(t);return e==_||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!ou(t)}function Ya(t){if(!eu(t))return  false;var e=jr(t);return e==m||e==w||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qa(t){return "number"==typeof t&&t==vu(t)}function tu(t){return "number"==typeof t&&t>-1&&t%1==0&&t<=f}function eu(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function nu(t){return null!=t&&"object"==typeof t}var ru=Se?Ye(Se):function(t){return nu(t)&&go(t)==b};function iu(t){return "number"==typeof t||nu(t)&&jr(t)==S}function ou(t){if(!nu(t)||jr(t)!=I)return  false;var e=Kt(t);if(null===e)return  true;var n=kt.call(e,"constructor")&&e.constructor;return "function"==typeof n&&n instanceof n&&At.call(n)==Bt}var au=Ie?Ye(Ie):function(t){return nu(t)&&jr(t)==x},uu=Pe?Ye(Pe):function(t){return nu(t)&&go(t)==j};function su(t){return "string"==typeof t||!Ha(t)&&nu(t)&&jr(t)==D}function cu(t){return "symbol"==typeof t||nu(t)&&jr(t)==E}var fu=xe?Ye(xe):function(t){return nu(t)&&tu(t.length)&&!!ue[jr(t)]},lu=Ki(Vr),pu=Ki((function(t,e){return t<=e}));function du(t){if(!t)return [];if(Ka(t))return su(t)?hn(t):Oi(t);if(re&&t[re])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[re]());var e=go(t);return (e==b?sn:e==j?ln:Fu)(t)}function hu(t){return t?(t=yu(t))===c||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function vu(t){var e=hu(t),n=e%1;return e==e?n?e-n:e:0}function gu(t){return t?sr(vu(t),0,p):0}function yu(t){if("number"==typeof t)return t;if(cu(t))return l;if(eu(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=eu(e)?e+"":e;}if("string"!=typeof t)return 0===t?t:+t;t=Ze(t);var n=dt.test(t);return n||vt.test(t)?le(t.slice(2),n?2:8):pt.test(t)?l:+t}function _u(t){return Ci(t,Uu(t))}function mu(t){return null==t?"":fi(t)}var wu=Ui((function(t,e){if(xo(e)||Ka(e))Ci(e,Tu(e),t);else for(var n in e)kt.call(e,n)&&nr(t,n,e[n]);})),bu=Ui((function(t,e){Ci(e,Uu(e),t);})),Su=Ui((function(t,e,n,r){Ci(e,Uu(e),t,r);})),Iu=Ui((function(t,e,n,r){Ci(e,Tu(e),t,r);})),Pu=ro(ur),xu=Zr((function(e,n){e=Dt(e);var r=-1,i=n.length,o=i>2?n[2]:t;for(o&&bo(n[0],n[1],o)&&(i=1);++r<i;)for(var a=n[r],u=Uu(a),s=-1,c=u.length;++s<c;){var f=u[s],l=e[f];(l===t||Fa(l,Ut[f])&&!kt.call(e,f))&&(e[f]=a[f]);}return e})),ju=Zr((function(e){return e.push(t,to),je(Au,t,e)}));function Du(e,n,r){var i=null==e?t:Pr(e,n);return i===t?r:i}function Eu(t,e){return null!=t&&yo(t,e,Nr)}var Nu=Wi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Vt.call(e)),t[e]=n;}),es(is)),Ou=Wi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Vt.call(e)),kt.call(t,e)?t[e].push(n):t[e]=[n];}),co),Cu=Zr(Cr);function Tu(t){return Ka(t)?Zn(t):Mr(t)}function Uu(t){return Ka(t)?Zn(t,true):Rr(t)}var zu=Ui((function(t,e,n){Lr(t,e,n);})),Au=Ui((function(t,e,n,r){Lr(t,e,n,r);})),ku=ro((function(t,e){var n={};if(null==t)return n;var r=false;e=ze(e,(function(e){return e=wi(e,t),r||(r=e.length>1),e})),Ci(t,oo(t),n),r&&(n=cr(n,7,eo));for(var i=e.length;i--;)pi(n,e[i]);return n})),Mu=ro((function(t,e){return null==t?{}:function(t,e){return $r(t,e,(function(e,n){return Eu(t,n)}))}(t,e)}));function Ru(t,e){if(null==t)return {};var n=ze(oo(t),(function(t){return [t]}));return e=co(e),$r(t,n,(function(t,n){return e(t,n[0])}))}var Vu=Zi(Tu),Bu=Zi(Uu);function Fu(t){return null==t?[]:Qe(t,Tu(t))}var Wu=Mi((function(t,e,n){return e=e.toLowerCase(),t+(n?Lu(e):e)}));function Lu(t){return Zu(mu(t).toLowerCase())}function qu(t){return (t=mu(t))&&t.replace(yt,rn).replace(Zt,"")}var Hu=Mi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),$u=Mi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Ku=ki("toLowerCase"),Gu=Mi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Xu=Mi((function(t,e,n){return t+(n?" ":"")+Zu(e)})),Ju=Mi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Zu=ki("toUpperCase");function Yu(e,n,r){return e=mu(e),(n=r?t:n)===t?function(t){return ee.test(t)}(e)?function(t){return t.match(Qt)||[]}(e):function(t){return t.match(ut)||[]}(e):e.match(n)||[]}var Qu=Zr((function(e,n){try{return je(e,t,n)}catch(t){return Za(t)?t:new Pt(t)}})),ts=ro((function(t,e){return Ee(e,(function(e){e=Ro(e),ar(t,e,Oa(t[e],t));})),t}));function es(t){return function(){return t}}var ns=Bi(),rs=Bi(true);function is(t){return t}function os(t){return kr("function"==typeof t?t:cr(t,1))}var as=Zr((function(t,e){return function(n){return Cr(n,t,e)}})),us=Zr((function(t,e){return function(n){return Cr(t,n,e)}}));function ss(t,e,n){var r=Tu(e),i=Ir(e,r);null!=n||eu(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Ir(e,Tu(e)));var o=!(eu(n)&&"chain"in n&&!n.chain),a=Ya(t);return Ee(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__);return (n.__actions__=Oi(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Ae([this.value()],arguments))});})),t}function cs(){}var fs=qi(ze),ls=qi(Oe),ps=qi(Re);function ds(t){return So(t)?$e(Ro(t)):function(t){return function(e){return Pr(e,t)}}(t)}var hs=$i(),vs=$i(true);function gs(){return []}function ys(){return  false}var _s,ms=Li((function(t,e){return t+e}),0),ws=Xi("ceil"),bs=Li((function(t,e){return t/e}),1),Ss=Xi("floor"),Is=Li((function(t,e){return t*e}),1),Ps=Xi("round"),xs=Li((function(t,e){return t-e}),0);return Fn.after=function(t,n){if("function"!=typeof n)throw new Ot(e);return t=vu(t),function(){if(--t<1)return n.apply(this,arguments)}},Fn.ary=Ea,Fn.assign=wu,Fn.assignIn=bu,Fn.assignInWith=Su,Fn.assignWith=Iu,Fn.at=Pu,Fn.before=Na,Fn.bind=Oa,Fn.bindAll=ts,Fn.bindKey=Ca,Fn.castArray=function(){if(!arguments.length)return [];var t=arguments[0];return Ha(t)?t:[t]},Fn.chain=da,Fn.chunk=function(e,n,r){n=(r?bo(e,n,r):n===t)?1:mn(vu(n),0);var i=null==e?0:e.length;if(!i||n<1)return [];for(var o=0,a=0,u=St(ve(i/n));o<i;)u[a++]=ii(e,o,o+=n);return u},Fn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var o=t[e];o&&(i[r++]=o);}return i},Fn.concat=function(){var t=arguments.length;if(!t)return [];for(var e=St(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Ae(Ha(n)?Oi(n):[n],_r(e,1))},Fn.cond=function(t){var n=null==t?0:t.length,r=co();return t=n?ze(t,(function(t){if("function"!=typeof t[1])throw new Ot(e);return [r(t[0]),t[1]]})):[],Zr((function(e){for(var r=-1;++r<n;){var i=t[r];if(je(i[0],this,e))return je(i[1],this,e)}}))},Fn.conforms=function(t){return function(t){var e=Tu(t);return function(n){return fr(n,t,e)}}(cr(t,1))},Fn.constant=es,Fn.countBy=ga,Fn.create=function(t,e){var n=Wn(t);return null==e?n:or(n,e)},Fn.curry=function e(n,r,i){var o=Yi(n,8,t,t,t,t,t,r=i?t:r);return o.placeholder=e.placeholder,o},Fn.curryRight=function e(n,r,o){var a=Yi(n,i,t,t,t,t,t,r=o?t:r);return a.placeholder=e.placeholder,a},Fn.debounce=Ta,Fn.defaults=xu,Fn.defaultsDeep=ju,Fn.defer=Ua,Fn.delay=za,Fn.difference=Fo,Fn.differenceBy=Wo,Fn.differenceWith=Lo,Fn.drop=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,(n=r||n===t?1:vu(n))<0?0:n,i):[]},Fn.dropRight=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,0,(n=i-(n=r||n===t?1:vu(n)))<0?0:n):[]},Fn.dropRightWhile=function(t,e){return t&&t.length?hi(t,co(e,3),true,true):[]},Fn.dropWhile=function(t,e){return t&&t.length?hi(t,co(e,3),true):[]},Fn.fill=function(e,n,r,i){var o=null==e?0:e.length;return o?(r&&"number"!=typeof r&&bo(e,n,r)&&(r=0,i=o),function(e,n,r,i){var o=e.length;for((r=vu(r))<0&&(r=-r>o?0:o+r),(i=i===t||i>o?o:vu(i))<0&&(i+=o),i=r>i?0:gu(i);r<i;)e[r++]=n;return e}(e,n,r,i)):[]},Fn.filter=function(t,e){return (Ha(t)?Ce:yr)(t,co(e,3))},Fn.flatMap=function(t,e){return _r(Pa(t,e),1)},Fn.flatMapDeep=function(t,e){return _r(Pa(t,e),c)},Fn.flatMapDepth=function(e,n,r){return r=r===t?1:vu(r),_r(Pa(e,n),r)},Fn.flatten=$o,Fn.flattenDeep=function(t){return null!=t&&t.length?_r(t,c):[]},Fn.flattenDepth=function(e,n){return null!=e&&e.length?_r(e,n=n===t?1:vu(n)):[]},Fn.flip=function(t){return Yi(t,512)},Fn.flow=ns,Fn.flowRight=rs,Fn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1];}return r},Fn.functions=function(t){return null==t?[]:Ir(t,Tu(t))},Fn.functionsIn=function(t){return null==t?[]:Ir(t,Uu(t))},Fn.groupBy=ba,Fn.initial=function(t){return null!=t&&t.length?ii(t,0,-1):[]},Fn.intersection=Go,Fn.intersectionBy=Xo,Fn.intersectionWith=Jo,Fn.invert=Nu,Fn.invertBy=Ou,Fn.invokeMap=Sa,Fn.iteratee=os,Fn.keyBy=Ia,Fn.keys=Tu,Fn.keysIn=Uu,Fn.map=Pa,Fn.mapKeys=function(t,e){var n={};return e=co(e,3),br(t,(function(t,r,i){ar(n,e(t,r,i),t);})),n},Fn.mapValues=function(t,e){var n={};return e=co(e,3),br(t,(function(t,r,i){ar(n,r,e(t,r,i));})),n},Fn.matches=function(t){return Fr(cr(t,1))},Fn.matchesProperty=function(t,e){return Wr(t,cr(e,1))},Fn.memoize=Aa,Fn.merge=zu,Fn.mergeWith=Au,Fn.method=as,Fn.methodOf=us,Fn.mixin=ss,Fn.negate=ka,Fn.nthArg=function(t){return t=vu(t),Zr((function(e){return qr(e,t)}))},Fn.omit=ku,Fn.omitBy=function(t,e){return Ru(t,ka(co(e)))},Fn.once=function(t){return Na(2,t)},Fn.orderBy=function(e,n,r,i){return null==e?[]:(Ha(n)||(n=null==n?[]:[n]),Ha(r=i?t:r)||(r=null==r?[]:[r]),Hr(e,n,r))},Fn.over=fs,Fn.overArgs=Ma,Fn.overEvery=ls,Fn.overSome=ps,Fn.partial=Ra,Fn.partialRight=Va,Fn.partition=xa,Fn.pick=Mu,Fn.pickBy=Ru,Fn.property=ds,Fn.propertyOf=function(e){return function(n){return null==e?t:Pr(e,n)}},Fn.pull=Yo,Fn.pullAll=Qo,Fn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Kr(t,e,co(n,2)):t},Fn.pullAllWith=function(e,n,r){return e&&e.length&&n&&n.length?Kr(e,n,t,r):e},Fn.pullAt=ta,Fn.range=hs,Fn.rangeRight=vs,Fn.rearg=Ba,Fn.reject=function(t,e){return (Ha(t)?Ce:yr)(t,ka(co(e,3)))},Fn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;for(e=co(e,3);++r<o;){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r));}return Gr(t,i),n},Fn.rest=function(n,r){if("function"!=typeof n)throw new Ot(e);return Zr(n,r=r===t?r:vu(r))},Fn.reverse=ea,Fn.sampleSize=function(e,n,r){return n=(r?bo(e,n,r):n===t)?1:vu(n),(Ha(e)?Qn:Qr)(e,n)},Fn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Fn.setWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:ti(e,n,r,i)},Fn.shuffle=function(t){return (Ha(t)?tr:ri)(t)},Fn.slice=function(e,n,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&bo(e,n,r)?(n=0,r=i):(n=null==n?0:vu(n),r=r===t?i:vu(r)),ii(e,n,r)):[]},Fn.sortBy=ja,Fn.sortedUniq=function(t){return t&&t.length?si(t):[]},Fn.sortedUniqBy=function(t,e){return t&&t.length?si(t,co(e,2)):[]},Fn.split=function(e,n,r){return r&&"number"!=typeof r&&bo(e,n,r)&&(n=r=t),(r=r===t?p:r>>>0)?(e=mu(e))&&("string"==typeof n||null!=n&&!au(n))&&!(n=fi(n))&&un(e)?Si(hn(e),0,r):e.split(n,r):[]},Fn.spread=function(t,n){if("function"!=typeof t)throw new Ot(e);return n=null==n?0:mn(vu(n),0),Zr((function(e){var r=e[n],i=Si(e,0,n);return r&&Ae(i,r),je(t,this,i)}))},Fn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Fn.take=function(e,n,r){return e&&e.length?ii(e,0,(n=r||n===t?1:vu(n))<0?0:n):[]},Fn.takeRight=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,(n=i-(n=r||n===t?1:vu(n)))<0?0:n,i):[]},Fn.takeRightWhile=function(t,e){return t&&t.length?hi(t,co(e,3),false,true):[]},Fn.takeWhile=function(t,e){return t&&t.length?hi(t,co(e,3)):[]},Fn.tap=function(t,e){return e(t),t},Fn.throttle=function(t,n,r){var i=true,o=true;if("function"!=typeof t)throw new Ot(e);return eu(r)&&(i="leading"in r?!!r.leading:i,o="trailing"in r?!!r.trailing:o),Ta(t,n,{leading:i,maxWait:n,trailing:o})},Fn.thru=ha,Fn.toArray=du,Fn.toPairs=Vu,Fn.toPairsIn=Bu,Fn.toPath=function(t){return Ha(t)?ze(t,Ro):cu(t)?[t]:Oi(Mo(mu(t)))},Fn.toPlainObject=_u,Fn.transform=function(t,e,n){var r=Ha(t),i=r||Xa(t)||fu(t);if(e=co(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:eu(t)&&Ya(o)?Wn(Kt(t)):{};}return (i?Ee:br)(t,(function(t,r,i){return e(n,t,r,i)})),n},Fn.unary=function(t){return Ea(t,1)},Fn.union=na,Fn.unionBy=ra,Fn.unionWith=ia,Fn.uniq=function(t){return t&&t.length?li(t):[]},Fn.uniqBy=function(t,e){return t&&t.length?li(t,co(e,2)):[]},Fn.uniqWith=function(e,n){return n="function"==typeof n?n:t,e&&e.length?li(e,t,n):[]},Fn.unset=function(t,e){return null==t||pi(t,e)},Fn.unzip=oa,Fn.unzipWith=aa,Fn.update=function(t,e,n){return null==t?t:di(t,e,mi(n))},Fn.updateWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:di(e,n,mi(r),i)},Fn.values=Fu,Fn.valuesIn=function(t){return null==t?[]:Qe(t,Uu(t))},Fn.without=ua,Fn.words=Yu,Fn.wrap=function(t,e){return Ra(mi(e),t)},Fn.xor=sa,Fn.xorBy=ca,Fn.xorWith=fa,Fn.zip=la,Fn.zipObject=function(t,e){return yi(t||[],e||[],nr)},Fn.zipObjectDeep=function(t,e){return yi(t||[],e||[],ti)},Fn.zipWith=pa,Fn.entries=Vu,Fn.entriesIn=Bu,Fn.extend=bu,Fn.extendWith=Su,ss(Fn,Fn),Fn.add=ms,Fn.attempt=Qu,Fn.camelCase=Wu,Fn.capitalize=Lu,Fn.ceil=ws,Fn.clamp=function(e,n,r){return r===t&&(r=n,n=t),r!==t&&(r=(r=yu(r))==r?r:0),n!==t&&(n=(n=yu(n))==n?n:0),sr(yu(e),n,r)},Fn.clone=function(t){return cr(t,4)},Fn.cloneDeep=function(t){return cr(t,5)},Fn.cloneDeepWith=function(e,n){return cr(e,5,n="function"==typeof n?n:t)},Fn.cloneWith=function(e,n){return cr(e,4,n="function"==typeof n?n:t)},Fn.conformsTo=function(t,e){return null==e||fr(t,e,Tu(e))},Fn.deburr=qu,Fn.defaultTo=function(t,e){return null==t||t!=t?e:t},Fn.divide=bs,Fn.endsWith=function(e,n,r){e=mu(e),n=fi(n);var i=e.length,o=r=r===t?i:sr(vu(r),0,i);return (r-=n.length)>=0&&e.slice(r,o)==n},Fn.eq=Fa,Fn.escape=function(t){return (t=mu(t))&&K.test(t)?t.replace(H,on):t},Fn.escapeRegExp=function(t){return (t=mu(t))&&et.test(t)?t.replace(tt,"\\$&"):t},Fn.every=function(e,n,r){var i=Ha(e)?Oe:vr;return r&&bo(e,n,r)&&(n=t),i(e,co(n,3))},Fn.find=ya,Fn.findIndex=qo,Fn.findKey=function(t,e){return Be(t,co(e,3),br)},Fn.findLast=_a,Fn.findLastIndex=Ho,Fn.findLastKey=function(t,e){return Be(t,co(e,3),Sr)},Fn.floor=Ss,Fn.forEach=ma,Fn.forEachRight=wa,Fn.forIn=function(t,e){return null==t?t:mr(t,co(e,3),Uu)},Fn.forInRight=function(t,e){return null==t?t:wr(t,co(e,3),Uu)},Fn.forOwn=function(t,e){return t&&br(t,co(e,3))},Fn.forOwnRight=function(t,e){return t&&Sr(t,co(e,3))},Fn.get=Du,Fn.gt=Wa,Fn.gte=La,Fn.has=function(t,e){return null!=t&&yo(t,e,Er)},Fn.hasIn=Eu,Fn.head=Ko,Fn.identity=is,Fn.includes=function(t,e,n,r){t=Ka(t)?t:Fu(t),n=n&&!r?vu(n):0;var i=t.length;return n<0&&(n=mn(i+n,0)),su(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&We(t,e,n)>-1},Fn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return  -1;var i=null==n?0:vu(n);return i<0&&(i=mn(r+i,0)),We(t,e,i)},Fn.inRange=function(e,n,r){return n=hu(n),r===t?(r=n,n=0):r=hu(r),function(t,e,n){return t>=wn(e,n)&&t<mn(e,n)}(e=yu(e),n,r)},Fn.invoke=Cu,Fn.isArguments=qa,Fn.isArray=Ha,Fn.isArrayBuffer=$a,Fn.isArrayLike=Ka,Fn.isArrayLikeObject=Ga,Fn.isBoolean=function(t){return  true===t||false===t||nu(t)&&jr(t)==g},Fn.isBuffer=Xa,Fn.isDate=Ja,Fn.isElement=function(t){return nu(t)&&1===t.nodeType&&!ou(t)},Fn.isEmpty=function(t){if(null==t)return  true;if(Ka(t)&&(Ha(t)||"string"==typeof t||"function"==typeof t.splice||Xa(t)||fu(t)||qa(t)))return !t.length;var e=go(t);if(e==b||e==j)return !t.size;if(xo(t))return !Mr(t).length;for(var n in t)if(kt.call(t,n))return  false;return  true},Fn.isEqual=function(t,e){return Ur(t,e)},Fn.isEqualWith=function(e,n,r){var i=(r="function"==typeof r?r:t)?r(e,n):t;return i===t?Ur(e,n,t,r):!!i},Fn.isError=Za,Fn.isFinite=function(t){return "number"==typeof t&&Ve(t)},Fn.isFunction=Ya,Fn.isInteger=Qa,Fn.isLength=tu,Fn.isMap=ru,Fn.isMatch=function(t,e){return t===e||zr(t,e,lo(e))},Fn.isMatchWith=function(e,n,r){return r="function"==typeof r?r:t,zr(e,n,lo(n),r)},Fn.isNaN=function(t){return iu(t)&&t!=+t},Fn.isNative=function(t){if(Po(t))throw new Pt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ar(t)},Fn.isNil=function(t){return null==t},Fn.isNull=function(t){return null===t},Fn.isNumber=iu,Fn.isObject=eu,Fn.isObjectLike=nu,Fn.isPlainObject=ou,Fn.isRegExp=au,Fn.isSafeInteger=function(t){return Qa(t)&&t>=-9007199254740991&&t<=f},Fn.isSet=uu,Fn.isString=su,Fn.isSymbol=cu,Fn.isTypedArray=fu,Fn.isUndefined=function(e){return e===t},Fn.isWeakMap=function(t){return nu(t)&&go(t)==N},Fn.isWeakSet=function(t){return nu(t)&&"[object WeakSet]"==jr(t)},Fn.join=function(t,e){return null==t?"":Ke.call(t,e)},Fn.kebabCase=Hu,Fn.last=Zo,Fn.lastIndexOf=function(e,n,r){var i=null==e?0:e.length;if(!i)return  -1;var o=i;return r!==t&&(o=(o=vu(r))<0?mn(i+o,0):wn(o,i-1)),n==n?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(e,n,o):Fe(e,qe,o,true)},Fn.lowerCase=$u,Fn.lowerFirst=Ku,Fn.lt=lu,Fn.lte=pu,Fn.max=function(e){return e&&e.length?gr(e,is,Dr):t},Fn.maxBy=function(e,n){return e&&e.length?gr(e,co(n,2),Dr):t},Fn.mean=function(t){return He(t,is)},Fn.meanBy=function(t,e){return He(t,co(e,2))},Fn.min=function(e){return e&&e.length?gr(e,is,Vr):t},Fn.minBy=function(e,n){return e&&e.length?gr(e,co(n,2),Vr):t},Fn.stubArray=gs,Fn.stubFalse=ys,Fn.stubObject=function(){return {}},Fn.stubString=function(){return ""},Fn.stubTrue=function(){return  true},Fn.multiply=Is,Fn.nth=function(e,n){return e&&e.length?qr(e,vu(n)):t},Fn.noConflict=function(){return he._===this&&(he._=Ft),this},Fn.noop=cs,Fn.now=Da,Fn.pad=function(t,e,n){t=mu(t);var r=(e=vu(e))?dn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Hi(ge(i),n)+t+Hi(ve(i),n)},Fn.padEnd=function(t,e,n){t=mu(t);var r=(e=vu(e))?dn(t):0;return e&&r<e?t+Hi(e-r,n):t},Fn.padStart=function(t,e,n){t=mu(t);var r=(e=vu(e))?dn(t):0;return e&&r<e?Hi(e-r,n)+t:t},Fn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Sn(mu(t).replace(nt,""),e||0)},Fn.random=function(e,n,r){if(r&&"boolean"!=typeof r&&bo(e,n,r)&&(n=r=t),r===t&&("boolean"==typeof n?(r=n,n=t):"boolean"==typeof e&&(r=e,e=t)),e===t&&n===t?(e=0,n=1):(e=hu(e),n===t?(n=e,e=0):n=hu(n)),e>n){var i=e;e=n,n=i;}if(r||e%1||n%1){var o=In();return wn(e+o*(n-e+fe("1e-"+((o+"").length-1))),n)}return Xr(e,n)},Fn.reduce=function(t,e,n){var r=Ha(t)?ke:Ge,i=arguments.length<3;return r(t,co(e,4),n,i,dr)},Fn.reduceRight=function(t,e,n){var r=Ha(t)?Me:Ge,i=arguments.length<3;return r(t,co(e,4),n,i,hr)},Fn.repeat=function(e,n,r){return n=(r?bo(e,n,r):n===t)?1:vu(n),Jr(mu(e),n)},Fn.replace=function(){var t=arguments,e=mu(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Fn.result=function(e,n,r){var i=-1,o=(n=wi(n,e)).length;for(o||(o=1,e=t);++i<o;){var a=null==e?t:e[Ro(n[i])];a===t&&(i=o,a=r),e=Ya(a)?a.call(e):a;}return e},Fn.round=Ps,Fn.runInContext=rt,Fn.sample=function(t){return (Ha(t)?Yn:Yr)(t)},Fn.size=function(t){if(null==t)return 0;if(Ka(t))return su(t)?dn(t):t.length;var e=go(t);return e==b||e==j?t.size:Mr(t).length},Fn.snakeCase=Gu,Fn.some=function(e,n,r){var i=Ha(e)?Re:oi;return r&&bo(e,n,r)&&(n=t),i(e,co(n,3))},Fn.sortedIndex=function(t,e){return ai(t,e)},Fn.sortedIndexBy=function(t,e,n){return ui(t,e,co(n,2))},Fn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=ai(t,e);if(r<n&&Fa(t[r],e))return r}return  -1},Fn.sortedLastIndex=function(t,e){return ai(t,e,true)},Fn.sortedLastIndexBy=function(t,e,n){return ui(t,e,co(n,2),true)},Fn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=ai(t,e,true)-1;if(Fa(t[n],e))return n}return  -1},Fn.startCase=Xu,Fn.startsWith=function(t,e,n){return t=mu(t),n=null==n?0:sr(vu(n),0,t.length),e=fi(e),t.slice(n,n+e.length)==e},Fn.subtract=xs,Fn.sum=function(t){return t&&t.length?Xe(t,is):0},Fn.sumBy=function(t,e){return t&&t.length?Xe(t,co(e,2)):0},Fn.template=function(e,n,r){var i=Fn.templateSettings;r&&bo(e,n,r)&&(n=t),e=mu(e),n=Su({},n,i,Qi);var o,a,u=Su({},n.imports,i.imports,Qi),s=Tu(u),c=Qe(u,s),f=0,l=n.interpolate||_t,p="__p += '",d=Et((n.escape||_t).source+"|"+l.source+"|"+(l===J?ft:_t).source+"|"+(n.evaluate||_t).source+"|$","g"),h="//# sourceURL="+(kt.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ie+"]")+"\n";e.replace(d,(function(t,n,r,i,u,s){return r||(r=i),p+=e.slice(f,s).replace(mt,an),n&&(o=true,p+="' +\n__e("+n+") +\n'"),u&&(a=true,p+="';\n"+u+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=s+t.length,t})),p+="';\n";var v=kt.call(n,"variable")&&n.variable;if(v){if(st.test(v))throw new Pt("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(a?p.replace(F,""):p).replace(W,"$1").replace(L,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Qu((function(){return xt(s,h+"return "+p).apply(t,c)}));if(g.source=p,Za(g))throw g;return g},Fn.times=function(t,e){if((t=vu(t))<1||t>f)return [];var n=p,r=wn(t,p);e=co(e),t-=p;for(var i=Je(r,e);++n<t;)e(n);return i},Fn.toFinite=hu,Fn.toInteger=vu,Fn.toLength=gu,Fn.toLower=function(t){return mu(t).toLowerCase()},Fn.toNumber=yu,Fn.toSafeInteger=function(t){return t?sr(vu(t),-9007199254740991,f):0===t?t:0},Fn.toString=mu,Fn.toUpper=function(t){return mu(t).toUpperCase()},Fn.trim=function(e,n,r){if((e=mu(e))&&(r||n===t))return Ze(e);if(!e||!(n=fi(n)))return e;var i=hn(e),o=hn(n);return Si(i,en(i,o),nn(i,o)+1).join("")},Fn.trimEnd=function(e,n,r){if((e=mu(e))&&(r||n===t))return e.slice(0,vn(e)+1);if(!e||!(n=fi(n)))return e;var i=hn(e);return Si(i,0,nn(i,hn(n))+1).join("")},Fn.trimStart=function(e,n,r){if((e=mu(e))&&(r||n===t))return e.replace(nt,"");if(!e||!(n=fi(n)))return e;var i=hn(e);return Si(i,en(i,hn(n))).join("")},Fn.truncate=function(e,n){var r=30,i="...";if(eu(n)){var o="separator"in n?n.separator:o;r="length"in n?vu(n.length):r,i="omission"in n?fi(n.omission):i;}var a=(e=mu(e)).length;if(un(e)){var u=hn(e);a=u.length;}if(r>=a)return e;var s=r-dn(i);if(s<1)return i;var c=u?Si(u,0,s).join(""):e.slice(0,s);if(o===t)return c+i;if(u&&(s+=c.length-s),au(o)){if(e.slice(s).search(o)){var f,l=c;for(o.global||(o=Et(o.source,mu(lt.exec(o))+"g")),o.lastIndex=0;f=o.exec(l);)var p=f.index;c=c.slice(0,p===t?s:p);}}else if(e.indexOf(fi(o),s)!=s){var d=c.lastIndexOf(o);d>-1&&(c=c.slice(0,d));}return c+i},Fn.unescape=function(t){return (t=mu(t))&&$.test(t)?t.replace(q,gn):t},Fn.uniqueId=function(t){var e=++Mt;return mu(t)+e},Fn.upperCase=Ju,Fn.upperFirst=Zu,Fn.each=ma,Fn.eachRight=wa,Fn.first=Ko,ss(Fn,(_s={},br(Fn,(function(t,e){kt.call(Fn.prototype,e)||(_s[e]=t);})),_s),{chain:false}),Fn.VERSION="4.17.21",Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Fn[t].placeholder=Fn;})),Ee(["drop","take"],(function(e,n){Hn.prototype[e]=function(r){r=r===t?1:mn(vu(r),0);var i=this.__filtered__&&!n?new Hn(this):this.clone();return i.__filtered__?i.__takeCount__=wn(r,i.__takeCount__):i.__views__.push({size:wn(r,p),type:e+(i.__dir__<0?"Right":"")}),i},Hn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()};})),Ee(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Hn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:co(t,3),type:n}),e.__filtered__=e.__filtered__||r,e};})),Ee(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Hn.prototype[t]=function(){return this[n](1).value()[0]};})),Ee(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Hn.prototype[t]=function(){return this.__filtered__?new Hn(this):this[n](1)};})),Hn.prototype.compact=function(){return this.filter(is)},Hn.prototype.find=function(t){return this.filter(t).head()},Hn.prototype.findLast=function(t){return this.reverse().find(t)},Hn.prototype.invokeMap=Zr((function(t,e){return "function"==typeof t?new Hn(this):this.map((function(n){return Cr(n,t,e)}))})),Hn.prototype.reject=function(t){return this.filter(ka(co(t)))},Hn.prototype.slice=function(e,n){e=vu(e);var r=this;return r.__filtered__&&(e>0||n<0)?new Hn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(n=vu(n))<0?r.dropRight(-n):r.take(n-e)),r)},Hn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Hn.prototype.toArray=function(){return this.take(p)},br(Hn.prototype,(function(e,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),i=/^(?:head|last)$/.test(n),o=Fn[i?"take"+("last"==n?"Right":""):n],a=i||/^find/.test(n);o&&(Fn.prototype[n]=function(){var n=this.__wrapped__,u=i?[1]:arguments,s=n instanceof Hn,c=u[0],f=s||Ha(n),l=function(t){var e=o.apply(Fn,Ae([t],u));return i&&p?e[0]:e};f&&r&&"function"==typeof c&&1!=c.length&&(s=f=false);var p=this.__chain__,d=!!this.__actions__.length,h=a&&!p,v=s&&!d;if(!a&&f){n=v?n:new Hn(this);var g=e.apply(n,u);return g.__actions__.push({func:ha,args:[l],thisArg:t}),new qn(g,p)}return h&&v?e.apply(this,u):(g=this.thru(l),h?i?g.value()[0]:g.value():g)});})),Ee(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Ct[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Fn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Ha(i)?i:[],t)}return this[n]((function(n){return e.apply(Ha(n)?n:[],t)}))};})),br(Hn.prototype,(function(t,e){var n=Fn[e];if(n){var r=n.name+"";kt.call(Tn,r)||(Tn[r]=[]),Tn[r].push({name:e,func:n});}})),Tn[Fi(t,2).name]=[{name:"wrapper",func:t}],Hn.prototype.clone=function(){var t=new Hn(this.__wrapped__);return t.__actions__=Oi(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Oi(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Oi(this.__views__),t},Hn.prototype.reverse=function(){if(this.__filtered__){var t=new Hn(this);t.__dir__=-1,t.__filtered__=true;}else (t=this.clone()).__dir__*=-1;return t},Hn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Ha(t),r=e<0,i=n?t.length:0,o=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case "drop":t+=a;break;case "dropRight":e-=a;break;case "take":e=wn(e,t+a);break;case "takeRight":t=mn(t,e-a);}}return {start:t,end:e}}(0,i,this.__views__),a=o.start,u=o.end,s=u-a,c=r?u:a-1,f=this.__iteratees__,l=f.length,p=0,d=wn(s,this.__takeCount__);if(!n||!r&&i==s&&d==s)return vi(t,this.__actions__);var h=[];t:for(;s--&&p<d;){for(var v=-1,g=t[c+=e];++v<l;){var y=f[v],_=y.iteratee,m=y.type,w=_(g);if(2==m)g=w;else if(!w){if(1==m)continue t;break t}}h[p++]=g;}return h},Fn.prototype.at=va,Fn.prototype.chain=function(){return da(this)},Fn.prototype.commit=function(){return new qn(this.value(),this.__chain__)},Fn.prototype.next=function(){this.__values__===t&&(this.__values__=du(this.value()));var e=this.__index__>=this.__values__.length;return {done:e,value:e?t:this.__values__[this.__index__++]}},Fn.prototype.plant=function(e){for(var n,r=this;r instanceof Ln;){var i=Bo(r);i.__index__=0,i.__values__=t,n?o.__wrapped__=i:n=i;var o=i;r=r.__wrapped__;}return o.__wrapped__=e,n},Fn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Hn){var n=e;return this.__actions__.length&&(n=new Hn(this)),(n=n.reverse()).__actions__.push({func:ha,args:[ea],thisArg:t}),new qn(n,this.__chain__)}return this.thru(ea)},Fn.prototype.toJSON=Fn.prototype.valueOf=Fn.prototype.value=function(){return vi(this.__wrapped__,this.__actions__)},Fn.prototype.first=Fn.prototype.head,re&&(Fn.prototype[re]=function(){return this}),Fn}();ge?((ge.exports=yn)._=yn,ve._=yn):he._=yn;}.call(ie.exports)),ie.exports);function se(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}(function(){function t(t,e){this.isCanvasRoot=true,this.DEBUG=false,this.onUpdateFunction=void 0,this.scheduledStateUpdates=[],this.scheduledUpdateIds=[],this.scheduledUpdateNodeMap={},this.currentUpdateId="",this.updateScheduled=false,this.updateRunning=false,this.taintedLayers=[],this.cameraNode=void 0,this.scheduledCameraNode=void 0,this.canvas=e,this.rootNode=t(this),this.rootNode.windowDidMountPrimitive(this.rootNode.props),this.rootNode.setAsPrimaryCamera();}return Object.defineProperty(t.prototype,"windows",{get:function(){var t=function(e){return o([e],i(e.children.flatMap(t)),false)};return ue.orderBy(t(this.rootNode),(function(t){return t.getLayer()}),"asc")},enumerable:false,configurable:true}),t.prototype.logWindows=function(){var t=function(e){var n=e._boxSnapshot,r=[];if(r.push("KEY: ".concat(e.key)),e._isPrimaryCamera&&r.push("[[PRIMARY CAMERA]]"),r.push("LAYER: ".concat(e.getLayer())),r.push("BOX: [".concat(e.o[0],", ").concat(e.o[1],", ").concat(e.w,", ").concat(e.h,"]")),r.push("GLOBAL O: [".concat(e.globalO[0],", ").concat(e.globalO[1],"]")),r.push("CHILDREN:"),e.children.length>0){for(var i=e.children,o=[],a=0;a<i.length;a++){var u=i[a];o.push(t(u));}r.push(" |");for(a=0;a<o.length;a++){for(var s=o[a],c=a===o.length-1?" └─":" ├─",f=0;f<s.length;f++){var l=0===f?c:a===o.length-1?"   ":" | ",p=s[f];r.push("".concat(l,"  ").concat(p));}a<o.length-1&&r.push(" |");}}else r.push("  |"),r.push("  └─ (no children)");return e._boxSnapshot=n,r};console.log(t(this.rootNode).join("\n"));},t.prototype.onUpdate=function(t){this.onUpdateFunction=t;},Object.defineProperty(t.prototype,"cameraSnapshot",{get:function(){return this.cameraNode?new Kt(this.cameraNode.globalO,this.cameraNode.w,this.cameraNode.h):new Kt([0,0],this.canvas.width,this.canvas.height)},enumerable:false,configurable:true}),t.prototype.scheduleStateUpdate=function(t,e){var n=this.scheduleUpdate(t);this.scheduledStateUpdates.push([n,function(){t.state=e;}]);},t.prototype.scheduleContextUpdate=function(t,e,n){var r=this.scheduleUpdate(t);this.scheduledStateUpdates.push([r,function(){t.context[e]=n;}]);},t.prototype.setSingleUpdateFlag=function(t,e){this.scheduledUpdateNodeMap[e]||(this.scheduledUpdateNodeMap[e]={}),this.scheduledUpdateNodeMap[e][t.globalKey]=true;},t.prototype.scheduleUpdate=function(t){var e=this,n=function(){e.DEBUG&&console.log("Scheduling update for ".concat(t.globalKey,". Received id ").concat(e.currentUpdateId));};if(!this.updateRunning&&!this.updateScheduled){this.updateScheduled=true;var r=se();return this.scheduledUpdateIds.push(r),this.currentUpdateId=r,Promise.resolve().then((function(){for(e.DEBUG&&console.log("Executing batched updates: Update Ids are ".concat(JSON.stringify(e.scheduledUpdateIds,null,2),".\n                    ")),e.updateRunning=true;e.scheduledUpdateIds.length>0;)e.updateScheduled=false,e.updateCurrentId();e.updateRunning=false;})),this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId}if(!this.updateRunning&&this.updateScheduled)return this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId;if(this.updateRunning&&!this.updateScheduled){this.updateScheduled=true;r=se();return this.scheduledUpdateIds.push(r),this.currentUpdateId=r,this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId}if(this.updateRunning&&this.updateScheduled)return this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId;throw new Error("Invalid state")},t.prototype.onAnimationFrame=function(){try{this.render();}catch(t){console.error(t);}},t.prototype.propogateUpdateFlags=function(t){var e=this,n=function(t,r,i){e.scheduledUpdateNodeMap[r]||(e.scheduledUpdateNodeMap[r]={}),e.scheduledUpdateNodeMap[r][t.globalKey]&&(i=true),e.scheduledUpdateNodeMap[r][t.globalKey]=i,t.children.forEach((function(t){return n(t,r,i)}));};n(this.rootNode,t,false);},t.prototype.updateCurrentId=function(){var t=this,e=this.scheduledUpdateIds[0];Object.keys(this.scheduledUpdateNodeMap[e]).forEach((function(n){t.propogateUpdateFlags(e);})),this.DEBUG&&console.log("STARTING UPDATE: Update with id: ".concat(this.scheduledUpdateIds[0],". \nSTATE UPDATE STAGE. State updates are scheduled for ").concat(this.scheduledStateUpdates.map((function(t){return i(t,1)[0]})),".\n            ")),this.scheduledUpdateIds=this.scheduledUpdateIds.filter((function(t){return t!==e})),this.scheduledStateUpdates.filter((function(t){return i(t,1)[0]===e})).forEach((function(t){var e=i(t,2);return e[0],(0, e[1])()})),this.scheduledStateUpdates=this.scheduledStateUpdates.filter((function(t){return i(t,1)[0]!==e}));var n=this.scheduledUpdateNodeMap[e];this.update(n),delete this.scheduledUpdateNodeMap[e];},t.prototype.taintLayer=function(t){this.taintedLayers.includes(t)||this.taintedLayers.push(t);},t.prototype.findCameraPathRecursive=function(t,e){var r,i;if(t._isPrimaryCamera){var o=t.globalKey;return c=n(n({},e),((r={})[o]=true,r))}for(var a=t.children,u=0;u<a.length;u++){var s=a[u],c=(o=s.globalKey,n(n({},e),((i={})[o]=true,i))),f=this.findCameraPathRecursive(s,c);if(f)return f}},t.prototype.AND_updateMaps=function(t,e){var n={};for(var r in t)e[r]&&(n[r]=true);return n},t.prototype.XOR_updateMaps=function(t,e){var n={};for(var r in t)e[r]||(n[r]=true);for(var r in e)t[r]||(n[r]=true);return n},t.prototype.factorizeUpdateMap=function(t,e){var n=this.AND_updateMaps(t,e);return [n,this.XOR_updateMaps(t,n)]},t.prototype.setNeedsUpdateToMap=function(t){var e=function(n){var r=n.globalKey;t[r]?n._needsUpdate=true:n._needsUpdate=false,n.children.forEach((function(t){return e(t)}));};e(this.rootNode);},t.prototype.setNeedsUpdateToMapAdd=function(t){var e=function(n){var r=n.globalKey;t[r]&&(n._needsUpdate=true),n.children.forEach((function(t){return e(t)}));};e(this.rootNode);},t.prototype.installCamera=function(t){this.cameraNode!==t&&(this.scheduledCameraNode=t,this.scheduleUpdate(this.rootNode));},t.prototype.update=function(t){this.onUpdateFunction&&this.onUpdateFunction(),this.scheduledCameraNode&&(this.cameraNode&&(this.cameraNode._isPrimaryCamera=false),this.cameraNode=this.scheduledCameraNode,this.cameraNode._isPrimaryCamera=true,this.scheduledCameraNode=void 0);var e=this.findCameraPathRecursive(this.rootNode,{});if(!e)throw new Error("No camera found in the tree");var n=i(this.factorizeUpdateMap(t,e),2),r=n[0],o=n[1];this.DEBUG&&console.log("RENDER STAGE. Updates flags are set for: ".concat(JSON.stringify(Object.keys(t),null,2),".\nWill update in the two passes:\nFirst pass: ").concat(JSON.stringify(Object.keys(r),null,2),"\nSecond pass: ").concat(JSON.stringify(Object.keys(o),null,2),"\n            "));var a=function(t,e){t._needsUpdate?e?t.cameraPassUpdateSelf():t.regularPassUpdateSelf():t.children.forEach((function(t){return a(t,e)}));};this.setNeedsUpdateToMap(r),a(this.rootNode,true),this.setNeedsUpdateToMapAdd(o),a(this.rootNode,false),this.setNeedsUpdateToMap({}),this.DEBUG&&(console.log("RENDER STAGE COMPLETE. The new tree will be displayed below.\nDirty layers are ".concat(JSON.stringify(this.taintedLayers,null,2),".\n            ")),this.logWindows());},t.prototype.render=function(){var t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get 2d context from canvas");t.clearRect(0,0,this.canvas.width,this.canvas.height),Jt(this.cameraSnapshot,this.windows,this.canvas,t,this.taintedLayers),this.taintedLayers=[];},t.prototype.mouseDownHandler=function(t,e){Yt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseMoveHandler=function(t,e){Qt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseUpHandler=function(t,e){te(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseWheelHandler=function(t){ee(this.cameraSnapshot,this.windows,this.canvas,t);},t.prototype.clickHandler=function(t,e){Zt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t})();

// class State {
//     controller: PinsAndCurvesProjectController.PinsAndCurvesProjectController;
//     constructor() {
//         const dispatch = (e: any) => this.send(e);
//         this.controller = getController(dispatch);
//     }
//     changeController(worm: any) {
//         const dispatch = (e: any) => this.send(e);
//         this.controller = getController(dispatch, worm);
//     }
//     send(payload: any) {
//         if (this.receiver_id === "") return;
//         if (payload.type === "hostIsConnected") return;
//         this.addToWorkload(this.subscribers[this.receiver_id], "projectNodeEvent", payload, this.receiver_id);
//     }
//     receiver_id: string = "";
//     channel : string = "ProjectState";
//     subscribers : { [instance_id: string]: any } = {};
//     subscribe(receiver : { instance_id: string, modality: string, resource_id: string }, subscriber_id: string) {
//         this.subscribers[subscriber_id] = receiver;
//         this.addToWorkload(receiver, "subscribeConfirmation", true, subscriber_id);
//     }
//     workload : { [thread: string]: any[]} = {};
//     addToWorkload(receiver : {
//         instance_id: string,
//         modality: string,
//         resource_id: string
//     }, request: string, messagePayload: any, subscriber_id: string) {
//         if (!this.workload["default"]) {
//             this.workload["default"] = [];
//         }
//         this.workload["default"].push(
//             {
//                 type: "worker",
//                 receiver,
//                 payload: {
//                     channel: "ProjectState",
//                     request: request,
//                     payload: messagePayload,
//                     subscriber_id,
//                 }
//             }
//         )
//     }
//     emit(payload: any) {
//         Object.keys(this.subscribers).forEach(subscriber_id => {
//             this.addToWorkload(this.subscribers[subscriber_id], "projectNodeEvent", payload, subscriber_id);
//         })
//     }
//     distribute(payload: any) {
//         this.emit(payload);
//         this.controller.receive(payload);
//     }
//     clearWorkload() {
//         this.workload = {};
//     }
// }
// const state = new State()
var client;
var pendingWorkload = {};
function addToWorkload(payload) {
    if (pendingWorkload.default === undefined) {
        pendingWorkload.default = [];
    }
    pendingWorkload.default.push({
        type: "worker",
        receiver: {
            instance_id: "BACKGROUND",
            modality: "wasmjs",
            resource_id: "http://localhost:8000/ProjectState"
        },
        payload: __assign(__assign({}, payload), { subscriber_id: "CopilotEval" }),
    });
}
function onCompute(string) {
    string = decodeURI(string);
    var unit = JSON.parse(string);
    var _a = unit.payload, INIT = _a.INIT, EVAL = _a.EVAL, timelineOperations = _a.timelineOperations, channel = _a.channel, request = _a.request, payload = _a.payload;
    if (channel === "ProjectState" && request === "projectNodeEvent") {
        client.receive(payload);
        return {};
    }
    if (EVAL) {
        if (client === undefined) {
            return false;
        }
        var projectTools = client.projectTools;
        var randomId = function () { return randomUUID().slice(0, 5); };
        randomId();
        if (projectTools === undefined) {
            return false;
        }
        var currentOperation = "";
        try {
            for (var i in timelineOperations) {
                var operation = timelineOperations[i];
                currentOperation = operation;
                eval(operation);
            }
        }
        catch (e) {
            log("Last operation: ".concat(currentOperation, ". Error in eval: ").concat(e));
        }
        var workload = pendingWorkload;
        pendingWorkload = {};
        return workload;
    }
    if (INIT) {
        var dispatch = function (e) { return addToWorkload({ channel: "ProjectState", request: "projectNodeEvent", payload: e }); };
        addToWorkload({ channel: "ProjectState", request: "subscribe", subscriber_id: "CopilotEval" });
        client = wt.PinsAndCurvesProjectController.Client(dispatch);
        client.connectToHost();
        var workload = pendingWorkload;
        pendingWorkload = {};
        return workload;
    }
    return {};
}
onCompute(decodeURI(JSON.stringify({
    payload: {
        channel: "SELF",
        request: "getProject",
        payload: {}
    }
})));
//# sourceMappingURL=index.js.map
