'use strict';

/******************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise, SuppressedError, Symbol, Iterator */


var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};

typeof SuppressedError === "function" ? SuppressedError : function (error, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error, e.suppressed = suppressed, e;
};

var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e;}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e;}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r);}var n=function(){return n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},n.apply(this,arguments)};function r(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return {next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)o.push(r.value);}catch(t){i={error:t};}finally{try{r&&!r.done&&(n=a.return)&&n.call(a);}finally{if(i)throw i.error}}return o}function a(t,e,n){if(2===arguments.length)for(var r,i=0,a=e.length;i<a;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;(function(){function t(){this._project={metaData:{name:"Empty Project",pinsAndCurvesVersion:"0.0.1"},orgData:{signalIds:[],signalIdByPinId:{},pinIds:[],signalNames:{},signalTypes:{},activeSignalIds:[]},timelineData:{numberOfFrames:100,framesPerSecond:30,playheadPosition:0,focusRange:[0,100],playing:false},signalData:{},templateData:{}};}return t.prototype.setName=function(t){this._project.metaData.name=t;},t.prototype.addStaticStringSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="discrete",this._project.signalData[t]={id:t,type:"discrete",pinIds:[],pinTimes:{},pinValues:{},defaultValue:n,isStatic:true};},t.prototype.addStaticNumberSignal=function(t,e,n,r){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",pinIds:[],pinTimes:{},pinValues:{},defaultValue:r,isStatic:true,range:n,defaultCurve:"return easyLinear();",curves:{}};},t.prototype.addDiscreteSignal=function(t,e){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="discrete",this._project.signalData[t]={id:t,type:"discrete",pinIds:[],pinTimes:{},pinValues:{},defaultValue:"default value",displayValues:true};},t.prototype.addContinuousSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",range:n,pinIds:[],pinTimes:{},pinValues:{},curves:{},defaultCurve:"return easyLinear();",defaultValue:n[0]};},t.prototype.addContinuousBezierSignal=function(t,e,n){this._project.orgData.signalIds.push(t),this._project.orgData.signalNames[t]=e,this._project.orgData.signalTypes[t]="continuous",this._project.signalData[t]={id:t,type:"continuous",range:n,pinIds:[],pinTimes:{},pinValues:{},curves:{},defaultCurve:"return bezier();",defaultValue:n[0],bezierControlPoints:{},bezier:true};},t.prototype.addPin=function(t,e,n,r){var i=this._project.signalData[t],a=Math.random().toString(36).substring(7);if(this._project.orgData.pinIds.push(a),this._project.orgData.signalIdByPinId[a]=t,"continuous"===i.type){if(i.pinIds.push(a),i.pinTimes[a]=e,"number"!=typeof n)throw new Error("Continuous signal pin value must be a number");if(i.pinValues[a]=n,r)i.curves[a]=r;else {var o=i.defaultCurve;i.curves[a]=o;}if("bezier"in i){this._project.timelineData.numberOfFrames;i.bezierControlPoints[a]=[-5,0,5,0];}}if("discrete"===i.type){if(i.pinIds.push(a),i.pinTimes[a]=e,"string"!=typeof n)throw new Error("Discrete signal pin value must be a string");i.pinValues[a]=n;}},t.prototype.setTimelineData=function(t,e,r){this._project.timelineData=n(n({},this._project.timelineData),{numberOfFrames:t,framesPerSecond:e,playheadPosition:r});},t.prototype.setSignalActiveStatus=function(t,e){e?this._project.orgData.activeSignalIds.push(t):this._project.orgData.activeSignalIds=this._project.orgData.activeSignalIds.filter((function(e){return e!==t}));},t.prototype.getProject=function(){return this._project},t.prototype.addCurveTemplate=function(t,e){this._project.templateData[t]=e;},t})();var s=function(){function t(t,e,n){if(void 0===n&&(n=1e4),this.content=t,this.__transformer=e,"number"==typeof n){if(n<1)throw new Error("Max size must be greater than 0");this.__internal={namedStates:{},states:{initial:{forward:[],backward:[],nextState:void 0,previousState:void 0}},cursor:"initial",maxSize:n};}else this.__internal=n;this.__MAX_ITERATIONS=this.__internal.maxSize+1;}return t.deserialize=function(e,n){var r=JSON.parse(e);return new t(r.content,n,r.__internal)},t.prototype.serialize=function(){return JSON.stringify({content:this.content,__internal:this.__internal})},t.prototype.next=function(){var t=this.__internal.states[this.__internal.cursor].nextState;if(!t)return {success:false,message:"No next state"};var e=this.__internal.cursor,n=this.__internal.states[e].forward;return this.__internal.cursor=t,this.content=this.__transformer(this.content,n),{success:true,message:"Next state reached"}},t.prototype.previous=function(){var t=this.__internal.states[this.__internal.cursor].previousState;if(!t)return {success:false,message:"No previous state"};var e=this.__internal.cursor,n=this.__internal.states[e].backward;return this.__internal.cursor=t,this.content=this.__transformer(this.content,n),{success:true,message:"Previous state reached"}},t.prototype.goToNamedState=function(t){var e=this.__internal.namedStates[t];if(!e)return {success:false,message:"Named state not found"};if(!this.__internal.states[e])throw new Error("Named state has no corresponding state");var n=this.__internal.cursor;if(e===n)return {success:true,message:"Already at named state"};for(var r="forward",i=n,a=0;i&&a<this.__MAX_ITERATIONS;)a++,i===e&&(r="backward"),i=this.__internal.states[i].previousState;if("forward"===r)for(a=0;this.__internal.cursor!==e&&a<this.__MAX_ITERATIONS;){if(a++,!(o=this.next()).success)throw new Error(o.message)}else for(a=0;this.__internal.cursor!==e&&a<this.__MAX_ITERATIONS;){var o;if(a++,!(o=this.previous()).success)throw new Error(o.message)}return {success:true,message:"Moved to named state"}},t.prototype.saveAsNamedState=function(t){this.__internal.namedStates[t]=this.__internal.cursor;},t.prototype.appendToCurrentState=function(t,e){this.content=this.__transformer(this.content,t);var n=this.__internal.cursor,r=this.__internal.states[n].forward,i=this.__internal.states[n].backward;this.__internal.states[n].forward=r.concat(t),this.__internal.states[n].backward=e.concat(i);},t.prototype.addNextState=function(t,e){for(var n=this,r=[],i=o=this.__internal.cursor,a=0;i&&a<this.__MAX_ITERATIONS;)a++,(i=this.__internal.states[i].nextState)&&r.push(i);r.forEach((function(t){delete n.__internal.states[t];}));var o=this.__internal.cursor,u="state".concat(function(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<10;n++)t+=e.charAt(Math.floor(52*Math.random()));return t}());this.__internal.states[u]={forward:t,backward:e,nextState:void 0,previousState:o},this.__internal.states[o].nextState=u,this.__internal.cursor=u,this.content=this.__transformer(this.content,t);var s=1,c=(i=o=this.__internal.cursor,[o]);for(a=0;i&&s<this.__internal.maxSize&&a<this.__MAX_ITERATIONS;)a++,(i=this.__internal.states[i].previousState)&&c.push(i),s++;var l=Object.keys(this.__internal.states).filter((function(t){return !c.includes(t)}));l.forEach((function(t){delete n.__internal.states[t];})),c.forEach((function(t,e){var r=n.__internal.states[t].previousState,i=n.__internal.states[t].nextState;r&&!n.__internal.states[r]&&(n.__internal.states[t].previousState=void 0),i&&!n.__internal.states[i]&&(n.__internal.states[t].nextState=void 0);})),Object.keys(this.__internal.namedStates).forEach((function(t){var e=n.__internal.namedStates[t];if(!e)throw new Error("Named state has no corresponding state");n.__internal.states[e]||delete n.__internal.namedStates[t];}));},t.prototype.executeCommand=function(t){switch(t.type){case "next":this.next();break;case "previous":this.previous();break;case "goToNamedState":this.goToNamedState(t.namedState);break;case "saveAsNamedState":this.saveAsNamedState(t.namedState);break;case "addNextState":this.addNextState(t.forward,t.backward);break;case "appendToCurrentState":this.appendToCurrentState(t.forward,t.backward);break;default:throw new Error("Invalid command")}},t.prototype.executeCommands=function(t){var e=this;t.forEach((function(t){return e.executeCommand(t)}));},t}(),l=function(){function t(t){this.subscribers=[],this.update=[],this.dispatch=t,this.authorId="a".concat(d());}return t.prototype.subscribeToProjectUpdates=function(t){var e=this;if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");return this.subscribers.push(t),function(){e.subscribers=e.subscribers.filter((function(e){return e!==t}));}},t.prototype.getProject=function(){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");return this.worm.content},t.prototype.pushCommand=function(t){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");try{var e=t();this.worm.executeCommand(e),this.update.push(e);}catch(t){console.error(t);}},t.prototype.pushCommands=function(t){var e;if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");try{var n=t();this.worm.executeCommands(n),(e=this.update).push.apply(e,a([],i(n),!1));}catch(t){console.error(t);}},t.prototype.pushUpdate=function(){if(!this.worm||!this.projectStateId)throw new Error("Worm not initialized");var t=this.update;this.update=[];var e=this.projectStateId;this.projectStateId="ps".concat(d()),this.subscribers.forEach((function(t){return t()})),this.dispatch({authorId:this.authorId,authorIsHost:this.host,type:"pushUpdate",instructions:t,lastAgreedProjectStateId:e,newProjectStateId:this.projectStateId});},t.prototype.processUpdate=function(t){if(this.worm&&this.projectStateId){var e=t.lastAgreedProjectStateId,n=t.newProjectStateId;(this.host?e===this.projectStateId&&false===t.authorIsHost&&0===this.update.length:e===this.projectStateId)?(this.update=[],this.worm.executeCommands(t.instructions),this.projectStateId=n,this.subscribers.forEach((function(t){return t()}))):this.host||this.dispatch({authorId:this.authorId,authorIsHost:false,type:"requestProject"});}},t}(),f=function(t){function n(e,n){var r=t.call(this,e.dispatch)||this;return r.host=true,r.worm=n,r.projectStateId="ps".concat(d()),r.dispatch({authorId:r.authorId,authorIsHost:true,type:"hostIsConnected"}),r}return e(n,t),Object.defineProperty(n.prototype,"initialized",{get:function(){return  true},enumerable:false,configurable:true}),n.fromProject=function(t,e){return new n(t,new s(e,t.projectTransformer))},n.fromSerializedWorm=function(t,e){return new n(t,s.deserialize(e,t.projectTransformer))},n.prototype.receive=function(t){if(t.authorId!==this.authorId)switch(t.type){case "requestProject":this.pushProject(t.requestId);break;case "hostIsConnected":case "pushProject":break;case "pushUpdate":this.processUpdate(t);break;default:throw new Error("Invalid event type")}},n.prototype.pushProject=function(t){this.dispatch({authorId:this.authorId,authorIsHost:true,type:"pushProject",serializedWorm:this.worm.serialize(),initialProjectStateId:this.projectStateId,requestId:t});},n}(l),p=function(t){function n(e){var n=t.call(this,e.dispatch)||this;return n.host=false,n.projectRequestCallbacks={},n.__projectTransformer=e.projectTransformer,n}return e(n,t),Object.defineProperty(n.prototype,"initialized",{get:function(){return void 0!==this.worm&&void 0!==this.projectStateId},enumerable:false,configurable:true}),n.prototype.receive=function(t){if(t.authorId!==this.authorId)switch(t.type){case "requestProject":break;case "hostIsConnected":this.requestProject();break;case "pushProject":this.worm=s.deserialize(t.serializedWorm,this.__projectTransformer),this.projectStateId=t.initialProjectStateId,t.requestId&&this.projectRequestCallbacks[t.requestId]&&(this.projectRequestCallbacks[t.requestId](),delete this.projectRequestCallbacks[t.requestId]),this.subscribers.forEach((function(t){return t()}));break;case "pushUpdate":this.processUpdate(t);break;default:throw new Error("Invalid event type")}},n.prototype.requestProject=function(t){var e;t&&(e="r".concat(d()),this.projectRequestCallbacks[e]=t),this.dispatch({authorId:this.authorId,authorIsHost:false,type:"requestProject",requestId:e});},n}(l),d=function(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;n<10;n++)t+=e.charAt(Math.floor(52*Math.random()));return t},g=Symbol.for("immer-nothing"),v=Symbol.for("immer-draftable"),y=Symbol.for("immer-state");function _(t,...e){throw new Error(`[Immer] minified error nr: ${t}. Full error at: https://bit.ly/3cXEKWf`)}var w=Object.getPrototypeOf;function b(t){return !!t&&!!t[y]}function S(t){return !!t&&(P(t)||Array.isArray(t)||!!t[v]||!!t.constructor?.[v]||C(t)||N(t))}var I=Object.prototype.constructor.toString();function P(t){if(!t||"object"!=typeof t)return  false;const e=w(t);if(null===e)return  true;const n=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===I}function x(t,e){0===D(t)?Reflect.ownKeys(t).forEach((n=>{e(n,t[n],t);})):t.forEach(((n,r)=>e(r,n,t)));}function D(t){const e=t[y];return e?e.type_:Array.isArray(t)?1:C(t)?2:N(t)?3:0}function j(t,e){return 2===D(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function E(t,e,n){const r=D(t);2===r?t.set(e,n):3===r?t.add(n):t[e]=n;}function C(t){return t instanceof Map}function N(t){return t instanceof Set}function O(t){return t.copy_||t.base_}function T(t,e){if(C(t))return new Map(t);if(N(t))return new Set(t);if(Array.isArray(t))return Array.prototype.slice.call(t);const n=P(t);if(true===e||"class_only"===e&&!n){const e=Object.getOwnPropertyDescriptors(t);delete e[y];let n=Reflect.ownKeys(e);for(let r=0;r<n.length;r++){const i=n[r],a=e[i];false===a.writable&&(a.writable=true,a.configurable=true),(a.get||a.set)&&(e[i]={configurable:true,writable:true,enumerable:a.enumerable,value:t[i]});}return Object.create(w(t),e)}{const e=w(t);if(null!==e&&n)return {...t};const r=Object.create(e);return Object.assign(r,t)}}function z(t,e=false){return U(t)||b(t)||!S(t)||(D(t)>1&&(t.set=t.add=t.clear=t.delete=k),Object.freeze(t),e&&Object.entries(t).forEach((([t,e])=>z(e,true)))),t}function k(){_(2);}function U(t){return Object.isFrozen(t)}var A,V={};function M(t){const e=V[t];return e||_(0,t),e}function R(){return A}function B(t,e){e&&(M("Patches"),t.patches_=[],t.inversePatches_=[],t.patchListener_=e);}function F(t){W(t),t.drafts_.forEach(q),t.drafts_=null;}function W(t){t===A&&(A=t.parent_);}function L(t){return A={drafts_:[],parent_:A,immer_:t,canAutoFreeze_:true,unfinalizedDrafts_:0}}function q(t){const e=t[y];0===e.type_||1===e.type_?e.revoke_():e.revoked_=true;}function H(t,e){e.unfinalizedDrafts_=e.drafts_.length;const n=e.drafts_[0];return void 0!==t&&t!==n?(n[y].modified_&&(F(e),_(4)),S(t)&&(t=$(e,t),e.parent_||G(e,t)),e.patches_&&M("Patches").generateReplacementPatches_(n[y].base_,t,e.patches_,e.inversePatches_)):t=$(e,n,[]),F(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),t!==g?t:void 0}function $(t,e,n){if(U(e))return e;const r=e[y];if(!r)return x(e,((i,a)=>K(t,r,e,i,a,n))),e;if(r.scope_!==t)return e;if(!r.modified_)return G(t,r.base_,true),r.base_;if(!r.finalized_){r.finalized_=true,r.scope_.unfinalizedDrafts_--;const e=r.copy_;let i=e,a=false;3===r.type_&&(i=new Set(e),e.clear(),a=true),x(i,((i,o)=>K(t,r,e,i,o,n,a))),G(t,e,false),n&&t.patches_&&M("Patches").generatePatches_(r,n,t.patches_,t.inversePatches_);}return r.copy_}function K(t,e,n,r,i,a,o){if(b(i)){const o=$(t,i,a&&e&&3!==e.type_&&!j(e.assigned_,r)?a.concat(r):void 0);if(E(n,r,o),!b(o))return;t.canAutoFreeze_=false;}else o&&n.add(i);if(S(i)&&!U(i)){if(!t.immer_.autoFreeze_&&t.unfinalizedDrafts_<1)return;$(t,i),e&&e.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||G(t,i);}}function G(t,e,n=false){!t.parent_&&t.immer_.autoFreeze_&&t.canAutoFreeze_&&z(e,n);}var J={get(t,e){if(e===y)return t;const n=O(t);if(!j(n,e))return function(t,e,n){const r=Y(e,n);return r?"value"in r?r.value:r.get?.call(t.draft_):void 0}(t,n,e);const r=n[e];return t.finalized_||!S(r)?r:r===Z(t.base_,e)?(tt(t),t.copy_[e]=et(r,t)):r},has:(t,e)=>e in O(t),ownKeys:t=>Reflect.ownKeys(O(t)),set(t,e,n){const r=Y(O(t),e);if(r?.set)return r.set.call(t.draft_,n),true;if(!t.modified_){const r=Z(O(t),e),o=r?.[y];if(o&&o.base_===n)return t.copy_[e]=n,t.assigned_[e]=false,true;if(((i=n)===(a=r)?0!==i||1/i==1/a:i!=i&&a!=a)&&(void 0!==n||j(t.base_,e)))return  true;tt(t),Q(t);}var i,a;return t.copy_[e]===n&&(void 0!==n||e in t.copy_)||Number.isNaN(n)&&Number.isNaN(t.copy_[e])||(t.copy_[e]=n,t.assigned_[e]=true),true},deleteProperty:(t,e)=>(void 0!==Z(t.base_,e)||e in t.base_?(t.assigned_[e]=false,tt(t),Q(t)):delete t.assigned_[e],t.copy_&&delete t.copy_[e],true),getOwnPropertyDescriptor(t,e){const n=O(t),r=Reflect.getOwnPropertyDescriptor(n,e);return r?{writable:true,configurable:1!==t.type_||"length"!==e,enumerable:r.enumerable,value:n[e]}:r},defineProperty(){_(11);},getPrototypeOf:t=>w(t.base_),setPrototypeOf(){_(12);}},X={};function Z(t,e){const n=t[y];return (n?O(n):t)[e]}function Y(t,e){if(!(e in t))return;let n=w(t);for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=w(n);}}function Q(t){t.modified_||(t.modified_=true,t.parent_&&Q(t.parent_));}function tt(t){t.copy_||(t.copy_=T(t.base_,t.scope_.immer_.useStrictShallowCopy_));}x(J,((t,e)=>{X[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)};})),X.deleteProperty=function(t,e){return X.set.call(this,t,e,void 0)},X.set=function(t,e,n){return J.set.call(this,t[0],e,n,t[0])};function et(t,e){const n=C(t)?M("MapSet").proxyMap_(t,e):N(t)?M("MapSet").proxySet_(t,e):function(t,e){const n=Array.isArray(t),r={type_:n?1:0,scope_:e?e.scope_:R(),modified_:false,finalized_:false,assigned_:{},parent_:e,base_:t,draft_:null,copy_:null,revoke_:null,isManual_:false};let i=r,a=J;n&&(i=[r],a=X);const{revoke:o,proxy:u}=Proxy.revocable(i,a);return r.draft_=u,r.revoke_=o,u}(t,e);return (e?e.scope_:R()).drafts_.push(n),n}function nt(t){if(!S(t)||U(t))return t;const e=t[y];let n;if(e){if(!e.modified_)return e.base_;e.finalized_=true,n=T(t,e.scope_.immer_.useStrictShallowCopy_);}else n=T(t,true);return x(n,((t,e)=>{E(n,t,nt(e));})),e&&(e.finalized_=false),n}var rt=new class{constructor(t){this.autoFreeze_=true,this.useStrictShallowCopy_=false,this.produce=(t,e,n)=>{if("function"==typeof t&&"function"!=typeof e){const n=e;e=t;const r=this;return function(t=n,...i){return r.produce(t,(t=>e.call(this,t,...i)))}}let r;if("function"!=typeof e&&_(6),void 0!==n&&"function"!=typeof n&&_(7),S(t)){const i=L(this),a=et(t,void 0);let o=true;try{r=e(a),o=!1;}finally{o?F(i):W(i);}return B(i,n),H(r,i)}if(!t||"object"!=typeof t){if(r=e(t),void 0===r&&(r=t),r===g&&(r=void 0),this.autoFreeze_&&z(r,true),n){const e=[],i=[];M("Patches").generateReplacementPatches_(t,r,e,i),n(e,i);}return r}_(1,t);},this.produceWithPatches=(t,e)=>{if("function"==typeof t)return (e,...n)=>this.produceWithPatches(e,(e=>t(e,...n)));let n,r;return [this.produce(t,e,((t,e)=>{n=t,r=e;})),n,r]},"boolean"==typeof t?.autoFreeze&&this.setAutoFreeze(t.autoFreeze),"boolean"==typeof t?.useStrictShallowCopy&&this.setUseStrictShallowCopy(t.useStrictShallowCopy);}createDraft(t){S(t)||_(8),b(t)&&(t=function(t){b(t)||_(10,t);return nt(t)}(t));const e=L(this),n=et(t,void 0);return n[y].isManual_=true,W(e),n}finishDraft(t,e){const n=t&&t[y];n&&n.isManual_||_(9);const{scope_:r}=n;return B(r,e),H(void 0,r)}setAutoFreeze(t){this.autoFreeze_=t;}setUseStrictShallowCopy(t){this.useStrictShallowCopy_=t;}applyPatches(t,e){let n;for(n=e.length-1;n>=0;n--){const r=e[n];if(0===r.path.length&&"replace"===r.op){t=r.value;break}}n>-1&&(e=e.slice(n+1));const r=M("Patches").applyPatches_;return b(t)?r(t,e):this.produce(t,(t=>r(t,e)))}},it=rt.produce;function at(t,e){var n=e.pinId,r=false;for(var i in t.signalData){var a=t.signalData[i],o=a.pinIds.indexOf(n);if(-1!==o){a.pinIds.splice(o,1),delete a.pinTimes[n],delete a.pinValues[n],"continuous"===a.type&&(delete a.curves[n],"bezier"in a&&delete a.bezierControlPoints[n]),r=true;break}}if(!r)throw new Error("Pin with id ".concat(n," not found"));t.orgData.pinIds=t.orgData.pinIds.filter((function(t){return t!==n})),delete t.orgData.signalIdByPinId[n];}rt.produceWithPatches.bind(rt),rt.setAutoFreeze.bind(rt),rt.setUseStrictShallowCopy.bind(rt),rt.applyPatches.bind(rt),rt.createDraft.bind(rt),rt.finishDraft.bind(rt);var ot={addPin:function(t,e){var n=e.signalId,r=e.pinId,a=e.pinTime,o=e.pinValue,u=e.functionString,s=e.bezierControlPoints,c=t.signalData[n];if(!c)throw new Error("Signal with id ".concat(n," not found"));var l=c.type;if("continuous"===l&&"number"!=typeof o)throw new Error("Pin value must be a number for continuous signals");if("discrete"===l&&"string"!=typeof o)throw new Error("Pin value must be a string for discrete signals");for(var f in t.signalData){if(t.signalData[f].pinIds.includes(r))throw new Error("Pin with id ".concat(r," already exists"))}if(Object.values(c.pinTimes).includes(a))throw new Error("Pin time must be unique within the signal");var p=t.timelineData.numberOfFrames;if(a<0||a>p)throw new Error("Pin time must be between 0 and ".concat(p));if("continuous"===l){var d=i(c.range,2),h=d[0],g=d[1];if(o<h||o>g)throw new Error("Pin value must be between ".concat(h," and ").concat(g));if(!u)throw new Error("Curve is required for continuous signals");if("bezier"in c){if(!c.bezierControlPoints)throw new Error("Bezier control points are required for continuous bezier signals");if(!s)throw new Error("Bezier control points are required for continuous bezier signals");c.bezierControlPoints[r]=s;}}var v=c.pinIds;if(0===v.length)c.pinIds.push(r);else {var y=v.findIndex((function(t){return c.pinTimes[t]>=a}));-1===y&&(y=v.length),c.pinIds.splice(y,0,r);}c.pinTimes[r]=a,c.pinValues[r]=o,"continuous"===l&&(c.curves[r]=u),t.orgData.pinIds.push(r),t.orgData.signalIdByPinId[r]=n;},deletePin:at,updatePinTime:function(t,e){var n=e.pinId,r=e.pinTime,i=t.timelineData.numberOfFrames;if(r<0||r>i)throw new Error("Pin time must be between 0 and ".concat(i));var a=false,o=function(e){var i=t.signalData[e];if(i.pinIds.includes(n)){i.pinTimes[n]=r;var o=i.pinIds,u=o.indexOf(n);o.splice(u,1);var s=o.findIndex((function(t){return i.pinTimes[t]>=r}));return  -1===s&&(s=o.length),o.splice(s,0,n),a=true,"break"}};for(var u in t.signalData){if("break"===o(u))break}if(!a)throw new Error("Pin with id ".concat(n," not found"))},updatePinValue:function(t,e){var n=e.pinId,r=e.pinValue,a=false;for(var o in t.signalData){var u=t.signalData[o];if(u.pinIds.includes(n)){if("continuous"===u.type&&"number"!=typeof r)throw new Error("Pin value must be a number for continuous signals");if("discrete"===u.type&&"string"!=typeof r)throw new Error("Pin value must be a string for discrete signals");if("continuous"===u.type){var s=i(u.range,2),c=s[0],l=s[1];if(r<c||r>l)throw new Error("Pin value must be between ".concat(c," and ").concat(l))}u.pinValues[n]=r,a=true;break}}if(!a)throw new Error("Pin with id ".concat(n," not found"))},updatePins:function(t,e){var n,a,o=e.pins,u=function(e){var n=e.pinId,r=e.pinTime,a=e.pinValue,o=e.functionString,u=t.orgData.signalIdByPinId[n];if(!u)throw new Error("Pin with id ".concat(n," not found"));var s=t.signalData[u];if("continuous"===s.type&&"number"!=typeof a)throw new Error("Pin value must be a number for continuous signals");if("discrete"===s.type&&"string"!=typeof a)throw new Error("Pin value must be a string for discrete signals");if("continuous"===s.type){var c=i(s.range,2),l=c[0],f=c[1];if(a<l||a>f)throw new Error("Pin value must be between ".concat(l," and ").concat(f));if(!o)throw new Error("Curve is required for continuous signals")}s.pinTimes[n]=r,s.pinValues[n]=a;var p=s.pinIds,d=p.indexOf(n);p.splice(d,1);var h=p.findIndex((function(t){return s.pinTimes[t]>=r}));-1===h&&(h=p.length),p.splice(h,0,n),"continuous"===s.type&&(s.curves[n]=o);};try{for(var s=r(o),c=s.next();!c.done;c=s.next()){u(c.value);}}catch(t){n={error:t};}finally{try{c&&!c.done&&(a=s.return)&&a.call(s);}finally{if(n)throw n.error}}},updateCurve:function(t,e){var n=e.pinId,r=e.functionString,i=false;for(var a in t.signalData){var o=t.signalData[a];if("discrete"!==o.type&&o.pinIds.includes(n)){o.curves[n]=r,i=true;break}}if(!i)throw new Error("Pin with id ".concat(n," not found"))},createSignal:function(t,e){var n,r=e.signalId,a=e.signalType,o=e.signalName,u=e.range,s=e.defaultValue,c=e.displayValues,l=e.isStatic,f=e.bezier,p=e.defaultCurve;if(t.signalData[r])throw new Error("Signal with id ".concat(r," already exists"));if("continuous"!==a&&"discrete"!==a)throw new Error("Signal type must be continuous or discrete");if("continuous"===a){if(!u)throw new Error("Range is required for continuous signals");var d=i(u,2);if(d[0]>=d[1])throw new Error("Min value must be less than max value");if("number"!=typeof s)throw new Error("Default value must be a number for continuous signals");if(!p)throw new Error("Default curve is required for continuous signals");n=f?{id:r,type:a,range:u,defaultValue:s,isStatic:l,bezier:true,bezierControlPoints:{},defaultCurve:p,pinIds:[],pinTimes:{},pinValues:{},curves:{}}:{id:r,type:a,range:u,defaultValue:s,isStatic:l,defaultCurve:p,pinIds:[],pinTimes:{},pinValues:{},curves:{}};}if("discrete"===a){if("string"!=typeof s)throw new Error("Default value must be a string for discrete signals");n={id:r,type:a,pinIds:[],defaultValue:s,displayValues:c,isStatic:l,pinTimes:{},pinValues:{}};}t.signalData[r]=n,t.orgData.signalIds.push(r),t.orgData.signalNames[r]=o,t.orgData.signalTypes[r]=a,t.orgData.activeSignalIds.push(r);},deleteSignal:function(t,e){var n=e.signalId;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var r=t.signalData[n].pinIds;r.forEach((function(e){return delete t.orgData.signalIdByPinId[e]})),r.forEach((function(e){return t.orgData.pinIds=t.orgData.pinIds.filter((function(t){return t!==e}))})),delete t.signalData[n],t.orgData.signalIds=t.orgData.signalIds.filter((function(t){return t!==n})),delete t.orgData.signalNames[n],t.orgData.activeSignalIds=t.orgData.activeSignalIds.filter((function(t){return t!==n})),delete t.orgData.signalTypes[n];},updateSignalName:function(t,e){var n=e.signalId,r=e.signalName;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));t.orgData.signalNames[n]=r;},updateSignalRange:function(t,e){var n=e.signalId,r=e.range;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));if("continuous"!==t.signalData[n].type)throw new Error("Range can only be updated for continuous signals");var a=i(r,2);if(a[0]>=a[1])throw new Error("Min value must be less than max value");t.signalData[n].range=r;},updateSignalIndex:function(t,e){var n=e.signalId,r=e.index,i=t.orgData.signalIds,a=i.indexOf(n);if(-1===a)throw new Error("Signal with id ".concat(n," not found"));i.splice(a,1),i.splice(r,0,n);},updateSignalActiveStatus:function(t,e){var n=e.signalId,r=e.active;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var i=t.orgData.activeSignalIds,a=i.indexOf(n);r&&-1===a&&i.push(n),r||-1===a||i.splice(a,1);},updateFramesPerSecond:function(t,e){var n=e.framesPerSecond;if(n<=0)throw new Error("Frames per second must be greater than 0");t.timelineData.framesPerSecond=n;},updatePlayheadPosition:function(t,e){var n=e.playheadPosition;if(n<0||n>t.timelineData.numberOfFrames)throw new Error("Playhead position must be between 0 and ".concat(t.timelineData.numberOfFrames));t.timelineData.playheadPosition=n;},updateNumberOfFrames:function(t,e){var n,i,a=e.numberOfFrames;if(a<=0)throw new Error("Number of frames must be greater than 0");for(var o in t.timelineData.numberOfFrames=a,t.signalData){var u=t.signalData[o];try{for(var s=(n=void 0,r(u.pinIds)),c=s.next();!c.done;c=s.next()){var l=c.value;u.pinTimes[l]>a&&at(t,{type:"deletePin",pinId:l});}}catch(t){n={error:t};}finally{try{c&&!c.done&&(i=s.return)&&i.call(s);}finally{if(n)throw n.error}}}},updateProjectName:function(t,e){var n=e.projectName;t.metaData.name=n;},updateFocusRange:function(t,e){var n=e.focusRange,r=i(n,2),a=r[0],o=r[1];if(a<0||o>t.timelineData.numberOfFrames||a>=o)throw new Error("Invalid focus range");t.timelineData.focusRange=n;},updateCurveTemplate:function(t,e){var n=e.curveId,r=e.functionString;if(!t.templateData[n])throw new Error("Curve template with id ".concat(n," not found"));t.templateData[n]=r;},addCurveTemplate:function(t,e){var n=e.curveId,r=e.functionString;if(t.templateData[n])throw new Error("Curve template with id ".concat(n," already exists"));t.templateData[n]=r;},deleteCurveTemplate:function(t,e){var n=e.curveId;if(!t.templateData[n])throw new Error("Curve template with id ".concat(n," not found"));delete t.templateData[n];},updatePinBezierControlPoints:function(t,e){var n=e.pinId,r=e.bezierControlPoints,i=t.orgData.signalIdByPinId[n];if(!i)throw new Error("Pin with id ".concat(n," not found"));t.signalData[i].bezierControlPoints[n]=r;},updateSignalDefaultValue:function(t,e){var n=e.signalId,r=e.defaultValue;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));var i=t.signalData[n];if("continuous"===i.type&&"number"!=typeof r)throw new Error("Default value must be a number for continuous signals");if("discrete"===i.type&&"string"!=typeof r)throw new Error("Default value must be a string for discrete signals");i.defaultValue=r;},updateSignalDefaultCurve:function(t,e){var n=e.signalId,r=e.defaultCurve;if(!t.signalData[n])throw new Error("Signal with id ".concat(n," not found"));t.signalData[n].defaultCurve=r;},updatePlaying:function(t,e){var n=e.playing;t.timelineData.playing=n;}};function ut(t,e){return it(t,(function(t){for(var n=0;n<e.length;n++){var r=e[n];(0, ot[r.type])(t,r);}}))}function ct(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}var lt={type:"saveAsNamedState",namedState:"commit"},ft={type:"goToNamedState",namedState:"commit"};function pt(t,e,n,r,i,a,o){if(a&&!o){t.timelineData.numberOfFrames;o=[-5,0,5,0];}return {type:"addPin",signalId:e,pinId:n,pinTime:r,pinValue:i,functionString:a,bezierControlPoints:o}}function dt(t,e){var n=t(),r=Object.keys(n.signalData).find((function(t){var r;return null===(r=n.signalData[t])||void 0===r?void 0:r.pinIds.includes(e)}));if(!r)throw new Error("Pin not found");var i=n.signalData[r].type,a="continuous"===i&&"bezier"in n.signalData[r],o=n.signalData[r].pinTimes[e],u=n.signalData[r].pinValues[e],s="continuous"===i?n.signalData[r].curves[e]:void 0,c=a?n.signalData[r].bezierControlPoints[e]:void 0;return {type:"addNextState",forward:[{type:"deletePin",pinId:e}],backward:[pt(n,r,e,o,u,s,c)]}}var ht=f,gt=p,vt=ut,yt=function(){function t(t,e,n,r){if(e){if(!n&&!r)throw new Error("Project or worm must be provided to host project controller");var i=void 0;if(n&&(i=ht.fromProject({dispatch:t,projectTransformer:vt},n)).worm.saveAsNamedState("commit"),r&&(i=ht.fromSerializedWorm({dispatch:t,projectTransformer:vt},r)),!i)throw new Error("Project node not created");this.projectNode=i,this.connectToHost=function(){throw new Error("Host project controller cannot connect to host")};}else {this.projectNode=new gt({dispatch:t,projectTransformer:vt});var a=this.projectNode.requestProject.bind(this.projectNode);this.connectToHost=a;}}return t.Host=function(e,n){return new t(e,true,n)},t.HostFromProject=function(e,n){return new t(e,true,n)},t.prototype.serializeWorm=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");if(!this.projectNode.worm)throw new Error("Project node worm not found");return this.projectNode.worm.serialize()},t.HostFromSerializedWorm=function(e,n){return new t(e,true,void 0,n)},t.Client=function(e){return new t(e,false,void 0)},t.prototype.receive=function(t){this.projectNode.receive(t);},Object.defineProperty(t.prototype,"projectTools",{get:function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");var t=this.projectNode.pushUpdate.bind(this.projectNode),e=this.projectNode.getProject.bind(this.projectNode),n=this.projectNode.pushCommand.bind(this.projectNode);this.projectNode.pushCommands.bind(this.projectNode);return function(t,e,n,r){function a(){e((function(){return ft}));}function o(){e((function(){return lt}));}return {returnToLastCommit:function(){a();},pushUpdate:t,addPinContinuous:function(n,i,u,s,c,l){l&&a(),e((function(){var t=r(),e=t.signalData[n],a=e.pinTimes,o=e.pinIds.findIndex((function(t){return a[t]===u})),l=[];-1!==o&&l.push({type:"deletePin",pinId:e.pinIds[o]}),l.push(pt(t,n,i,u,s,c));var f=[];if(f.push({type:"deletePin",pinId:i}),-1!==o){var p=e.pinIds[o];f.push(pt(t,n,p,e.pinTimes[p],e.pinValues[p],e.curves[p]));}return {type:"addNextState",forward:l,backward:f}})),l&&(o(),t());},addPinDiscrete:function(n,i,u,s,c){c&&a(),e((function(){var t=r(),e=t.signalData[n],a=e.pinTimes,o=e.pinIds.findIndex((function(t){return a[t]===u})),c=[];-1!==o&&c.push({type:"deletePin",pinId:e.pinIds[o]}),c.push(pt(t,n,i,u,s));var l=[];if(l.push({type:"deletePin",pinId:i}),-1!==o){var f=e.pinIds[o];l.push(pt(t,n,f,e.pinTimes[f],e.pinValues[f]));}return {type:"addNextState",forward:c,backward:l}})),c&&(o(),t());},deletePin:function(n){a(),e((function(){return dt(r,n)})),o(),t();},deletePins:function(n){a(),n.forEach((function(t){e((function(){return dt(r,t)}));})),o(),t();},updatePins:function(n,i){i&&a();var u=r(),s={type:"updatePins",pins:[]},c={type:"updatePins",pins:[]};n.forEach((function(t){var e=t.pinId,n=u.orgData.signalIdByPinId[e],r=t.pinTime,i=t.pinValue,a="continuous"===t.pinType?t.functionString:void 0,o=u.signalData[n].pinTimes[e],l=u.signalData[n].pinValues[e],f="continuous"===t.pinType?u.signalData[n].curves[e]:void 0,p={pinId:e,pinTime:null!=r?r:o,pinValue:null!=i?i:l,functionString:null!=a?a:f},d={pinId:e,pinTime:o,pinValue:l,functionString:f};s.pins.push(p),c.pins.push(d);})),e((function(){return {type:"addNextState",forward:[s],backward:[c]}})),i&&o(),t();},updateCurve:function(n,i){a(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update curve of discrete signal");return {type:"addNextState",forward:[{type:"updateCurve",pinId:n,functionString:i}],backward:[{type:"updateCurve",pinId:n,functionString:t.signalData[e].curves[n]}]}})),o(),t();},updatePinBezierControlPoints:function(n,i,u){u&&a(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update bezier control points of discrete signal");if(!("bezier"in t.signalData[e]))throw new Error("Signal is not a bezier signal");return {type:"addNextState",forward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:i}],backward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:t.signalData[e].bezierControlPoints[n]}]}})),u&&o(),t();},createDiscreteSignal:function(n,r,i,u){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:i,isStatic:u,displayValues:true}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createDiscreteBeatSignal:function(n,r){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:"beat"}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createContinuousSignal:function(n,r,i,u,s,c){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createContinuousBezierSignal:function(n,r,i,u,s,c){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c,bezier:true}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},duplicateSignal:function(n){a();var i=ct();e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");var a=t.orgData.signalNames[n],o=e.defaultValue,u="continuous"===e.type?e.defaultCurve:void 0,s=e.isStatic,c="continuous"===e.type&&"bezier"in e,l="discrete"===e.type?e.displayValues:void 0,f=a+"_copy",p="continuous"===e.type?e.range:void 0;return {type:"addNextState",forward:[{type:"createSignal",signalId:i,signalType:e.type,signalName:f,range:p,defaultValue:o,defaultCurve:u,isStatic:s,bezier:!!c||void 0,displayValues:!!l||void 0}],backward:[{type:"deleteSignal",signalId:i}]}})),e((function(){var t=r(),e=t.signalData[n].pinIds,a=t.signalData[n].type,o=e.map((function(e){var r,i=t.signalData[n].pinTimes[e],o=t.signalData[n].pinValues[e];return "continuous"===a&&(r=t.signalData[n].curves[e]),{pinTime:i,pinValue:o,functionString:r,pinId:ct()}}));return {type:"addNextState",forward:o.map((function(e){return pt(t,i,e.pinId,e.pinTime,e.pinValue,e.functionString)})),backward:o.map((function(t){return {type:"deletePin",pinId:t.pinId}}))}})),o(),t();},deleteSignal:function(n){a(),e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"deleteSignal",signalId:n}],backward:[{type:"createSignal",signalId:n,signalType:e.type,signalName:t.orgData.signalNames[n],range:"continuous"===e.type?e.range:void 0,defaultValue:e.defaultValue,defaultCurve:"continuous"===e.type?e.defaultCurve:void 0,isStatic:e.isStatic,bezier:"continuous"===e.type&&"bezier"in e||void 0,bezierControlPoints:"continuous"===e.type&&"bezier"in e?e.bezierControlPoints:void 0,displayValues:"discrete"===e.type?e.displayValues:void 0}]}})),o(),t();},updateSignalDefaultValue:function(n,i){a(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:i}],backward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:t.defaultValue}]}})),o(),t();},updateSignalName:function(n,i){a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalName",signalId:n,signalName:i}],backward:[{type:"updateSignalName",signalId:n,signalName:t.orgData.signalNames[n]}]}})),o(),t();},updateSignalRange:function(n,i){a(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");if("discrete"===t.type)throw new Error("Cannot update range of discrete signal");return {type:"addNextState",forward:[{type:"updateSignalRange",signalId:n,range:i}],backward:[{type:"updateSignalRange",signalId:n,range:t.range}]}})),o(),t();},updateSignalIndex:function(n,i,u){u&&a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalIndex",signalId:n,index:i}],backward:[{type:"updateSignalIndex",signalId:n,index:t.orgData.activeSignalIds.indexOf(n)}]}})),u&&o(),t();},updateSignalActiveStatus:function(n,i){a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalActiveStatus",signalId:n,active:i}],backward:[{type:"updateSignalActiveStatus",signalId:n,active:t.orgData.activeSignalIds.includes(n)}]}})),o(),t();},updateFramesPerSecond:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFramesPerSecond",framesPerSecond:n}],backward:[{type:"updateFramesPerSecond",framesPerSecond:t.timelineData.framesPerSecond}]}})),o(),t();},updatePlayheadPosition:function(n,i){i&&a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:t.timelineData.playheadPosition}]}})),i&&o(),t();},playNextFrame:function(n){var o=r(),u=o.timelineData.playheadPosition,s=i(o.timelineData.focusRange,2);s[0],s[1],a(),e((function(){return {type:"addNextState",forward:[{type:"updatePlaying",playing:true},{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:u},{type:"updatePlaying",playing:false}]}})),t();},updateFocusRange:function(n){var u=i(n,2),s=u[0],c=u[1];a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFocusRange",focusRange:[s,c]}],backward:[{type:"updateFocusRange",focusRange:t.timelineData.focusRange}]}})),o(),t();},updateNumberOfFrames:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateNumberOfFrames",numberOfFrames:n}],backward:[{type:"updateNumberOfFrames",numberOfFrames:t.timelineData.numberOfFrames}]}})),o(),t();},updateProjectName:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateProjectName",projectName:n}],backward:[{type:"updateProjectName",projectName:t.metaData.name}]}})),o(),t();},undo:function(){a(),e((function(){return {type:"previous"}})),o(),t();},redo:function(){a(),e((function(){return {type:"next"}})),o(),t();},addCurveTemplate:function(n,r){e((function(){return {type:"appendToCurrentState",forward:[{type:"addCurveTemplate",curveId:n,functionString:r}],backward:[{type:"deleteCurveTemplate",curveId:n}]}})),t();},deleteCurveTemplate:function(n){e((function(){return {type:"appendToCurrentState",forward:[{type:"deleteCurveTemplate",curveId:n}],backward:[{type:"addCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();},updateCurveTemplate:function(n,i){e((function(){return {type:"appendToCurrentState",forward:[{type:"updateCurveTemplate",curveId:n,functionString:i}],backward:[{type:"updateCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();}}}(t,n,0,e)},enumerable:false,configurable:true}),t.prototype.getProject=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");return this.projectNode.getProject()},t.prototype.prettyPrintProject=function(){if(!this.projectNode.initialized)throw new Error("Project not initialized");console.log(JSON.stringify(this.projectNode.getProject(),null,2));},t.prototype.subscribeToProjectUpdates=function(t){return this.projectNode.subscribeToProjectUpdates(t)},t.prototype.interpolateSignalValueAtTime=function(t,e){if(!this.projectNode.initialized)throw new Error("Project not initialized");var n=this.projectNode.getProject();return Rt(n,t,e)},t}();var mt=Object.freeze({__proto__:null,dispatchProjectEvent:function(t,e,n){ void 0===n&&(n="default");var r=new URL(e).origin;return function(e){var i={type:"projectNodeEvent",event:e,channel:n};t.postMessage(i,r);}},subscribeToProjectEvents:function(t,e){ void 0===e&&(e="default");var n=new URL(t).origin;return function(t){function r(r){if(r.origin===n&&"projectNodeEvent"===r.data.type&&r.data.channel===e){var i=r.data.event;t(i);}}return window.addEventListener("message",r),function(){return window.removeEventListener("message",r)}}}});var _t=Object.freeze({__proto__:null,dispatchProjectEvent:function(t){return void 0===t&&(t="default"),function(e){var n=new CustomEvent("projectNodeEvent",{detail:{event:e,channel:t}});window.dispatchEvent(n);}},subscribeToProjectEvents:function(t){return void 0===t&&(t="default"),function(e){function n(n){if("projectNodeEvent"===n.type&&n.detail.channel===t){var r=n.detail.event;e(r);}}return window.addEventListener("projectNodeEvent",n),function(){return window.removeEventListener("projectNodeEvent",n)}}}}),wt=Object.freeze({__proto__:null,CustomEventAPI:_t,PinsAndCurvesProjectController:yt,PostMessageAPI:mt});function bt(t,e,n){var r=i(t,2),a=r[0],o=r[1],u=i(e,2),s=u[0],c=u[1],l=i(n,2),f=l[0],p=l[1],d=(a-s)*(a-f)*(s-f);return 0===d?{a:0,b:0,c:0}:{a:(o*(s-f)+c*(f-a)+p*(a-s))/d,b:(o*(Math.pow(f,2)-Math.pow(s,2))+c*(Math.pow(a,2)-Math.pow(f,2))+p*(Math.pow(s,2)-Math.pow(a,2)))/d,c:(o*(s*f*(s-f))+c*(f*a*(f-a))+p*(a*s*(a-s)))/d}}var St=function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds.indexOf(t.pinId);return 0===r?t.range[0]:0===(r-1)%2?function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds,i=r.indexOf(t.pinId);if(0===i)return t.previousPinValue;if(i===r.length-1)return t.nextPinValue;var a=r[i-1],o=r[i+1],u=bt([e.signalData[n].pinTimes[a],e.signalData[n].pinValues[a]],[t.nextPinTime,t.nextPinValue],[e.signalData[n].pinTimes[o],e.signalData[n].pinValues[o]]),s=u.a,c=u.b,l=u.c,f=t.frame,p=s*f*f+c*f+l;return isNaN(p)?t.nextPinValue:p}(t):function(t){var e=t.project,n=t.project.orgData.signalIdByPinId[t.pinId],r=e.signalData[n].pinIds,i=r.indexOf(t.pinId);if(i<2)return t.previousPinValue;var a=r[i-1],o=r[i-2],u=e.signalData[n].pinTimes[a],s=e.signalData[n].pinValues[a],c=t.nextPinTime,l=t.nextPinValue,f=bt([e.signalData[n].pinTimes[o],e.signalData[n].pinValues[o]],[u,s],[c,l]),p=f.a,d=f.b,h=f.c,g=t.frame,v=p*g*g+d*g+h;return isNaN(v)?t.nextPinValue:v}(t)};var It=function(t){var e,n=((e=t%2147483647)<=0&&(e+=2147483646),function(){return ((e=16807*e%2147483647)-1)/2147483646}),r=Array(256).fill(0).map((function(){return 2*n()-1})),o=Array(256).fill(0).map((function(t,e){return e})).sort((function(){return n()-.5})),u=a(a([],i(o),false),i(o),false);return function(t){var e,n=255&Math.floor(t),i=t-Math.floor(t),a=(e=i)*e*e*(e*(6*e-15)+10);return function(t,e,n){return t+n*(e-t)}(r[u[n]]*i,r[u[n+1]]*(i-1),a)}}(42);function Pt(t,e,n){return t+(e-t)*n}function xt(t){return t*t*t}function Dt(t){return 1-Math.pow(1-t,3)}function jt(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}function Et(t){var e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1}var Ct={};function Nt(t,e){t in Ct||(Ct[t]=e);}function Ot(t){return t in Ct?Ct[t]:null}function Tt(t){var e=t.nextPinTime,n=t.project,r=t.range,a=t.defaultValue,o=t.pinId,u=t.frame,s=t.numberOfFrames,c=t.framesPerSecond,l=t.nextPinValue,f=t.previousPinTime,p=t.previousPinValue,d=t.relativeTime,h=t.interpolateSignalValueAtTime,g=i(r,2),v=g[0],y=g[1];return {nextPinTime:e,nextPinValue:l,project:n,previousPinTime:f,defaultValue:a,previousPinValue:p,relativeTime:d,frame:u,pinId:o,numberOfFrames:s,framesPerSecond:c,maxValue:y,minValue:v,linearInterpolation:Pt,easeInCubic:xt,easeOutCubic:Dt,easeInOutCubic:jt,easeOutElastic:Et,easyLinear:function(){return d*(l-p)+p},bezier:function(){var r=n.orgData.signalIdByPinId[t.pinId],o=n.signalData[r];if(o&&"bezier"in o){var u=i(o.bezierControlPoints[t.pinId],2);u[0];var c=u[1];c+=l;var h=o.pinIds.indexOf(t.pinId)-1;h=h<0?0:h;var g=o.pinIds[h],v=i(o.bezierControlPoints[g],4);v[0],v[1];v[2];var m=v[3];return function(t,e,n,r,i){var a=t.y;var o=e.y;var u=n.y;var s=r.y;return function(t){return Math.pow(1-t,3)*a+3*Math.pow(1-t,2)*t*o+3*(1-t)*Math.pow(t,2)*u+Math.pow(t,3)*s}(i)}({y:p},{y:m+=p},{y:c},{y:l},d)}return a},easyStep:function(){return l},easyEaseIn:function(){return p+xt(d)*(l-p)},easyEaseOut:function(){return p+Dt(d)*(l-p)},easyEase:function(){return p+jt(d)*(l-p)},easyEaseOutElastic:function(){return p+Et(d)*(l-p)},easyInOut:function(){return 1},noise:It,easyThreshold:function(){return l>(y-v)/2?y:v},easyRepeat:function(){return d},easyParabola:function(){return St(t)},interpolateSignalValueAtTime:h,signal:function(t){return h(t,u)},cloneSignal:function(t){var e=n.orgData.signalIds.find((function(e){return n.orgData.signalNames[e]===t}));if(!e)throw new Error("Signal ".concat(t," not found"));var r=n.signalData[e];if(!r)throw new Error("Signal ".concat(t," not found"));var i=r.pinIds;if(i.length<2)return a;var o=r.pinTimes[i[0]],u=r.pinTimes[i[i.length-1]];return h(t,o+(u-o)*d)},fitSignal:function(t,e,r){var i=n.orgData.signalIds.find((function(e){return n.orgData.signalNames[e]===t}));if(!i)throw new Error("Signal ".concat(t," not found"));var a=null!=e?e:v,o=null!=r?r:y,s=n.signalData[i].range;return a+(h(t,u)-s[0])/(s[1]-s[0])*(o-a)},flip:function(t){return y-t+v},useAsset:Ot,saveAsset:Nt}}var zt={};var Ut={},At=1e-6,Vt=function(t,e,n,r){var o=t.signalData[e],u=i(o.range,2),s=u[0],c=u[1],l=o.defaultValue,f=Object.entries(o.pinTimes).sort((function(t,e){return t[1]-e[1]})),p=f.find((function(t){var e=i(t,2);return e[0],e[1]>=n}));if(void 0===p)return [l,[]];var d,h=i(p,2),g=h[0],v=h[1],y=o.pinValues[g],m=o.curves[g],_=s,w=0,b=f.findIndex((function(t){var e=i(t,2),n=e[0];return e[1],n===g}));if(b>0){var S=i(f[b-1],2),I=S[0],P=S[1];_=o.pinValues[I],w=P;}else if(n<v)return [l,[]];var x=Ut[e+g];if(void 0===x||x.functionString!==m){var D="\n            let nextPinTime = context.nextPinTime;\n            let nextPinValue = context.nextPinValue;\n            let previousPinTime = context.previousPinTime;\n            let previousPinValue = context.previousPinValue;\n            let relativeTime = context.relativeTime;\n            let frame = context.frame;\n            let numberOfFrames = context.numberOfFrames;\n            let framesPerSecond = context.framesPerSecond;\n\n            let interpolateSignalValue = context.interpolateSignalValue;\n            let signal = context.signal;\n\n            let bezier = context.bezier;\n\n            let easyLinear = context.easyLinear;\n            let easyEaseIn = context.easyEaseIn;\n            let easyEaseOut = context.easyEaseOut;\n            let easyStep = context.easyStep;\n            let easyEase = context.easyEase;\n            let easyEaseOutElastic = context.easyEaseOutElastic;\n            let easyRepeat = context.easyRepeat;\n            let easyThreshold = context.easyThreshold;\n            let easyParabola = context.easyParabola;\n            let easyInOut = context.easyInOut;\n            let noise = context.noise;\n            let fitSignal = context.fitSignal;\n            let flip = context.flip;\n            let cloneSignal = context.cloneSignal;\n\n\n            ".concat(m);d=new Function("context","templates",D),Ut[e+g]={functionString:m,cachedFunction:d};}else d=x.cachedFunction;var j=(n-w)/(v!==w?v-w:1),E=l,C=[];try{var N=Tt({nextPinTime:v,nextPinValue:y,previousPinTime:w,project:t,previousPinValue:_,defaultValue:l,relativeTime:j,pinId:g,frame:n,range:[s,c],numberOfFrames:t.timelineData.numberOfFrames,framesPerSecond:t.timelineData.framesPerSecond,interpolateSignalValueAtTime:function(e,n){var o=t.orgData.signalIds.find((function(n){return t.orgData.signalNames[n]===e}));if(void 0===o)throw new Error("Signal not found");var u=i(Rt(t,o,n,r),2),s=u[0],c=u[1];if("string"==typeof s)throw new Error("Interpolation function returned string");return C.push.apply(C,a([],i(c),!1)),s}}),O=function(t){var e={};return Object.entries(t.templateData).forEach((function(t){var n=i(t,2),r=n[0],a=n[1];if(void 0!==zt[r]){if(zt[r].functionString===a){var o=zt[r].cachedFunction;return void(e[r]=o)}}else o=new Function("return ".concat(a,";"))(),e[r]=o,zt[r]={functionString:a,cachedFunction:o};})),e}(t);E=d(N,O);}catch(t){C.push({signalId:e,frame:n,error:t.message});}if(isNaN(E)&&(E=l,C.push({signalId:e,frame:n,error:"Interpolated value is NaN"})),E<s&&(E=s,Math.abs(E-s)>At&&C.push({signalId:e,frame:n,error:"Interpolated value below minimum"})),E>c){var T=E;E=c,Math.abs(T-c)>At&&C.push({signalId:e,frame:n,error:"Interpolated value above maximum: "+T});}return [E,C]},Mt=function(t,e,n,r){var a=t.signalData[e],o=a.defaultValue,u=Object.entries(a.pinTimes).sort((function(t,e){return t[1]-e[1]})).find((function(t){var e=i(t,2);return e[0],e[1]>=n}));if(void 0===u)return o;var s=i(u,2),c=s[0];return s[1],a.pinValues[c]},Rt=function(t,e,n,r){if(void 0===r&&(r=0),++r>1e3)throw new Error("Exceeded maximum iteration count");var i=t.timelineData.numberOfFrames;if(n<0||n>i)throw new Error("Time out of range");var a=t.signalData[e].type;if("discrete"===a)return [Mt(t,e,n),[]];if("continuous"===a)return Vt(t,e,n,r);throw new Error("Invalid signal type")};function Lt(t,e){return [t[0]+e[0],t[1]+e[1]]}function qt(t,e){return [t[0]-e[0],t[1]-e[1]]}function Ht(t,e){return [t[0]*e[0],t[1]*e[1]]}function $t(t,e){var n=i([t[0][0],t[0][1],t[2][0],t[2][1]],4),r=n[0],a=n[1],o=n[2],u=n[3],s=i([e[0][0],e[0][1],e[2][0],e[2][1]],4),c=s[0],l=s[1],f=s[2],p=s[3];return !(r>f||o<c)&&!(a>p||u<l)}var Kt=function(){function t(t,e,n){ void 0===t&&(t=[0,0]),void 0===e&&(e=0),void 0===n&&(n=0),this._o=t,this._w=e,this._h=n;}return Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t;},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"h",{get:function(){return this._h},set:function(t){this._h=t;},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"o",{get:function(){return this._o},set:function(t){this._o=t;},enumerable:false,configurable:true}),t.prototype.pointInside=function(t){var e={x:t[0],y:t[1]},n=e.x,r=e.y,i={oX:this.o[0],oY:this.o[1]},a=i.oX,o=i.oY;return !(n<a||n>a+this.w)&&!(r<o||r>o+this.h)},t.prototype.clone=function(){return new t(a([],i(this.o),false),this.w,this.h)},t.prototype.getBoundingBox=function(){return [this.o,Lt(this.o,[this.w,0]),Lt(this.o,[this.w,this.h]),Lt(this.o,[0,this.h])]},t.prototype.getCenter=function(){return Lt(this.o,[this.w/2,this.h/2])},t}();(function(t){function r(){var e=t.call(this)||this;return e.layer=0,e.children=[],e._isPrimaryCamera=false,e._needsUpdate=false,e._needsUpdate_root=false,e._renderAlways=false,e.updateWhenCameraChanges=false,e.state=void 0,e.context={},e.windowDidMountPrimitiveIsRunning=false,e.childIndex=0,e.isCanvasRoot=false,e.props={},e.globalPositioning=false,e}return e(r,t),Object.defineProperty(r.prototype,"_cameraSnapshot",{get:function(){var t;if(!this._root)throw new Error("Root not connected");return null===(t=this._root)||void 0===t?void 0:t.cameraSnapshot},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"_canvas",{get:function(){var t;if(!this._root)throw new Error("Root not connected");return null===(t=this._root)||void 0===t?void 0:t.canvas},enumerable:false,configurable:true}),r.prototype.setAsPrimaryCamera=function(){var t;null===(t=this._root)||void 0===t||t.installCamera(this);},r.prototype.setState=function(t){var e,n;if(this.state===t)throw new Error("Cannot set state to previous state. ");this.windowDidMountPrimitiveIsRunning?this.state=t:(this._isPrimaryCamera&&(null===(e=this._root)||void 0===e||e.windows.forEach((function(t){t.updateWhenCameraChanges&&(t._needsUpdate=true);}))),null===(n=this._root)||void 0===n||n.scheduleStateUpdate(this,t));},r.prototype.setContext=function(t,e){var n,r;this.windowDidMountPrimitiveIsRunning?this.context[t]=e:(this._isPrimaryCamera&&(null===(n=this._root)||void 0===n||n.windows.forEach((function(t){t.updateWhenCameraChanges&&(t._needsUpdate=true);}))),this.context[t]=e,null===(r=this._root)||void 0===r||r.scheduleContextUpdate(this,t,e));},r.prototype.windowDidMountPrimitive=function(t){this.windowDidMountPrimitiveIsRunning=true,this.windowDidMount(t),this.windowDidMountPrimitiveIsRunning=false;},r.prototype.windowDidMount=function(t){},r.prototype.windowDidUpdate=function(t){},r.prototype.cameraDidUpdate=function(){},r.prototype.windowWillUnmount=function(){},r.prototype.getBoxPrimitive=function(){if(this._boxSnapshot)return this._boxSnapshot;var t=this.getBox();return this._boxSnapshot=t,t},r.prototype.getBox=function(){return new Kt([0,0],0,0)},Object.defineProperty(r.prototype,"o",{get:function(){return this.getBoxPrimitive().o},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"w",{get:function(){return this.getBoxPrimitive().w},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"h",{get:function(){return this.getBoxPrimitive().h},enumerable:false,configurable:true}),r.prototype.cameraPassUpdateSelf=function(){var t,e,r=this;this._isPrimaryCamera?null===(t=this._root)||void 0===t||t.windows.forEach((function(t){var e;null===(e=r._root)||void 0===e||e.taintLayer(t.layer);})):(this._needsUpdate&&(this._boxSnapshot=void 0,null===(e=this._root)||void 0===e||e.taintLayer(this.layer)),this.cameraPassUpdateChildren(),this._needsUpdate&&this.windowDidUpdate(n({},this.props)));},r.prototype.cameraPassUpdateChildren=function(){var t=this;this.childIndex=0;var e=this.getChildren(this.props).map((function(e){return e(t)})),n=this.children.filter((function(t){return !e.includes(t)})),r=e.filter((function(e){return !t.children.includes(e)}));this.children=e,n.forEach((function(t){return t.windowWillUnmount()})),r.forEach((function(t){return t.windowDidMountPrimitive(t.props)}));var i=this.children.find((function(t){return t._needsUpdate}));this.children.forEach((function(t){t._needsUpdate=true;})),i&&i.cameraPassUpdateSelf();},r.prototype.regularPassUpdateSelf=function(){var t;this._boxSnapshot=void 0,null===(t=this._root)||void 0===t||t.taintLayer(this.layer),this.regularPassUpdateChildren(),this.windowDidUpdate(n({},this.props));},r.prototype.regularPassUpdateChildren=function(){var t=this;this.childIndex=0;var e=this.getChildren(this.props).map((function(e){return e(t)})),n=this.children.filter((function(t){return !e.includes(t)})),r=e.filter((function(e){return !t.children.includes(e)}));this.children=e,n.forEach((function(t){return t.windowWillUnmount()})),r.forEach((function(t){t.windowDidMountPrimitive(t.props);})),this.children.forEach((function(t){t.regularPassUpdateSelf();}));},r.prototype.getChildren=function(t){return []},r.prototype.incChildIndex=function(){this.childIndex++;},r.Node=function(t){var e=this,r=this.name;return function(i){if(i.isCanvasRoot){var a=void 0;return (a=new e)._root=i,a.setKey("root"),a.props=t||{},a.context=n({},a.context),a}var o=i.childIndex;t||(t={});var u=t.key?t.key:"".concat(r,"[").concat(o,"]");a=void 0;return  -1!==i.children.findIndex((function(t){return t.key===u}))?a=i.children.find((function(t){return t.key===u})):((a=new e)._parent=i,a._root=i._root,a.setKey(u)),a.props=n({},t),a.context=n(n({},a.context),i.context),i.incChildIndex(),a}},Object.defineProperty(r.prototype,"parentO",{get:function(){return this._parent?this._parent.globalO:[0,0]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"parentW",{get:function(){return this._parent?this._parent.w:0},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"parentH",{get:function(){return this._parent?this._parent.h:0},enumerable:false,configurable:true}),r.prototype.getChildByKey=function(t){return this.children.find((function(e){return e.key===t}))},r.prototype.getBoundingBox=function(){var t=i(this.globalO,2),e=t[0],n=t[1];return [[e,n],[e+this.w,n],[e+this.w,n+this.h],[e,n+this.h]]},r.prototype.pointInside=function(e){return t.prototype.pointInside.call(this,qt(e,this.parentO))},Object.defineProperty(r.prototype,"globalO",{get:function(){if(!this._parent||this.globalPositioning)return this.o;var t=i(this._parent.globalO,2),e=t[0],n=t[1],r=i(this.o,2);return [e+r[0],n+r[1]]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"globalKey",{get:function(){return this._parent?this._parent.globalKey+"@"+this.key:"root"},enumerable:false,configurable:true}),r.prototype.getLayer=function(){return this.layer},r.prototype.setLayer=function(t){this.layer=t;},r.prototype.setKey=function(t){this.key=t;},Object.defineProperty(r.prototype,"displayConnected",{get:function(){return this._cameraSnapshot&&this._canvas},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvasUnit",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._cameraSnapshot.w/this._canvas.width,this._cameraSnapshot.h/this._canvas.height]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"absoluteUnit",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._canvas.width/this._cameraSnapshot.w,this._canvas.height/this._cameraSnapshot.h]},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvasO",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return [this._cameraSnapshot.o[0],this._cameraSnapshot.o[1]]},enumerable:false,configurable:true}),r.prototype.absoluteToCanvasMeasure=function(t){return Ht(t,[this._canvas.width/this._cameraSnapshot.w,this._canvas.height/this._cameraSnapshot.h])},r.prototype.canvasToAbsoluteMeasure=function(t){return Ht(t,[this._cameraSnapshot.w/this._canvas.width,this._cameraSnapshot.h/this._canvas.height])},Object.defineProperty(r.prototype,"cameraSnapshot",{get:function(){return this._cameraSnapshot},enumerable:false,configurable:true}),Object.defineProperty(r.prototype,"canvas",{get:function(){if(!this.displayConnected)throw new Error("Display not connected");return this._canvas},enumerable:false,configurable:true}),r.prototype.prepareHandlerProps=function(){var t=this.cameraSnapshot,e=this.canvas,n=this.absoluteToCanvasMeasure.bind(this),r=this.canvasToAbsoluteMeasure.bind(this),i=this.canvasUnit,a=this.absoluteUnit,o=this.canvasO;return {canvasDimensions:[e.width,e.height],absoluteToCanvasMeasure:n,canvasToAbsoluteMeasure:r,camera:t,canvasUnit:i,canvasO:o,absoluteUnit:a}},r.prototype.preparePostBoxHandlerProps=function(){var t=this,e=this._cameraSnapshot,r=this._canvas,a=function(n){var a=t.globalO,o=i(n,2),u=o[0],s=o[1],c=i(a,2),l=i([c[0]+u,c[1]+s],2),f=l[0],p=l[1],d=i(e.o,2),h=i([f-d[0],p-d[1]],2),g=h[0],v=h[1];return [g*(r.width/e.w),v*(r.height/e.h)]},o=a([0,0]);return n(n({},this.prepareHandlerProps()),{localToCanvas:a,canvasToLocal:function(n){var i=t.globalO;return qt(Lt(Ht(n,[e.w/r.width,e.h/r.height]),e.o),i)},absoluteO:o})},r.prototype.prepareMouseHandlerProps=function(t,e){var r=this.preparePostBoxHandlerProps(),a=i(this.canvasUnit,2),o=a[0],u=a[1],s=i(this.canvasO,2),c=s[0],l=s[1],f=i(t,2),p=[c+f[0]*o,l+f[1]*u],d=qt(p,this.globalO),h=this.pointInside(p);return n(n({},r),{relativePos:d,canvasPos:t,absolutePos:p,pointInside:h,terminateEvent:e})},r.prototype.prepareWheelHandlerProps=function(t){var e=this.preparePostBoxHandlerProps();return n(n({},e),{terminateEvent:t})},r.prototype.renderPrimitive=function(t){if(this.render){var e=this.preparePostBoxHandlerProps();this.render(n(n({},e),{ctx:t}));}},r.prototype.render=function(t){},r.prototype.onMouseDownPrimitive=function(t,e,n){this.onMouseDown&&this.onMouseDown(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseDown=function(t,e){},r.prototype.onMouseMovePrimitive=function(t,e,n){this.onMouseMove&&this.onMouseMove(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseMove=function(t,e){},r.prototype.onMouseUpPrimitive=function(t,e,n){this.onMouseUp&&this.onMouseUp(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onMouseUp=function(t,e){},r.prototype.onClickPrimitive=function(t,e,n){this.onClick&&this.onClick(this.prepareMouseHandlerProps(t,e),n);},r.prototype.onClick=function(t,e){},r.prototype.onWheelPrimitive=function(t,e){this.onWheel&&this.onWheel(this.prepareWheelHandlerProps(t),e);},r.prototype.onWheel=function(t,e){},r.prototype.strokeOutline=function(t,e){t.ctx.strokeStyle=e;var n=t.absoluteO,r=t.absoluteUnit,a=i(n,2),o=a[0],u=a[1],s=i(r,2),c=s[0],l=s[1];t.ctx.strokeRect(o,u,this.w*c,this.h*l);},r})(Kt);var Jt={};function Xt(t,e,n,o,u){var s=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),c=e.filter((function(t){return t._renderAlways||$t(t.getBoundingBox(),s)})),l=Array.from(new Set(c.map((function(t){return t.getLayer()})))).sort((function(t,e){return t-e}));o.clearRect(0,0,n.width,n.height);for(var f=function(t){var e,i,a=l[t],s=c.filter((function(e){return e.getLayer()===l[t]}));if(u.includes(a)){var f=a+"";if(void 0===Jt[f]){var p=document.createElement("canvas");Jt[f]=p;}var d=Jt[f];d.width=n.width,d.height=n.height;var h=d.getContext("2d");h.clearRect(0,0,d.width,d.height);try{for(var g=(e=void 0,r(s)),v=g.next();!v.done;v=g.next()){v.value.renderPrimitive(h);}}catch(t){e={error:t};}finally{try{v&&!v.done&&(i=g.return)&&i.call(g);}finally{if(e)throw e.error}}}var y=a+"";Jt[y]&&o.drawImage(Jt[y],0,0);},p=0;p<l.length;p++)f(p);}function Zt(t,e,n,o,u){var s,c,l=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),f=e.filter((function(t){return $t(t.getBoundingBox(),l)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(f),g=h.next();!g.done;g=h.next()){if(g.value.onClickPrimitive(o,d,u),!p)break}}catch(t){s={error:t};}finally{try{g&&!g.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function Yt(t,e,n,o,u){var s,c,l=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),f=e.filter((function(t){return $t(t.getBoundingBox(),l)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(f),g=h.next();!g.done;g=h.next()){if(g.value.onMouseDownPrimitive(o,d,u),!p)break}}catch(t){s={error:t};}finally{try{g&&!g.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function Qt(t,e,n,o,u){var s,c,l=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),f=e.filter((function(t){return $t(t.getBoundingBox(),l)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(f),g=h.next();!g.done;g=h.next()){if(g.value.onMouseMovePrimitive(o,d,u),!p)break}}catch(t){s={error:t};}finally{try{g&&!g.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function te(t,e,n,o,u){var s,c,l=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),f=e.filter((function(t){return $t(t.getBoundingBox(),l)})).reverse(),p=true,d=function(){p=false;};try{for(var h=r(f),g=h.next();!g.done;g=h.next()){if(g.value.onMouseUpPrimitive(o,d,u),!p)break}}catch(t){s={error:t};}finally{try{g&&!g.done&&(c=h.return)&&c.call(h);}finally{if(s)throw s.error}}}function ee(t,e,n,o){var u,s,c=(t=new Kt(a([],i(t.o),false),t.w,t.h)).getBoundingBox(),l=e.filter((function(t){return $t(t.getBoundingBox(),c)})).reverse(),f=true,p=function(){f=false;};try{for(var d=r(l),h=d.next();!h.done;h=d.next()){if(h.value.onWheelPrimitive(p,o),!f)break}}catch(t){u={error:t};}finally{try{h&&!h.done&&(s=d.return)&&s.call(d);}finally{if(u)throw u.error}}}var ne,re="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ie={exports:{}};var ae,oe,ue=(ne||(ne=1,ae=ie,oe=ie.exports,function(){var t,e="Expected a function",n="__lodash_hash_undefined__",r="__lodash_placeholder__",i=16,a=32,o=64,u=128,s=256,c=1/0,l=9007199254740991,f=NaN,p=4294967295,d=[["ary",u],["bind",1],["bindKey",2],["curry",8],["curryRight",i],["flip",512],["partial",a],["partialRight",o],["rearg",s]],h="[object Arguments]",g="[object Array]",v="[object Boolean]",y="[object Date]",m="[object Error]",_="[object Function]",w="[object GeneratorFunction]",b="[object Map]",S="[object Number]",I="[object Object]",P="[object Promise]",x="[object RegExp]",D="[object Set]",j="[object String]",E="[object Symbol]",C="[object WeakMap]",N="[object ArrayBuffer]",O="[object DataView]",T="[object Float32Array]",z="[object Float64Array]",k="[object Int8Array]",U="[object Int16Array]",A="[object Int32Array]",V="[object Uint8Array]",M="[object Uint8ClampedArray]",R="[object Uint16Array]",B="[object Uint32Array]",F=/\b__p \+= '';/g,W=/\b(__p \+=) '' \+/g,L=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,$=RegExp(q.source),K=RegExp(H.source),G=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,X=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/[\\^$.*+?()[\]{}|]/g,et=RegExp(tt.source),nt=/^\s+/,rt=/\s/,it=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,at=/\{\n\/\* \[wrapped with (.+)\] \*/,ot=/,? & /,ut=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,st=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,lt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ft=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,dt=/^0b[01]+$/i,ht=/^\[object .+?Constructor\]$/,gt=/^0o[0-7]+$/i,vt=/^(?:0|[1-9]\d*)$/,yt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,mt=/($^)/,_t=/['\n\r\u2028\u2029\\]/g,wt="\\ud800-\\udfff",bt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",St="\\u2700-\\u27bf",It="a-z\\xdf-\\xf6\\xf8-\\xff",Pt="A-Z\\xc0-\\xd6\\xd8-\\xde",xt="\\ufe0e\\ufe0f",Dt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",jt="[']",Et="["+wt+"]",Ct="["+Dt+"]",Nt="["+bt+"]",Ot="\\d+",Tt="["+St+"]",zt="["+It+"]",kt="[^"+wt+Dt+Ot+St+It+Pt+"]",Ut="\\ud83c[\\udffb-\\udfff]",At="[^"+wt+"]",Vt="(?:\\ud83c[\\udde6-\\uddff]){2}",Mt="[\\ud800-\\udbff][\\udc00-\\udfff]",Rt="["+Pt+"]",Bt="\\u200d",Ft="(?:"+zt+"|"+kt+")",Wt="(?:"+Rt+"|"+kt+")",Lt="(?:['](?:d|ll|m|re|s|t|ve))?",qt="(?:['](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+Nt+"|"+Ut+")?",$t="["+xt+"]?",Kt=$t+Ht+"(?:"+Bt+"(?:"+[At,Vt,Mt].join("|")+")"+$t+Ht+")*",Gt="(?:"+[Tt,Vt,Mt].join("|")+")"+Kt,Jt="(?:"+[At+Nt+"?",Nt,Vt,Mt,Et].join("|")+")",Xt=RegExp(jt,"g"),Zt=RegExp(Nt,"g"),Yt=RegExp(Ut+"(?="+Ut+")|"+Jt+Kt,"g"),Qt=RegExp([Rt+"?"+zt+"+"+Lt+"(?="+[Ct,Rt,"$"].join("|")+")",Wt+"+"+qt+"(?="+[Ct,Rt+Ft,"$"].join("|")+")",Rt+"?"+Ft+"+"+Lt,Rt+"+"+qt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ot,Gt].join("|"),"g"),te=RegExp("["+Bt+wt+bt+xt+"]"),ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ne=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ie=-1,ue={};ue[T]=ue[z]=ue[k]=ue[U]=ue[A]=ue[V]=ue[M]=ue[R]=ue[B]=true,ue[h]=ue[g]=ue[N]=ue[v]=ue[O]=ue[y]=ue[m]=ue[_]=ue[b]=ue[S]=ue[I]=ue[x]=ue[D]=ue[j]=ue[C]=false;var se={};se[h]=se[g]=se[N]=se[O]=se[v]=se[y]=se[T]=se[z]=se[k]=se[U]=se[A]=se[b]=se[S]=se[I]=se[x]=se[D]=se[j]=se[E]=se[V]=se[M]=se[R]=se[B]=true,se[m]=se[_]=se[C]=false;var ce={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},le=parseFloat,fe=parseInt,pe="object"==typeof re&&re&&re.Object===Object&&re,de="object"==typeof self&&self&&self.Object===Object&&self,he=pe||de||Function("return this")(),ge=oe&&!oe.nodeType&&oe,ve=ge&&ae&&!ae.nodeType&&ae,ye=ve&&ve.exports===ge,me=ye&&pe.process,_e=function(){try{var t=ve&&ve.require&&ve.require("util").types;return t||me&&me.binding&&me.binding("util")}catch(t){}}(),we=_e&&_e.isArrayBuffer,be=_e&&_e.isDate,Se=_e&&_e.isMap,Ie=_e&&_e.isRegExp,Pe=_e&&_e.isSet,xe=_e&&_e.isTypedArray;function De(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function je(t,e,n,r){for(var i=-1,a=null==t?0:t.length;++i<a;){var o=t[i];e(r,o,n(o),t);}return r}function Ee(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&false!==e(t[n],n,t););return t}function Ce(t,e){for(var n=null==t?0:t.length;n--&&false!==e(t[n],n,t););return t}function Ne(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return  false;return  true}function Oe(t,e){for(var n=-1,r=null==t?0:t.length,i=0,a=[];++n<r;){var o=t[n];e(o,n,t)&&(a[i++]=o);}return a}function Te(t,e){return !(null==t||!t.length)&&We(t,e,0)>-1}function ze(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return  true;return  false}function ke(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function Ue(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Ae(t,e,n,r){var i=-1,a=null==t?0:t.length;for(r&&a&&(n=t[++i]);++i<a;)n=e(n,t[i],i,t);return n}function Ve(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Me(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return  true;return  false}var Re=$e("length");function Be(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,false})),r}function Fe(t,e,n,r){for(var i=t.length,a=n+(r?1:-1);r?a--:++a<i;)if(e(t[a],a,t))return a;return  -1}function We(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return  -1}(t,e,n):Fe(t,qe,n)}function Le(t,e,n,r){for(var i=n-1,a=t.length;++i<a;)if(r(t[i],e))return i;return  -1}function qe(t){return t!=t}function He(t,e){var n=null==t?0:t.length;return n?Je(t,e)/n:f}function $e(e){return function(n){return null==n?t:n[e]}}function Ke(e){return function(n){return null==e?t:e[n]}}function Ge(t,e,n,r,i){return i(t,(function(t,i,a){n=r?(r=false,t):e(n,t,i,a);})),n}function Je(e,n){for(var r,i=-1,a=e.length;++i<a;){var o=n(e[i]);o!==t&&(r=r===t?o:r+o);}return r}function Xe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Ze(t){return t?t.slice(0,gn(t)+1).replace(nt,""):t}function Ye(t){return function(e){return t(e)}}function Qe(t,e){return ke(e,(function(e){return t[e]}))}function tn(t,e){return t.has(e)}function en(t,e){for(var n=-1,r=t.length;++n<r&&We(e,t[n],0)>-1;);return n}function nn(t,e){for(var n=t.length;n--&&We(e,t[n],0)>-1;);return n}var rn=Ke({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),an=Ke({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function on(t){return "\\"+ce[t]}function un(t){return te.test(t)}function sn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t];})),n}function cn(t,e){return function(n){return t(e(n))}}function ln(t,e){for(var n=-1,i=t.length,a=0,o=[];++n<i;){var u=t[n];u!==e&&u!==r||(t[n]=r,o[a++]=n);}return o}function fn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t;})),n}function pn(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t];})),n}function dn(t){return un(t)?function(t){for(var e=Yt.lastIndex=0;Yt.test(t);)++e;return e}(t):Re(t)}function hn(t){return un(t)?function(t){return t.match(Yt)||[]}(t):function(t){return t.split("")}(t)}function gn(t){for(var e=t.length;e--&&rt.test(t.charAt(e)););return e}var vn=Ke({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),yn=function rt(wt){var bt,St=(wt=null==wt?he:yn.defaults(he.Object(),wt,yn.pick(he,ne))).Array,It=wt.Date,Pt=wt.Error,xt=wt.Function,Dt=wt.Math,jt=wt.Object,Et=wt.RegExp,Ct=wt.String,Nt=wt.TypeError,Ot=St.prototype,Tt=xt.prototype,zt=jt.prototype,kt=wt["__core-js_shared__"],Ut=Tt.toString,At=zt.hasOwnProperty,Vt=0,Mt=(bt=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||""))?"Symbol(src)_1."+bt:"",Rt=zt.toString,Bt=Ut.call(jt),Ft=he._,Wt=Et("^"+Ut.call(At).replace(tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Lt=ye?wt.Buffer:t,qt=wt.Symbol,Ht=wt.Uint8Array,$t=Lt?Lt.allocUnsafe:t,Kt=cn(jt.getPrototypeOf,jt),Gt=jt.create,Jt=zt.propertyIsEnumerable,Yt=Ot.splice,te=qt?qt.isConcatSpreadable:t,re=qt?qt.iterator:t,ae=qt?qt.toStringTag:t,oe=function(){try{var t=pa(jt,"defineProperty");return t({},"",{}),t}catch(t){}}(),ce=wt.clearTimeout!==he.clearTimeout&&wt.clearTimeout,pe=It&&It.now!==he.Date.now&&It.now,de=wt.setTimeout!==he.setTimeout&&wt.setTimeout,ge=Dt.ceil,ve=Dt.floor,me=jt.getOwnPropertySymbols,_e=Lt?Lt.isBuffer:t,Re=wt.isFinite,Ke=Ot.join,mn=cn(jt.keys,jt),_n=Dt.max,wn=Dt.min,bn=It.now,Sn=wt.parseInt,In=Dt.random,Pn=Ot.reverse,xn=pa(wt,"DataView"),Dn=pa(wt,"Map"),jn=pa(wt,"Promise"),En=pa(wt,"Set"),Cn=pa(wt,"WeakMap"),Nn=pa(jt,"create"),On=Cn&&new Cn,Tn={},zn=Ma(xn),kn=Ma(Dn),Un=Ma(jn),An=Ma(En),Vn=Ma(Cn),Mn=qt?qt.prototype:t,Rn=Mn?Mn.valueOf:t,Bn=Mn?Mn.toString:t;function Fn(t){if(nu(t)&&!Ho(t)&&!(t instanceof Hn)){if(t instanceof qn)return t;if(At.call(t,"__wrapped__"))return Ra(t)}return new qn(t)}var Wn=function(){function e(){}return function(n){if(!eu(n))return {};if(Gt)return Gt(n);e.prototype=n;var r=new e;return e.prototype=t,r}}();function Ln(){}function qn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=t;}function Hn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=false,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[];}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Kn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Gn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1]);}}function Jn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Gn;++e<n;)this.add(t[e]);}function Xn(t){var e=this.__data__=new Kn(t);this.size=e.size;}function Zn(t,e){var n=Ho(t),r=!n&&qo(t),i=!n&&!r&&Jo(t),a=!n&&!r&&!i&&lu(t),o=n||r||i||a,u=o?Xe(t.length,Ct):[],s=u.length;for(var c in t)!e&&!At.call(t,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_a(c,s))||u.push(c);return u}function Yn(e){var n=e.length;return n?e[Jr(0,n-1)]:t}function Qn(t,e){return Ua(Ni(t),sr(e,0,t.length))}function tr(t){return Ua(Ni(t))}function er(e,n,r){(r!==t&&!Fo(e[n],r)||r===t&&!(n in e))&&or(e,n,r);}function nr(e,n,r){var i=e[n];At.call(e,n)&&Fo(i,r)&&(r!==t||n in e)||or(e,n,r);}function rr(t,e){for(var n=t.length;n--;)if(Fo(t[n][0],e))return n;return  -1}function ir(t,e,n,r){return dr(t,(function(t,i,a){e(r,t,n(t),a);})),r}function ar(t,e){return t&&Oi(e,Tu(e),t)}function or(t,e,n){"__proto__"==e&&oe?oe(t,e,{configurable:true,enumerable:true,value:n,writable:true}):t[e]=n;}function ur(e,n){for(var r=-1,i=n.length,a=St(i),o=null==e;++r<i;)a[r]=o?t:ju(e,n[r]);return a}function sr(e,n,r){return e==e&&(r!==t&&(e=e<=r?e:r),n!==t&&(e=e>=n?e:n)),e}function cr(e,n,r,i,a,o){var u,s=1&n,c=2&n,l=4&n;if(r&&(u=a?r(e,i,a,o):r(e)),u!==t)return u;if(!eu(e))return e;var f=Ho(e);if(f){if(u=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&At.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(e),!s)return Ni(e,u)}else {var p=ga(e),d=p==_||p==w;if(Jo(e))return Pi(e,s);if(p==I||p==h||d&&!a){if(u=c||d?{}:ya(e),!s)return c?function(t,e){return Oi(t,ha(t),e)}(e,function(t,e){return t&&Oi(e,zu(e),t)}(u,e)):function(t,e){return Oi(t,da(t),e)}(e,ar(u,e))}else {if(!se[p])return a?e:{};u=function(t,e,n){var r,i=t.constructor;switch(e){case N:return xi(t);case v:case y:return new i(+t);case O:return function(t,e){var n=e?xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case T:case z:case k:case U:case A:case V:case M:case R:case B:return Di(t,n);case b:return new i;case S:case j:return new i(t);case x:return function(t){var e=new t.constructor(t.source,ft.exec(t));return e.lastIndex=t.lastIndex,e}(t);case D:return new i;case E:return r=t,Rn?jt(Rn.call(r)):{}}}(e,p,s);}}o||(o=new Xn);var g=o.get(e);if(g)return g;o.set(e,u),uu(e)?e.forEach((function(t){u.add(cr(t,n,r,t,e,o));})):ru(e)&&e.forEach((function(t,i){u.set(i,cr(t,n,r,i,e,o));}));var m=f?t:(l?c?aa:ia:c?zu:Tu)(e);return Ee(m||e,(function(t,i){m&&(t=e[i=t]),nr(u,i,cr(t,n,r,i,e,o));})),u}function lr(e,n,r){var i=r.length;if(null==e)return !i;for(e=jt(e);i--;){var a=r[i],o=n[a],u=e[a];if(u===t&&!(a in e)||!o(u))return  false}return  true}function fr(n,r,i){if("function"!=typeof n)throw new Nt(e);return Oa((function(){n.apply(t,i);}),r)}function pr(t,e,n,r){var i=-1,a=Te,o=true,u=t.length,s=[],c=e.length;if(!u)return s;n&&(e=ke(e,Ye(n))),r?(a=ze,o=false):e.length>=200&&(a=tn,o=false,e=new Jn(e));t:for(;++i<u;){var l=t[i],f=null==n?l:n(l);if(l=r||0!==l?l:0,o&&f==f){for(var p=c;p--;)if(e[p]===f)continue t;s.push(l);}else a(e,f,r)||s.push(l);}return s}Fn.templateSettings={escape:G,evaluate:J,interpolate:X,variable:"",imports:{_:Fn}},Fn.prototype=Ln.prototype,Fn.prototype.constructor=Fn,qn.prototype=Wn(Ln.prototype),qn.prototype.constructor=qn,Hn.prototype=Wn(Ln.prototype),Hn.prototype.constructor=Hn,$n.prototype.clear=function(){this.__data__=Nn?Nn(null):{},this.size=0;},$n.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},$n.prototype.get=function(e){var r=this.__data__;if(Nn){var i=r[e];return i===n?t:i}return At.call(r,e)?r[e]:t},$n.prototype.has=function(e){var n=this.__data__;return Nn?n[e]!==t:At.call(n,e)},$n.prototype.set=function(e,r){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Nn&&r===t?n:r,this},Kn.prototype.clear=function(){this.__data__=[],this.size=0;},Kn.prototype.delete=function(t){var e=this.__data__,n=rr(e,t);return !(n<0||(n==e.length-1?e.pop():Yt.call(e,n,1),--this.size,0))},Kn.prototype.get=function(e){var n=this.__data__,r=rr(n,e);return r<0?t:n[r][1]},Kn.prototype.has=function(t){return rr(this.__data__,t)>-1},Kn.prototype.set=function(t,e){var n=this.__data__,r=rr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Gn.prototype.clear=function(){this.size=0,this.__data__={hash:new $n,map:new(Dn||Kn),string:new $n};},Gn.prototype.delete=function(t){var e=la(this,t).delete(t);return this.size-=e?1:0,e},Gn.prototype.get=function(t){return la(this,t).get(t)},Gn.prototype.has=function(t){return la(this,t).has(t)},Gn.prototype.set=function(t,e){var n=la(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Jn.prototype.add=Jn.prototype.push=function(t){return this.__data__.set(t,n),this},Jn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.clear=function(){this.__data__=new Kn,this.size=0;},Xn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Xn.prototype.get=function(t){return this.__data__.get(t)},Xn.prototype.has=function(t){return this.__data__.has(t)},Xn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Kn){var r=n.__data__;if(!Dn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Gn(r);}return n.set(t,e),this.size=n.size,this};var dr=ki(br),hr=ki(Sr,true);function gr(t,e){var n=true;return dr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function vr(e,n,r){for(var i=-1,a=e.length;++i<a;){var o=e[i],u=n(o);if(null!=u&&(s===t?u==u&&!cu(u):r(u,s)))var s=u,c=o;}return c}function yr(t,e){var n=[];return dr(t,(function(t,r,i){e(t,r,i)&&n.push(t);})),n}function mr(t,e,n,r,i){var a=-1,o=t.length;for(n||(n=ma),i||(i=[]);++a<o;){var u=t[a];e>0&&n(u)?e>1?mr(u,e-1,n,r,i):Ue(i,u):r||(i[i.length]=u);}return i}var _r=Ui(),wr=Ui(true);function br(t,e){return t&&_r(t,e,Tu)}function Sr(t,e){return t&&wr(t,e,Tu)}function Ir(t,e){return Oe(e,(function(e){return Yo(t[e])}))}function Pr(e,n){for(var r=0,i=(n=wi(n,e)).length;null!=e&&r<i;)e=e[Va(n[r++])];return r&&r==i?e:t}function xr(t,e,n){var r=e(t);return Ho(t)?r:Ue(r,n(t))}function Dr(e){return null==e?e===t?"[object Undefined]":"[object Null]":ae&&ae in jt(e)?function(e){var n=At.call(e,ae),r=e[ae];try{e[ae]=t;var i=!0;}catch(t){}var a=Rt.call(e);return i&&(n?e[ae]=r:delete e[ae]),a}(e):function(t){return Rt.call(t)}(e)}function jr(t,e){return t>e}function Er(t,e){return null!=t&&At.call(t,e)}function Cr(t,e){return null!=t&&e in jt(t)}function Nr(e,n,r){for(var i=r?ze:Te,a=e[0].length,o=e.length,u=o,s=St(o),c=1/0,l=[];u--;){var f=e[u];u&&n&&(f=ke(f,Ye(n))),c=wn(f.length,c),s[u]=!r&&(n||a>=120&&f.length>=120)?new Jn(u&&f):t;}f=e[0];var p=-1,d=s[0];t:for(;++p<a&&l.length<c;){var h=f[p],g=n?n(h):h;if(h=r||0!==h?h:0,!(d?tn(d,g):i(l,g,r))){for(u=o;--u;){var v=s[u];if(!(v?tn(v,g):i(e[u],g,r)))continue t}d&&d.push(g),l.push(h);}}return l}function Or(e,n,r){var i=null==(e=Ea(e,n=wi(n,e)))?e:e[Va(Xa(n))];return null==i?t:De(i,e,r)}function Tr(t){return nu(t)&&Dr(t)==h}function zr(e,n,r,i,a){return e===n||(null==e||null==n||!nu(e)&&!nu(n)?e!=e&&n!=n:function(e,n,r,i,a,o){var u=Ho(e),s=Ho(n),c=u?g:ga(e),l=s?g:ga(n),f=(c=c==h?I:c)==I,p=(l=l==h?I:l)==I,d=c==l;if(d&&Jo(e)){if(!Jo(n))return  false;u=true,f=false;}if(d&&!f)return o||(o=new Xn),u||lu(e)?na(e,n,r,i,a,o):function(t,e,n,r,i,a,o){switch(n){case O:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return  false;t=t.buffer,e=e.buffer;case N:return !(t.byteLength!=e.byteLength||!a(new Ht(t),new Ht(e)));case v:case y:case S:return Fo(+t,+e);case m:return t.name==e.name&&t.message==e.message;case x:case j:return t==e+"";case b:var u=sn;case D:var s=1&r;if(u||(u=fn),t.size!=e.size&&!s)return  false;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var l=na(u(t),u(e),r,i,a,o);return o.delete(t),l;case E:if(Rn)return Rn.call(t)==Rn.call(e)}return  false}(e,n,c,r,i,a,o);if(!(1&r)){var _=f&&At.call(e,"__wrapped__"),w=p&&At.call(n,"__wrapped__");if(_||w){var P=_?e.value():e,C=w?n.value():n;return o||(o=new Xn),a(P,C,r,i,o)}}return !!d&&(o||(o=new Xn),function(e,n,r,i,a,o){var u=1&r,s=ia(e),c=s.length,l=ia(n),f=l.length;if(c!=f&&!u)return  false;for(var p=c;p--;){var d=s[p];if(!(u?d in n:At.call(n,d)))return  false}var h=o.get(e),g=o.get(n);if(h&&g)return h==n&&g==e;var v=true;o.set(e,n),o.set(n,e);for(var y=u;++p<c;){var m=e[d=s[p]],_=n[d];if(i)var w=u?i(_,m,d,n,e,o):i(m,_,d,e,n,o);if(!(w===t?m===_||a(m,_,r,i,o):w)){v=false;break}y||(y="constructor"==d);}if(v&&!y){var b=e.constructor,S=n.constructor;b==S||!("constructor"in e)||!("constructor"in n)||"function"==typeof b&&b instanceof b&&"function"==typeof S&&S instanceof S||(v=false);}return o.delete(e),o.delete(n),v}(e,n,r,i,a,o))}(e,n,r,i,zr,a))}function kr(e,n,r,i){var a=r.length,o=a,u=!i;if(null==e)return !o;for(e=jt(e);a--;){var s=r[a];if(u&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return  false}for(;++a<o;){var c=(s=r[a])[0],l=e[c],f=s[1];if(u&&s[2]){if(l===t&&!(c in e))return  false}else {var p=new Xn;if(i)var d=i(l,f,c,e,n,p);if(!(d===t?zr(f,l,3,i,p):d))return  false}}return  true}function Ur(t){return !(!eu(t)||(e=t,Mt&&Mt in e))&&(Yo(t)?Wt:ht).test(Ma(t));var e;}function Ar(t){return "function"==typeof t?t:null==t?is:"object"==typeof t?Ho(t)?Wr(t[0],t[1]):Fr(t):ds(t)}function Vr(t){if(!Pa(t))return mn(t);var e=[];for(var n in jt(t))At.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Mr(t){if(!eu(t))return function(t){var e=[];if(null!=t)for(var n in jt(t))e.push(n);return e}(t);var e=Pa(t),n=[];for(var r in t)("constructor"!=r||!e&&At.call(t,r))&&n.push(r);return n}function Rr(t,e){return t<e}function Br(t,e){var n=-1,r=Ko(t)?St(t.length):[];return dr(t,(function(t,i,a){r[++n]=e(t,i,a);})),r}function Fr(t){var e=fa(t);return 1==e.length&&e[0][2]?Da(e[0][0],e[0][1]):function(n){return n===t||kr(n,t,e)}}function Wr(e,n){return ba(e)&&xa(n)?Da(Va(e),n):function(r){var i=ju(r,e);return i===t&&i===n?Eu(r,e):zr(n,i,3)}}function Lr(e,n,r,i,a){e!==n&&_r(n,(function(o,u){if(a||(a=new Xn),eu(o))!function(e,n,r,i,a,o,u){var s=Ca(e,r),c=Ca(n,r),l=u.get(c);if(l)er(e,r,l);else {var f=o?o(s,c,r+"",e,n,u):t,p=f===t;if(p){var d=Ho(c),h=!d&&Jo(c),g=!d&&!h&&lu(c);f=c,d||h||g?Ho(s)?f=s:Go(s)?f=Ni(s):h?(p=false,f=Pi(c,true)):g?(p=false,f=Di(c,true)):f=[]:au(c)||qo(c)?(f=s,qo(s)?f=mu(s):eu(s)&&!Yo(s)||(f=ya(c))):p=false;}p&&(u.set(c,f),a(f,c,i,o,u),u.delete(c)),er(e,r,f);}}(e,n,u,r,Lr,i,a);else {var s=i?i(Ca(e,u),o,u+"",e,n,a):t;s===t&&(s=o),er(e,u,s);}}),zu);}function qr(e,n){var r=e.length;if(r)return _a(n+=n<0?r:0,r)?e[n]:t}function Hr(t,e,n){e=e.length?ke(e,(function(t){return Ho(t)?function(e){return Pr(e,1===t.length?t[0]:t)}:t})):[is];var r=-1;e=ke(e,Ye(ca()));var i=Br(t,(function(t,n,i){var a=ke(e,(function(e){return e(t)}));return {criteria:a,index:++r,value:t}}));return function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(i,(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,a=e.criteria,o=i.length,u=n.length;++r<o;){var s=ji(i[r],a[r]);if(s)return r>=u?s:s*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function $r(t,e,n){for(var r=-1,i=e.length,a={};++r<i;){var o=e[r],u=Pr(t,o);n(u,o)&&ti(a,wi(o,t),u);}return a}function Kr(t,e,n,r){var i=r?Le:We,a=-1,o=e.length,u=t;for(t===e&&(e=Ni(e)),n&&(u=ke(t,Ye(n)));++a<o;)for(var s=0,c=e[a],l=n?n(c):c;(s=i(u,l,s,r))>-1;)u!==t&&Yt.call(u,s,1),Yt.call(t,s,1);return t}function Gr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==a){var a=i;_a(i)?Yt.call(t,i,1):pi(t,i);}}return t}function Jr(t,e){return t+ve(In()*(e-t+1))}function Xr(t,e){var n="";if(!t||e<1||e>l)return n;do{e%2&&(n+=t),(e=ve(e/2))&&(t+=t);}while(e);return n}function Zr(t,e){return Ta(ja(t,e,is),t+"")}function Yr(t){return Yn(Fu(t))}function Qr(t,e){var n=Fu(t);return Ua(n,sr(e,0,n.length))}function ti(e,n,r,i){if(!eu(e))return e;for(var a=-1,o=(n=wi(n,e)).length,u=o-1,s=e;null!=s&&++a<o;){var c=Va(n[a]),l=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(a!=u){var f=s[c];(l=i?i(f,c,s):t)===t&&(l=eu(f)?f:_a(n[a+1])?[]:{});}nr(s,c,l),s=s[c];}return e}var ei=On?function(t,e){return On.set(t,e),t}:is,ni=oe?function(t,e){return oe(t,"toString",{configurable:true,enumerable:false,value:es(e),writable:true})}:is;function ri(t){return Ua(Fu(t))}function ii(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var a=St(i);++r<i;)a[r]=t[r+e];return a}function ai(t,e){var n;return dr(t,(function(t,r,i){return !(n=e(t,r,i))})),!!n}function oi(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var a=r+i>>>1,o=t[a];null!==o&&!cu(o)&&(n?o<=e:o<e)?r=a+1:i=a;}return i}return ui(t,e,is,n)}function ui(e,n,r,i){var a=0,o=null==e?0:e.length;if(0===o)return 0;for(var u=(n=r(n))!=n,s=null===n,c=cu(n),l=n===t;a<o;){var f=ve((a+o)/2),p=r(e[f]),d=p!==t,h=null===p,g=p==p,v=cu(p);if(u)var y=i||g;else y=l?g&&(i||d):s?g&&d&&(i||!h):c?g&&d&&!h&&(i||!v):!h&&!v&&(i?p<=n:p<n);y?a=f+1:o=f;}return wn(o,4294967294)}function si(t,e){for(var n=-1,r=t.length,i=0,a=[];++n<r;){var o=t[n],u=e?e(o):o;if(!n||!Fo(u,s)){var s=u;a[i++]=0===o?0:o;}}return a}function ci(t){return "number"==typeof t?t:cu(t)?f:+t}function li(t){if("string"==typeof t)return t;if(Ho(t))return ke(t,li)+"";if(cu(t))return Bn?Bn.call(t):"";var e=t+"";return "0"==e&&1/t==-1/0?"-0":e}function fi(t,e,n){var r=-1,i=Te,a=t.length,o=true,u=[],s=u;if(n)o=false,i=ze;else if(a>=200){var c=e?null:Xi(t);if(c)return fn(c);o=false,i=tn,s=new Jn;}else s=e?[]:u;t:for(;++r<a;){var l=t[r],f=e?e(l):l;if(l=n||0!==l?l:0,o&&f==f){for(var p=s.length;p--;)if(s[p]===f)continue t;e&&s.push(f),u.push(l);}else i(s,f,n)||(s!==u&&s.push(f),u.push(l));}return u}function pi(t,e){return null==(t=Ea(t,e=wi(e,t)))||delete t[Va(Xa(e))]}function di(t,e,n,r){return ti(t,e,n(Pr(t,e)),r)}function hi(t,e,n,r){for(var i=t.length,a=r?i:-1;(r?a--:++a<i)&&e(t[a],a,t););return n?ii(t,r?0:a,r?a+1:i):ii(t,r?a+1:0,r?i:a)}function gi(t,e){var n=t;return n instanceof Hn&&(n=n.value()),Ae(e,(function(t,e){return e.func.apply(e.thisArg,Ue([t],e.args))}),n)}function vi(t,e,n){var r=t.length;if(r<2)return r?fi(t[0]):[];for(var i=-1,a=St(r);++i<r;)for(var o=t[i],u=-1;++u<r;)u!=i&&(a[i]=pr(a[i]||o,t[u],e,n));return fi(mr(a,1),e,n)}function yi(e,n,r){for(var i=-1,a=e.length,o=n.length,u={};++i<a;){var s=i<o?n[i]:t;r(u,e[i],s);}return u}function mi(t){return Go(t)?t:[]}function _i(t){return "function"==typeof t?t:is}function wi(t,e){return Ho(t)?t:ba(t,e)?[t]:Aa(_u(t))}var bi=Zr;function Si(e,n,r){var i=e.length;return r=r===t?i:r,!n&&r>=i?e:ii(e,n,r)}var Ii=ce||function(t){return he.clearTimeout(t)};function Pi(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function xi(t){var e=new t.constructor(t.byteLength);return new Ht(e).set(new Ht(t)),e}function Di(t,e){var n=e?xi(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ji(e,n){if(e!==n){var r=e!==t,i=null===e,a=e==e,o=cu(e),u=n!==t,s=null===n,c=n==n,l=cu(n);if(!s&&!l&&!o&&e>n||o&&u&&c&&!s&&!l||i&&u&&c||!r&&c||!a)return 1;if(!i&&!o&&!l&&e<n||l&&r&&a&&!i&&!o||s&&r&&a||!u&&a||!c)return  -1}return 0}function Ei(t,e,n,r){for(var i=-1,a=t.length,o=n.length,u=-1,s=e.length,c=_n(a-o,0),l=St(s+c),f=!r;++u<s;)l[u]=e[u];for(;++i<o;)(f||i<a)&&(l[n[i]]=t[i]);for(;c--;)l[u++]=t[i++];return l}function Ci(t,e,n,r){for(var i=-1,a=t.length,o=-1,u=n.length,s=-1,c=e.length,l=_n(a-u,0),f=St(l+c),p=!r;++i<l;)f[i]=t[i];for(var d=i;++s<c;)f[d+s]=e[s];for(;++o<u;)(p||i<a)&&(f[d+n[o]]=t[i++]);return f}function Ni(t,e){var n=-1,r=t.length;for(e||(e=St(r));++n<r;)e[n]=t[n];return e}function Oi(e,n,r,i){var a=!r;r||(r={});for(var o=-1,u=n.length;++o<u;){var s=n[o],c=i?i(r[s],e[s],s,r,e):t;c===t&&(c=e[s]),a?or(r,s,c):nr(r,s,c);}return r}function Ti(t,e){return function(n,r){var i=Ho(n)?je:ir,a=e?e():{};return i(n,t,ca(r,2),a)}}function zi(e){return Zr((function(n,r){var i=-1,a=r.length,o=a>1?r[a-1]:t,u=a>2?r[2]:t;for(o=e.length>3&&"function"==typeof o?(a--,o):t,u&&wa(r[0],r[1],u)&&(o=a<3?t:o,a=1),n=jt(n);++i<a;){var s=r[i];s&&e(n,s,i,o);}return n}))}function ki(t,e){return function(n,r){if(null==n)return n;if(!Ko(n))return t(n,r);for(var i=n.length,a=e?i:-1,o=jt(n);(e?a--:++a<i)&&false!==r(o[a],a,o););return n}}function Ui(t){return function(e,n,r){for(var i=-1,a=jt(e),o=r(e),u=o.length;u--;){var s=o[t?u:++i];if(false===n(a[s],s,a))break}return e}}function Ai(e){return function(n){var r=un(n=_u(n))?hn(n):t,i=r?r[0]:n.charAt(0),a=r?Si(r,1).join(""):n.slice(1);return i[e]()+a}}function Vi(t){return function(e){return Ae(Yu(qu(e).replace(Xt,"")),t,"")}}function Mi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Wn(t.prototype),r=t.apply(n,e);return eu(r)?r:n}}function Ri(e){return function(n,r,i){var a=jt(n);if(!Ko(n)){var o=ca(r,3);n=Tu(n),r=function(t){return o(a[t],t,a)};}var u=e(n,r,i);return u>-1?a[o?n[u]:u]:t}}function Bi(n){return ra((function(r){var i=r.length,a=i,o=qn.prototype.thru;for(n&&r.reverse();a--;){var u=r[a];if("function"!=typeof u)throw new Nt(e);if(o&&!s&&"wrapper"==ua(u))var s=new qn([],true);}for(a=s?a:i;++a<i;){var c=ua(u=r[a]),l="wrapper"==c?oa(u):t;s=l&&Sa(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?s[ua(l[0])].apply(s,l[3]):1==u.length&&Sa(u)?s[c]():s.thru(u);}return function(){var t=arguments,e=t[0];if(s&&1==t.length&&Ho(e))return s.plant(e).value();for(var n=0,a=i?r[n].apply(this,t):e;++n<i;)a=r[n].call(this,a);return a}}))}function Fi(e,n,r,i,a,o,s,c,l,f){var p=n&u,d=1&n,h=2&n,g=24&n,v=512&n,y=h?t:Mi(e);return function u(){for(var m=arguments.length,_=St(m),w=m;w--;)_[w]=arguments[w];if(g)var b=sa(u),S=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(_,b);if(i&&(_=Ei(_,i,a,g)),o&&(_=Ci(_,o,s,g)),m-=S,g&&m<f){var I=ln(_,b);return Gi(e,n,Fi,u.placeholder,r,_,I,c,l,f-m)}var P=d?r:this,x=h?P[e]:e;return m=_.length,c?_=function(e,n){for(var r=e.length,i=wn(n.length,r),a=Ni(e);i--;){var o=n[i];e[i]=_a(o,r)?a[o]:t;}return e}(_,c):v&&m>1&&_.reverse(),p&&l<m&&(_.length=l),this&&this!==he&&this instanceof u&&(x=y||Mi(x)),x.apply(P,_)}}function Wi(t,e){return function(n,r){return function(t,e,n,r){return br(t,(function(t,i,a){e(r,n(t),i,a);})),r}(n,t,e(r),{})}}function Li(e,n){return function(r,i){var a;if(r===t&&i===t)return n;if(r!==t&&(a=r),i!==t){if(a===t)return i;"string"==typeof r||"string"==typeof i?(r=li(r),i=li(i)):(r=ci(r),i=ci(i)),a=e(r,i);}return a}}function qi(t){return ra((function(e){return e=ke(e,Ye(ca())),Zr((function(n){var r=this;return t(e,(function(t){return De(t,r,n)}))}))}))}function Hi(e,n){var r=(n=n===t?" ":li(n)).length;if(r<2)return r?Xr(n,e):n;var i=Xr(n,ge(e/dn(n)));return un(n)?Si(hn(i),0,e).join(""):i.slice(0,e)}function $i(e){return function(n,r,i){return i&&"number"!=typeof i&&wa(n,r,i)&&(r=i=t),n=hu(n),r===t?(r=n,n=0):r=hu(r),function(t,e,n,r){for(var i=-1,a=_n(ge((e-t)/(n||1)),0),o=St(a);a--;)o[r?a:++i]=t,t+=n;return o}(n,r,i=i===t?n<r?1:-1:hu(i),e)}}function Ki(t){return function(e,n){return "string"==typeof e&&"string"==typeof n||(e=yu(e),n=yu(n)),t(e,n)}}function Gi(e,n,r,i,u,s,c,l,f,p){var d=8&n;n|=d?a:o,4&(n&=~(d?o:a))||(n&=-4);var h=[e,n,u,d?s:t,d?c:t,d?t:s,d?t:c,l,f,p],g=r.apply(t,h);return Sa(e)&&Na(g,h),g.placeholder=i,za(g,e,n)}function Ji(t){var e=Dt[t];return function(t,n){if(t=yu(t),(n=null==n?0:wn(gu(n),292))&&Re(t)){var r=(_u(t)+"e").split("e");return +((r=(_u(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Xi=En&&1/fn(new En([,-0]))[1]==c?function(t){return new En(t)}:cs;function Zi(t){return function(e){var n=ga(e);return n==b?sn(e):n==D?pn(e):function(t,e){return ke(e,(function(e){return [e,t[e]]}))}(e,t(e))}}function Yi(n,c,l,f,p,d,h,g){var v=2&c;if(!v&&"function"!=typeof n)throw new Nt(e);var y=f?f.length:0;if(y||(c&=-97,f=p=t),h=h===t?h:_n(gu(h),0),g=g===t?g:gu(g),y-=p?p.length:0,c&o){var m=f,_=p;f=p=t;}var w=v?t:oa(n),b=[n,c,l,f,p,m,_,d,h,g];if(w&&function(t,e){var n=t[1],i=e[1],a=n|i,o=a<131,c=i==u&&8==n||i==u&&n==s&&t[7].length<=e[8]||384==i&&e[7].length<=e[8]&&8==n;if(!o&&!c)return t;1&i&&(t[2]=e[2],a|=1&n?0:4);var l=e[3];if(l){var f=t[3];t[3]=f?Ei(f,l,e[4]):l,t[4]=f?ln(t[3],r):e[4];}(l=e[5])&&(f=t[5],t[5]=f?Ci(f,l,e[6]):l,t[6]=f?ln(t[5],r):e[6]),(l=e[7])&&(t[7]=l),i&u&&(t[8]=null==t[8]?e[8]:wn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=a;}(b,w),n=b[0],c=b[1],l=b[2],f=b[3],p=b[4],!(g=b[9]=b[9]===t?v?0:n.length:_n(b[9]-y,0))&&24&c&&(c&=-25),c&&1!=c)S=8==c||c==i?function(e,n,r){var i=Mi(e);return function a(){for(var o=arguments.length,u=St(o),s=o,c=sa(a);s--;)u[s]=arguments[s];var l=o<3&&u[0]!==c&&u[o-1]!==c?[]:ln(u,c);return (o-=l.length)<r?Gi(e,n,Fi,a.placeholder,t,u,l,t,t,r-o):De(this&&this!==he&&this instanceof a?i:e,this,u)}}(n,c,g):c!=a&&33!=c||p.length?Fi.apply(t,b):function(t,e,n,r){var i=1&e,a=Mi(t);return function e(){for(var o=-1,u=arguments.length,s=-1,c=r.length,l=St(c+u),f=this&&this!==he&&this instanceof e?a:t;++s<c;)l[s]=r[s];for(;u--;)l[s++]=arguments[++o];return De(f,i?n:this,l)}}(n,c,l,f);else var S=function(t,e,n){var r=1&e,i=Mi(t);return function e(){return (this&&this!==he&&this instanceof e?i:t).apply(r?n:this,arguments)}}(n,c,l);return za((w?ei:Na)(S,b),n,c)}function Qi(e,n,r,i){return e===t||Fo(e,zt[r])&&!At.call(i,r)?n:e}function ta(e,n,r,i,a,o){return eu(e)&&eu(n)&&(o.set(n,e),Lr(e,n,t,ta,o),o.delete(n)),e}function ea(e){return au(e)?t:e}function na(e,n,r,i,a,o){var u=1&r,s=e.length,c=n.length;if(s!=c&&!(u&&c>s))return  false;var l=o.get(e),f=o.get(n);if(l&&f)return l==n&&f==e;var p=-1,d=true,h=2&r?new Jn:t;for(o.set(e,n),o.set(n,e);++p<s;){var g=e[p],v=n[p];if(i)var y=u?i(v,g,p,n,e,o):i(g,v,p,e,n,o);if(y!==t){if(y)continue;d=false;break}if(h){if(!Me(n,(function(t,e){if(!tn(h,e)&&(g===t||a(g,t,r,i,o)))return h.push(e)}))){d=false;break}}else if(g!==v&&!a(g,v,r,i,o)){d=false;break}}return o.delete(e),o.delete(n),d}function ra(e){return Ta(ja(e,t,Ha),e+"")}function ia(t){return xr(t,Tu,da)}function aa(t){return xr(t,zu,ha)}var oa=On?function(t){return On.get(t)}:cs;function ua(t){for(var e=t.name+"",n=Tn[e],r=At.call(Tn,e)?n.length:0;r--;){var i=n[r],a=i.func;if(null==a||a==t)return i.name}return e}function sa(t){return (At.call(Fn,"placeholder")?Fn:t).placeholder}function ca(){var t=Fn.iteratee||as;return t=t===as?Ar:t,arguments.length?t(arguments[0],arguments[1]):t}function la(t,e){var n,r,i=t.__data__;return ("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function fa(t){for(var e=Tu(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,xa(i)];}return e}function pa(e,n){var r=function(e,n){return null==e?t:e[n]}(e,n);return Ur(r)?r:t}var da=me?function(t){return null==t?[]:(t=jt(t),Oe(me(t),(function(e){return Jt.call(t,e)})))}:vs,ha=me?function(t){for(var e=[];t;)Ue(e,da(t)),t=Kt(t);return e}:vs,ga=Dr;function va(t,e,n){for(var r=-1,i=(e=wi(e,t)).length,a=false;++r<i;){var o=Va(e[r]);if(!(a=null!=t&&n(t,o)))break;t=t[o];}return a||++r!=i?a:!!(i=null==t?0:t.length)&&tu(i)&&_a(o,i)&&(Ho(t)||qo(t))}function ya(t){return "function"!=typeof t.constructor||Pa(t)?{}:Wn(Kt(t))}function ma(t){return Ho(t)||qo(t)||!!(te&&t&&t[te])}function _a(t,e){var n=typeof t;return !!(e=null==e?l:e)&&("number"==n||"symbol"!=n&&vt.test(t))&&t>-1&&t%1==0&&t<e}function wa(t,e,n){if(!eu(n))return  false;var r=typeof e;return !!("number"==r?Ko(n)&&_a(e,n.length):"string"==r&&e in n)&&Fo(n[e],t)}function ba(t,e){if(Ho(t))return  false;var n=typeof t;return !("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!cu(t))||Y.test(t)||!Z.test(t)||null!=e&&t in jt(e)}function Sa(t){var e=ua(t),n=Fn[e];if("function"!=typeof n||!(e in Hn.prototype))return  false;if(t===n)return  true;var r=oa(n);return !!r&&t===r[0]}(xn&&ga(new xn(new ArrayBuffer(1)))!=O||Dn&&ga(new Dn)!=b||jn&&ga(jn.resolve())!=P||En&&ga(new En)!=D||Cn&&ga(new Cn)!=C)&&(ga=function(e){var n=Dr(e),r=n==I?e.constructor:t,i=r?Ma(r):"";if(i)switch(i){case zn:return O;case kn:return b;case Un:return P;case An:return D;case Vn:return C}return n});var Ia=kt?Yo:ys;function Pa(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||zt)}function xa(t){return t==t&&!eu(t)}function Da(e,n){return function(r){return null!=r&&r[e]===n&&(n!==t||e in jt(r))}}function ja(e,n,r){return n=_n(n===t?e.length-1:n,0),function(){for(var t=arguments,i=-1,a=_n(t.length-n,0),o=St(a);++i<a;)o[i]=t[n+i];i=-1;for(var u=St(n+1);++i<n;)u[i]=t[i];return u[n]=r(o),De(e,this,u)}}function Ea(t,e){return e.length<2?t:Pr(t,ii(e,0,-1))}function Ca(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Na=ka(ei),Oa=de||function(t,e){return he.setTimeout(t,e)},Ta=ka(ni);function za(t,e,n){var r=e+"";return Ta(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(it,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Ee(d,(function(n){var r="_."+n[0];e&n[1]&&!Te(t,r)&&t.push(r);})),t.sort()}(function(t){var e=t.match(at);return e?e[1].split(ot):[]}(r),n)))}function ka(e){var n=0,r=0;return function(){var i=bn(),a=16-(i-r);if(r=i,a>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(t,arguments)}}function Ua(e,n){var r=-1,i=e.length,a=i-1;for(n=n===t?i:n;++r<n;){var o=Jr(r,a),u=e[o];e[o]=e[r],e[r]=u;}return e.length=n,e}var Aa=function(t){var e=Uo(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,(function(t,n,r,i){e.push(r?i.replace(ct,"$1"):n||t);})),e}));function Va(t){if("string"==typeof t||cu(t))return t;var e=t+"";return "0"==e&&1/t==-1/0?"-0":e}function Ma(t){if(null!=t){try{return Ut.call(t)}catch(t){}try{return t+""}catch(t){}}return ""}function Ra(t){if(t instanceof Hn)return t.clone();var e=new qn(t.__wrapped__,t.__chain__);return e.__actions__=Ni(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Ba=Zr((function(t,e){return Go(t)?pr(t,mr(e,1,Go,true)):[]})),Fa=Zr((function(e,n){var r=Xa(n);return Go(r)&&(r=t),Go(e)?pr(e,mr(n,1,Go,true),ca(r,2)):[]})),Wa=Zr((function(e,n){var r=Xa(n);return Go(r)&&(r=t),Go(e)?pr(e,mr(n,1,Go,true),t,r):[]}));function La(t,e,n){var r=null==t?0:t.length;if(!r)return  -1;var i=null==n?0:gu(n);return i<0&&(i=_n(r+i,0)),Fe(t,ca(e,3),i)}function qa(e,n,r){var i=null==e?0:e.length;if(!i)return  -1;var a=i-1;return r!==t&&(a=gu(r),a=r<0?_n(i+a,0):wn(a,i-1)),Fe(e,ca(n,3),a,true)}function Ha(t){return null!=t&&t.length?mr(t,1):[]}function $a(e){return e&&e.length?e[0]:t}var Ka=Zr((function(t){var e=ke(t,mi);return e.length&&e[0]===t[0]?Nr(e):[]})),Ga=Zr((function(e){var n=Xa(e),r=ke(e,mi);return n===Xa(r)?n=t:r.pop(),r.length&&r[0]===e[0]?Nr(r,ca(n,2)):[]})),Ja=Zr((function(e){var n=Xa(e),r=ke(e,mi);return (n="function"==typeof n?n:t)&&r.pop(),r.length&&r[0]===e[0]?Nr(r,t,n):[]}));function Xa(e){var n=null==e?0:e.length;return n?e[n-1]:t}var Za=Zr(Ya);function Ya(t,e){return t&&t.length&&e&&e.length?Kr(t,e):t}var Qa=ra((function(t,e){var n=null==t?0:t.length,r=ur(t,e);return Gr(t,ke(e,(function(t){return _a(t,n)?+t:t})).sort(ji)),r}));function to(t){return null==t?t:Pn.call(t)}var eo=Zr((function(t){return fi(mr(t,1,Go,true))})),no=Zr((function(e){var n=Xa(e);return Go(n)&&(n=t),fi(mr(e,1,Go,true),ca(n,2))})),ro=Zr((function(e){var n=Xa(e);return n="function"==typeof n?n:t,fi(mr(e,1,Go,true),t,n)}));function io(t){if(!t||!t.length)return [];var e=0;return t=Oe(t,(function(t){if(Go(t))return e=_n(t.length,e),true})),Xe(e,(function(e){return ke(t,$e(e))}))}function ao(e,n){if(!e||!e.length)return [];var r=io(e);return null==n?r:ke(r,(function(e){return De(n,t,e)}))}var oo=Zr((function(t,e){return Go(t)?pr(t,e):[]})),uo=Zr((function(t){return vi(Oe(t,Go))})),so=Zr((function(e){var n=Xa(e);return Go(n)&&(n=t),vi(Oe(e,Go),ca(n,2))})),co=Zr((function(e){var n=Xa(e);return n="function"==typeof n?n:t,vi(Oe(e,Go),t,n)})),lo=Zr(io),fo=Zr((function(e){var n=e.length,r=n>1?e[n-1]:t;return r="function"==typeof r?(e.pop(),r):t,ao(e,r)}));function po(t){var e=Fn(t);return e.__chain__=true,e}function ho(t,e){return e(t)}var go=ra((function(e){var n=e.length,r=n?e[0]:0,i=this.__wrapped__,a=function(t){return ur(t,e)};return !(n>1||this.__actions__.length)&&i instanceof Hn&&_a(r)?((i=i.slice(r,+r+(n?1:0))).__actions__.push({func:ho,args:[a],thisArg:t}),new qn(i,this.__chain__).thru((function(e){return n&&!e.length&&e.push(t),e}))):this.thru(a)})),vo=Ti((function(t,e,n){At.call(t,n)?++t[n]:or(t,n,1);})),yo=Ri(La),mo=Ri(qa);function _o(t,e){return (Ho(t)?Ee:dr)(t,ca(e,3))}function wo(t,e){return (Ho(t)?Ce:hr)(t,ca(e,3))}var bo=Ti((function(t,e,n){At.call(t,n)?t[n].push(e):or(t,n,[e]);})),So=Zr((function(t,e,n){var r=-1,i="function"==typeof e,a=Ko(t)?St(t.length):[];return dr(t,(function(t){a[++r]=i?De(e,t,n):Or(t,e,n);})),a})),Io=Ti((function(t,e,n){or(t,n,e);}));function Po(t,e){return (Ho(t)?ke:Br)(t,ca(e,3))}var xo=Ti((function(t,e,n){t[n?0:1].push(e);}),(function(){return [[],[]]})),Do=Zr((function(t,e){if(null==t)return [];var n=e.length;return n>1&&wa(t,e[0],e[1])?e=[]:n>2&&wa(e[0],e[1],e[2])&&(e=[e[0]]),Hr(t,mr(e,1),[])})),jo=pe||function(){return he.Date.now()};function Eo(e,n,r){return n=r?t:n,n=e&&null==n?e.length:n,Yi(e,u,t,t,t,t,n)}function Co(n,r){var i;if("function"!=typeof r)throw new Nt(e);return n=gu(n),function(){return --n>0&&(i=r.apply(this,arguments)),n<=1&&(r=t),i}}var No=Zr((function(t,e,n){var r=1;if(n.length){var i=ln(n,sa(No));r|=a;}return Yi(t,r,e,n,i)})),Oo=Zr((function(t,e,n){var r=3;if(n.length){var i=ln(n,sa(Oo));r|=a;}return Yi(e,r,t,n,i)}));function To(n,r,i){var a,o,u,s,c,l,f=0,p=false,d=false,h=true;if("function"!=typeof n)throw new Nt(e);function g(e){var r=a,i=o;return a=o=t,f=e,s=n.apply(i,r)}function v(e){var n=e-l;return l===t||n>=r||n<0||d&&e-f>=u}function y(){var t=jo();if(v(t))return m(t);c=Oa(y,function(t){var e=r-(t-l);return d?wn(e,u-(t-f)):e}(t));}function m(e){return c=t,h&&a?g(e):(a=o=t,s)}function _(){var e=jo(),n=v(e);if(a=arguments,o=this,l=e,n){if(c===t)return function(t){return f=t,c=Oa(y,r),p?g(t):s}(l);if(d)return Ii(c),c=Oa(y,r),g(l)}return c===t&&(c=Oa(y,r)),s}return r=yu(r)||0,eu(i)&&(p=!!i.leading,u=(d="maxWait"in i)?_n(yu(i.maxWait)||0,r):u,h="trailing"in i?!!i.trailing:h),_.cancel=function(){c!==t&&Ii(c),f=0,a=l=o=c=t;},_.flush=function(){return c===t?s:m(jo())},_}var zo=Zr((function(t,e){return fr(t,1,e)})),ko=Zr((function(t,e,n){return fr(t,yu(e)||0,n)}));function Uo(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new Nt(e);var r=function(){var e=arguments,i=n?n.apply(this,e):e[0],a=r.cache;if(a.has(i))return a.get(i);var o=t.apply(this,e);return r.cache=a.set(i,o)||a,o};return r.cache=new(Uo.Cache||Gn),r}function Ao(t){if("function"!=typeof t)throw new Nt(e);return function(){var e=arguments;switch(e.length){case 0:return !t.call(this);case 1:return !t.call(this,e[0]);case 2:return !t.call(this,e[0],e[1]);case 3:return !t.call(this,e[0],e[1],e[2])}return !t.apply(this,e)}}Uo.Cache=Gn;var Vo=bi((function(t,e){var n=(e=1==e.length&&Ho(e[0])?ke(e[0],Ye(ca())):ke(mr(e,1),Ye(ca()))).length;return Zr((function(r){for(var i=-1,a=wn(r.length,n);++i<a;)r[i]=e[i].call(this,r[i]);return De(t,this,r)}))})),Mo=Zr((function(e,n){var r=ln(n,sa(Mo));return Yi(e,a,t,n,r)})),Ro=Zr((function(e,n){var r=ln(n,sa(Ro));return Yi(e,o,t,n,r)})),Bo=ra((function(e,n){return Yi(e,s,t,t,t,n)}));function Fo(t,e){return t===e||t!=t&&e!=e}var Wo=Ki(jr),Lo=Ki((function(t,e){return t>=e})),qo=Tr(function(){return arguments}())?Tr:function(t){return nu(t)&&At.call(t,"callee")&&!Jt.call(t,"callee")},Ho=St.isArray,$o=we?Ye(we):function(t){return nu(t)&&Dr(t)==N};function Ko(t){return null!=t&&tu(t.length)&&!Yo(t)}function Go(t){return nu(t)&&Ko(t)}var Jo=_e||ys,Xo=be?Ye(be):function(t){return nu(t)&&Dr(t)==y};function Zo(t){if(!nu(t))return  false;var e=Dr(t);return e==m||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!au(t)}function Yo(t){if(!eu(t))return  false;var e=Dr(t);return e==_||e==w||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Qo(t){return "number"==typeof t&&t==gu(t)}function tu(t){return "number"==typeof t&&t>-1&&t%1==0&&t<=l}function eu(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function nu(t){return null!=t&&"object"==typeof t}var ru=Se?Ye(Se):function(t){return nu(t)&&ga(t)==b};function iu(t){return "number"==typeof t||nu(t)&&Dr(t)==S}function au(t){if(!nu(t)||Dr(t)!=I)return  false;var e=Kt(t);if(null===e)return  true;var n=At.call(e,"constructor")&&e.constructor;return "function"==typeof n&&n instanceof n&&Ut.call(n)==Bt}var ou=Ie?Ye(Ie):function(t){return nu(t)&&Dr(t)==x},uu=Pe?Ye(Pe):function(t){return nu(t)&&ga(t)==D};function su(t){return "string"==typeof t||!Ho(t)&&nu(t)&&Dr(t)==j}function cu(t){return "symbol"==typeof t||nu(t)&&Dr(t)==E}var lu=xe?Ye(xe):function(t){return nu(t)&&tu(t.length)&&!!ue[Dr(t)]},fu=Ki(Rr),pu=Ki((function(t,e){return t<=e}));function du(t){if(!t)return [];if(Ko(t))return su(t)?hn(t):Ni(t);if(re&&t[re])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[re]());var e=ga(t);return (e==b?sn:e==D?fn:Fu)(t)}function hu(t){return t?(t=yu(t))===c||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function gu(t){var e=hu(t),n=e%1;return e==e?n?e-n:e:0}function vu(t){return t?sr(gu(t),0,p):0}function yu(t){if("number"==typeof t)return t;if(cu(t))return f;if(eu(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=eu(e)?e+"":e;}if("string"!=typeof t)return 0===t?t:+t;t=Ze(t);var n=dt.test(t);return n||gt.test(t)?fe(t.slice(2),n?2:8):pt.test(t)?f:+t}function mu(t){return Oi(t,zu(t))}function _u(t){return null==t?"":li(t)}var wu=zi((function(t,e){if(Pa(e)||Ko(e))Oi(e,Tu(e),t);else for(var n in e)At.call(e,n)&&nr(t,n,e[n]);})),bu=zi((function(t,e){Oi(e,zu(e),t);})),Su=zi((function(t,e,n,r){Oi(e,zu(e),t,r);})),Iu=zi((function(t,e,n,r){Oi(e,Tu(e),t,r);})),Pu=ra(ur),xu=Zr((function(e,n){e=jt(e);var r=-1,i=n.length,a=i>2?n[2]:t;for(a&&wa(n[0],n[1],a)&&(i=1);++r<i;)for(var o=n[r],u=zu(o),s=-1,c=u.length;++s<c;){var l=u[s],f=e[l];(f===t||Fo(f,zt[l])&&!At.call(e,l))&&(e[l]=o[l]);}return e})),Du=Zr((function(e){return e.push(t,ta),De(Uu,t,e)}));function ju(e,n,r){var i=null==e?t:Pr(e,n);return i===t?r:i}function Eu(t,e){return null!=t&&va(t,e,Cr)}var Cu=Wi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Rt.call(e)),t[e]=n;}),es(is)),Nu=Wi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Rt.call(e)),At.call(t,e)?t[e].push(n):t[e]=[n];}),ca),Ou=Zr(Or);function Tu(t){return Ko(t)?Zn(t):Vr(t)}function zu(t){return Ko(t)?Zn(t,true):Mr(t)}var ku=zi((function(t,e,n){Lr(t,e,n);})),Uu=zi((function(t,e,n,r){Lr(t,e,n,r);})),Au=ra((function(t,e){var n={};if(null==t)return n;var r=false;e=ke(e,(function(e){return e=wi(e,t),r||(r=e.length>1),e})),Oi(t,aa(t),n),r&&(n=cr(n,7,ea));for(var i=e.length;i--;)pi(n,e[i]);return n})),Vu=ra((function(t,e){return null==t?{}:function(t,e){return $r(t,e,(function(e,n){return Eu(t,n)}))}(t,e)}));function Mu(t,e){if(null==t)return {};var n=ke(aa(t),(function(t){return [t]}));return e=ca(e),$r(t,n,(function(t,n){return e(t,n[0])}))}var Ru=Zi(Tu),Bu=Zi(zu);function Fu(t){return null==t?[]:Qe(t,Tu(t))}var Wu=Vi((function(t,e,n){return e=e.toLowerCase(),t+(n?Lu(e):e)}));function Lu(t){return Zu(_u(t).toLowerCase())}function qu(t){return (t=_u(t))&&t.replace(yt,rn).replace(Zt,"")}var Hu=Vi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),$u=Vi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Ku=Ai("toLowerCase"),Gu=Vi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Ju=Vi((function(t,e,n){return t+(n?" ":"")+Zu(e)})),Xu=Vi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),Zu=Ai("toUpperCase");function Yu(e,n,r){return e=_u(e),(n=r?t:n)===t?function(t){return ee.test(t)}(e)?function(t){return t.match(Qt)||[]}(e):function(t){return t.match(ut)||[]}(e):e.match(n)||[]}var Qu=Zr((function(e,n){try{return De(e,t,n)}catch(t){return Zo(t)?t:new Pt(t)}})),ts=ra((function(t,e){return Ee(e,(function(e){e=Va(e),or(t,e,No(t[e],t));})),t}));function es(t){return function(){return t}}var ns=Bi(),rs=Bi(true);function is(t){return t}function as(t){return Ar("function"==typeof t?t:cr(t,1))}var os=Zr((function(t,e){return function(n){return Or(n,t,e)}})),us=Zr((function(t,e){return function(n){return Or(t,n,e)}}));function ss(t,e,n){var r=Tu(e),i=Ir(e,r);null!=n||eu(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Ir(e,Tu(e)));var a=!(eu(n)&&"chain"in n&&!n.chain),o=Yo(t);return Ee(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(a||e){var n=t(this.__wrapped__);return (n.__actions__=Ni(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Ue([this.value()],arguments))});})),t}function cs(){}var ls=qi(ke),fs=qi(Ne),ps=qi(Me);function ds(t){return ba(t)?$e(Va(t)):function(t){return function(e){return Pr(e,t)}}(t)}var hs=$i(),gs=$i(true);function vs(){return []}function ys(){return  false}var ms,_s=Li((function(t,e){return t+e}),0),ws=Ji("ceil"),bs=Li((function(t,e){return t/e}),1),Ss=Ji("floor"),Is=Li((function(t,e){return t*e}),1),Ps=Ji("round"),xs=Li((function(t,e){return t-e}),0);return Fn.after=function(t,n){if("function"!=typeof n)throw new Nt(e);return t=gu(t),function(){if(--t<1)return n.apply(this,arguments)}},Fn.ary=Eo,Fn.assign=wu,Fn.assignIn=bu,Fn.assignInWith=Su,Fn.assignWith=Iu,Fn.at=Pu,Fn.before=Co,Fn.bind=No,Fn.bindAll=ts,Fn.bindKey=Oo,Fn.castArray=function(){if(!arguments.length)return [];var t=arguments[0];return Ho(t)?t:[t]},Fn.chain=po,Fn.chunk=function(e,n,r){n=(r?wa(e,n,r):n===t)?1:_n(gu(n),0);var i=null==e?0:e.length;if(!i||n<1)return [];for(var a=0,o=0,u=St(ge(i/n));a<i;)u[o++]=ii(e,a,a+=n);return u},Fn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var a=t[e];a&&(i[r++]=a);}return i},Fn.concat=function(){var t=arguments.length;if(!t)return [];for(var e=St(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return Ue(Ho(n)?Ni(n):[n],mr(e,1))},Fn.cond=function(t){var n=null==t?0:t.length,r=ca();return t=n?ke(t,(function(t){if("function"!=typeof t[1])throw new Nt(e);return [r(t[0]),t[1]]})):[],Zr((function(e){for(var r=-1;++r<n;){var i=t[r];if(De(i[0],this,e))return De(i[1],this,e)}}))},Fn.conforms=function(t){return function(t){var e=Tu(t);return function(n){return lr(n,t,e)}}(cr(t,1))},Fn.constant=es,Fn.countBy=vo,Fn.create=function(t,e){var n=Wn(t);return null==e?n:ar(n,e)},Fn.curry=function e(n,r,i){var a=Yi(n,8,t,t,t,t,t,r=i?t:r);return a.placeholder=e.placeholder,a},Fn.curryRight=function e(n,r,a){var o=Yi(n,i,t,t,t,t,t,r=a?t:r);return o.placeholder=e.placeholder,o},Fn.debounce=To,Fn.defaults=xu,Fn.defaultsDeep=Du,Fn.defer=zo,Fn.delay=ko,Fn.difference=Ba,Fn.differenceBy=Fa,Fn.differenceWith=Wa,Fn.drop=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,(n=r||n===t?1:gu(n))<0?0:n,i):[]},Fn.dropRight=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,0,(n=i-(n=r||n===t?1:gu(n)))<0?0:n):[]},Fn.dropRightWhile=function(t,e){return t&&t.length?hi(t,ca(e,3),true,true):[]},Fn.dropWhile=function(t,e){return t&&t.length?hi(t,ca(e,3),true):[]},Fn.fill=function(e,n,r,i){var a=null==e?0:e.length;return a?(r&&"number"!=typeof r&&wa(e,n,r)&&(r=0,i=a),function(e,n,r,i){var a=e.length;for((r=gu(r))<0&&(r=-r>a?0:a+r),(i=i===t||i>a?a:gu(i))<0&&(i+=a),i=r>i?0:vu(i);r<i;)e[r++]=n;return e}(e,n,r,i)):[]},Fn.filter=function(t,e){return (Ho(t)?Oe:yr)(t,ca(e,3))},Fn.flatMap=function(t,e){return mr(Po(t,e),1)},Fn.flatMapDeep=function(t,e){return mr(Po(t,e),c)},Fn.flatMapDepth=function(e,n,r){return r=r===t?1:gu(r),mr(Po(e,n),r)},Fn.flatten=Ha,Fn.flattenDeep=function(t){return null!=t&&t.length?mr(t,c):[]},Fn.flattenDepth=function(e,n){return null!=e&&e.length?mr(e,n=n===t?1:gu(n)):[]},Fn.flip=function(t){return Yi(t,512)},Fn.flow=ns,Fn.flowRight=rs,Fn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1];}return r},Fn.functions=function(t){return null==t?[]:Ir(t,Tu(t))},Fn.functionsIn=function(t){return null==t?[]:Ir(t,zu(t))},Fn.groupBy=bo,Fn.initial=function(t){return null!=t&&t.length?ii(t,0,-1):[]},Fn.intersection=Ka,Fn.intersectionBy=Ga,Fn.intersectionWith=Ja,Fn.invert=Cu,Fn.invertBy=Nu,Fn.invokeMap=So,Fn.iteratee=as,Fn.keyBy=Io,Fn.keys=Tu,Fn.keysIn=zu,Fn.map=Po,Fn.mapKeys=function(t,e){var n={};return e=ca(e,3),br(t,(function(t,r,i){or(n,e(t,r,i),t);})),n},Fn.mapValues=function(t,e){var n={};return e=ca(e,3),br(t,(function(t,r,i){or(n,r,e(t,r,i));})),n},Fn.matches=function(t){return Fr(cr(t,1))},Fn.matchesProperty=function(t,e){return Wr(t,cr(e,1))},Fn.memoize=Uo,Fn.merge=ku,Fn.mergeWith=Uu,Fn.method=os,Fn.methodOf=us,Fn.mixin=ss,Fn.negate=Ao,Fn.nthArg=function(t){return t=gu(t),Zr((function(e){return qr(e,t)}))},Fn.omit=Au,Fn.omitBy=function(t,e){return Mu(t,Ao(ca(e)))},Fn.once=function(t){return Co(2,t)},Fn.orderBy=function(e,n,r,i){return null==e?[]:(Ho(n)||(n=null==n?[]:[n]),Ho(r=i?t:r)||(r=null==r?[]:[r]),Hr(e,n,r))},Fn.over=ls,Fn.overArgs=Vo,Fn.overEvery=fs,Fn.overSome=ps,Fn.partial=Mo,Fn.partialRight=Ro,Fn.partition=xo,Fn.pick=Vu,Fn.pickBy=Mu,Fn.property=ds,Fn.propertyOf=function(e){return function(n){return null==e?t:Pr(e,n)}},Fn.pull=Za,Fn.pullAll=Ya,Fn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?Kr(t,e,ca(n,2)):t},Fn.pullAllWith=function(e,n,r){return e&&e.length&&n&&n.length?Kr(e,n,t,r):e},Fn.pullAt=Qa,Fn.range=hs,Fn.rangeRight=gs,Fn.rearg=Bo,Fn.reject=function(t,e){return (Ho(t)?Oe:yr)(t,Ao(ca(e,3)))},Fn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],a=t.length;for(e=ca(e,3);++r<a;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r));}return Gr(t,i),n},Fn.rest=function(n,r){if("function"!=typeof n)throw new Nt(e);return Zr(n,r=r===t?r:gu(r))},Fn.reverse=to,Fn.sampleSize=function(e,n,r){return n=(r?wa(e,n,r):n===t)?1:gu(n),(Ho(e)?Qn:Qr)(e,n)},Fn.set=function(t,e,n){return null==t?t:ti(t,e,n)},Fn.setWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:ti(e,n,r,i)},Fn.shuffle=function(t){return (Ho(t)?tr:ri)(t)},Fn.slice=function(e,n,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&wa(e,n,r)?(n=0,r=i):(n=null==n?0:gu(n),r=r===t?i:gu(r)),ii(e,n,r)):[]},Fn.sortBy=Do,Fn.sortedUniq=function(t){return t&&t.length?si(t):[]},Fn.sortedUniqBy=function(t,e){return t&&t.length?si(t,ca(e,2)):[]},Fn.split=function(e,n,r){return r&&"number"!=typeof r&&wa(e,n,r)&&(n=r=t),(r=r===t?p:r>>>0)?(e=_u(e))&&("string"==typeof n||null!=n&&!ou(n))&&!(n=li(n))&&un(e)?Si(hn(e),0,r):e.split(n,r):[]},Fn.spread=function(t,n){if("function"!=typeof t)throw new Nt(e);return n=null==n?0:_n(gu(n),0),Zr((function(e){var r=e[n],i=Si(e,0,n);return r&&Ue(i,r),De(t,this,i)}))},Fn.tail=function(t){var e=null==t?0:t.length;return e?ii(t,1,e):[]},Fn.take=function(e,n,r){return e&&e.length?ii(e,0,(n=r||n===t?1:gu(n))<0?0:n):[]},Fn.takeRight=function(e,n,r){var i=null==e?0:e.length;return i?ii(e,(n=i-(n=r||n===t?1:gu(n)))<0?0:n,i):[]},Fn.takeRightWhile=function(t,e){return t&&t.length?hi(t,ca(e,3),false,true):[]},Fn.takeWhile=function(t,e){return t&&t.length?hi(t,ca(e,3)):[]},Fn.tap=function(t,e){return e(t),t},Fn.throttle=function(t,n,r){var i=true,a=true;if("function"!=typeof t)throw new Nt(e);return eu(r)&&(i="leading"in r?!!r.leading:i,a="trailing"in r?!!r.trailing:a),To(t,n,{leading:i,maxWait:n,trailing:a})},Fn.thru=ho,Fn.toArray=du,Fn.toPairs=Ru,Fn.toPairsIn=Bu,Fn.toPath=function(t){return Ho(t)?ke(t,Va):cu(t)?[t]:Ni(Aa(_u(t)))},Fn.toPlainObject=mu,Fn.transform=function(t,e,n){var r=Ho(t),i=r||Jo(t)||lu(t);if(e=ca(e,4),null==n){var a=t&&t.constructor;n=i?r?new a:[]:eu(t)&&Yo(a)?Wn(Kt(t)):{};}return (i?Ee:br)(t,(function(t,r,i){return e(n,t,r,i)})),n},Fn.unary=function(t){return Eo(t,1)},Fn.union=eo,Fn.unionBy=no,Fn.unionWith=ro,Fn.uniq=function(t){return t&&t.length?fi(t):[]},Fn.uniqBy=function(t,e){return t&&t.length?fi(t,ca(e,2)):[]},Fn.uniqWith=function(e,n){return n="function"==typeof n?n:t,e&&e.length?fi(e,t,n):[]},Fn.unset=function(t,e){return null==t||pi(t,e)},Fn.unzip=io,Fn.unzipWith=ao,Fn.update=function(t,e,n){return null==t?t:di(t,e,_i(n))},Fn.updateWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:di(e,n,_i(r),i)},Fn.values=Fu,Fn.valuesIn=function(t){return null==t?[]:Qe(t,zu(t))},Fn.without=oo,Fn.words=Yu,Fn.wrap=function(t,e){return Mo(_i(e),t)},Fn.xor=uo,Fn.xorBy=so,Fn.xorWith=co,Fn.zip=lo,Fn.zipObject=function(t,e){return yi(t||[],e||[],nr)},Fn.zipObjectDeep=function(t,e){return yi(t||[],e||[],ti)},Fn.zipWith=fo,Fn.entries=Ru,Fn.entriesIn=Bu,Fn.extend=bu,Fn.extendWith=Su,ss(Fn,Fn),Fn.add=_s,Fn.attempt=Qu,Fn.camelCase=Wu,Fn.capitalize=Lu,Fn.ceil=ws,Fn.clamp=function(e,n,r){return r===t&&(r=n,n=t),r!==t&&(r=(r=yu(r))==r?r:0),n!==t&&(n=(n=yu(n))==n?n:0),sr(yu(e),n,r)},Fn.clone=function(t){return cr(t,4)},Fn.cloneDeep=function(t){return cr(t,5)},Fn.cloneDeepWith=function(e,n){return cr(e,5,n="function"==typeof n?n:t)},Fn.cloneWith=function(e,n){return cr(e,4,n="function"==typeof n?n:t)},Fn.conformsTo=function(t,e){return null==e||lr(t,e,Tu(e))},Fn.deburr=qu,Fn.defaultTo=function(t,e){return null==t||t!=t?e:t},Fn.divide=bs,Fn.endsWith=function(e,n,r){e=_u(e),n=li(n);var i=e.length,a=r=r===t?i:sr(gu(r),0,i);return (r-=n.length)>=0&&e.slice(r,a)==n},Fn.eq=Fo,Fn.escape=function(t){return (t=_u(t))&&K.test(t)?t.replace(H,an):t},Fn.escapeRegExp=function(t){return (t=_u(t))&&et.test(t)?t.replace(tt,"\\$&"):t},Fn.every=function(e,n,r){var i=Ho(e)?Ne:gr;return r&&wa(e,n,r)&&(n=t),i(e,ca(n,3))},Fn.find=yo,Fn.findIndex=La,Fn.findKey=function(t,e){return Be(t,ca(e,3),br)},Fn.findLast=mo,Fn.findLastIndex=qa,Fn.findLastKey=function(t,e){return Be(t,ca(e,3),Sr)},Fn.floor=Ss,Fn.forEach=_o,Fn.forEachRight=wo,Fn.forIn=function(t,e){return null==t?t:_r(t,ca(e,3),zu)},Fn.forInRight=function(t,e){return null==t?t:wr(t,ca(e,3),zu)},Fn.forOwn=function(t,e){return t&&br(t,ca(e,3))},Fn.forOwnRight=function(t,e){return t&&Sr(t,ca(e,3))},Fn.get=ju,Fn.gt=Wo,Fn.gte=Lo,Fn.has=function(t,e){return null!=t&&va(t,e,Er)},Fn.hasIn=Eu,Fn.head=$a,Fn.identity=is,Fn.includes=function(t,e,n,r){t=Ko(t)?t:Fu(t),n=n&&!r?gu(n):0;var i=t.length;return n<0&&(n=_n(i+n,0)),su(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&We(t,e,n)>-1},Fn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return  -1;var i=null==n?0:gu(n);return i<0&&(i=_n(r+i,0)),We(t,e,i)},Fn.inRange=function(e,n,r){return n=hu(n),r===t?(r=n,n=0):r=hu(r),function(t,e,n){return t>=wn(e,n)&&t<_n(e,n)}(e=yu(e),n,r)},Fn.invoke=Ou,Fn.isArguments=qo,Fn.isArray=Ho,Fn.isArrayBuffer=$o,Fn.isArrayLike=Ko,Fn.isArrayLikeObject=Go,Fn.isBoolean=function(t){return  true===t||false===t||nu(t)&&Dr(t)==v},Fn.isBuffer=Jo,Fn.isDate=Xo,Fn.isElement=function(t){return nu(t)&&1===t.nodeType&&!au(t)},Fn.isEmpty=function(t){if(null==t)return  true;if(Ko(t)&&(Ho(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||lu(t)||qo(t)))return !t.length;var e=ga(t);if(e==b||e==D)return !t.size;if(Pa(t))return !Vr(t).length;for(var n in t)if(At.call(t,n))return  false;return  true},Fn.isEqual=function(t,e){return zr(t,e)},Fn.isEqualWith=function(e,n,r){var i=(r="function"==typeof r?r:t)?r(e,n):t;return i===t?zr(e,n,t,r):!!i},Fn.isError=Zo,Fn.isFinite=function(t){return "number"==typeof t&&Re(t)},Fn.isFunction=Yo,Fn.isInteger=Qo,Fn.isLength=tu,Fn.isMap=ru,Fn.isMatch=function(t,e){return t===e||kr(t,e,fa(e))},Fn.isMatchWith=function(e,n,r){return r="function"==typeof r?r:t,kr(e,n,fa(n),r)},Fn.isNaN=function(t){return iu(t)&&t!=+t},Fn.isNative=function(t){if(Ia(t))throw new Pt("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ur(t)},Fn.isNil=function(t){return null==t},Fn.isNull=function(t){return null===t},Fn.isNumber=iu,Fn.isObject=eu,Fn.isObjectLike=nu,Fn.isPlainObject=au,Fn.isRegExp=ou,Fn.isSafeInteger=function(t){return Qo(t)&&t>=-9007199254740991&&t<=l},Fn.isSet=uu,Fn.isString=su,Fn.isSymbol=cu,Fn.isTypedArray=lu,Fn.isUndefined=function(e){return e===t},Fn.isWeakMap=function(t){return nu(t)&&ga(t)==C},Fn.isWeakSet=function(t){return nu(t)&&"[object WeakSet]"==Dr(t)},Fn.join=function(t,e){return null==t?"":Ke.call(t,e)},Fn.kebabCase=Hu,Fn.last=Xa,Fn.lastIndexOf=function(e,n,r){var i=null==e?0:e.length;if(!i)return  -1;var a=i;return r!==t&&(a=(a=gu(r))<0?_n(i+a,0):wn(a,i-1)),n==n?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(e,n,a):Fe(e,qe,a,true)},Fn.lowerCase=$u,Fn.lowerFirst=Ku,Fn.lt=fu,Fn.lte=pu,Fn.max=function(e){return e&&e.length?vr(e,is,jr):t},Fn.maxBy=function(e,n){return e&&e.length?vr(e,ca(n,2),jr):t},Fn.mean=function(t){return He(t,is)},Fn.meanBy=function(t,e){return He(t,ca(e,2))},Fn.min=function(e){return e&&e.length?vr(e,is,Rr):t},Fn.minBy=function(e,n){return e&&e.length?vr(e,ca(n,2),Rr):t},Fn.stubArray=vs,Fn.stubFalse=ys,Fn.stubObject=function(){return {}},Fn.stubString=function(){return ""},Fn.stubTrue=function(){return  true},Fn.multiply=Is,Fn.nth=function(e,n){return e&&e.length?qr(e,gu(n)):t},Fn.noConflict=function(){return he._===this&&(he._=Ft),this},Fn.noop=cs,Fn.now=jo,Fn.pad=function(t,e,n){t=_u(t);var r=(e=gu(e))?dn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Hi(ve(i),n)+t+Hi(ge(i),n)},Fn.padEnd=function(t,e,n){t=_u(t);var r=(e=gu(e))?dn(t):0;return e&&r<e?t+Hi(e-r,n):t},Fn.padStart=function(t,e,n){t=_u(t);var r=(e=gu(e))?dn(t):0;return e&&r<e?Hi(e-r,n)+t:t},Fn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),Sn(_u(t).replace(nt,""),e||0)},Fn.random=function(e,n,r){if(r&&"boolean"!=typeof r&&wa(e,n,r)&&(n=r=t),r===t&&("boolean"==typeof n?(r=n,n=t):"boolean"==typeof e&&(r=e,e=t)),e===t&&n===t?(e=0,n=1):(e=hu(e),n===t?(n=e,e=0):n=hu(n)),e>n){var i=e;e=n,n=i;}if(r||e%1||n%1){var a=In();return wn(e+a*(n-e+le("1e-"+((a+"").length-1))),n)}return Jr(e,n)},Fn.reduce=function(t,e,n){var r=Ho(t)?Ae:Ge,i=arguments.length<3;return r(t,ca(e,4),n,i,dr)},Fn.reduceRight=function(t,e,n){var r=Ho(t)?Ve:Ge,i=arguments.length<3;return r(t,ca(e,4),n,i,hr)},Fn.repeat=function(e,n,r){return n=(r?wa(e,n,r):n===t)?1:gu(n),Xr(_u(e),n)},Fn.replace=function(){var t=arguments,e=_u(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Fn.result=function(e,n,r){var i=-1,a=(n=wi(n,e)).length;for(a||(a=1,e=t);++i<a;){var o=null==e?t:e[Va(n[i])];o===t&&(i=a,o=r),e=Yo(o)?o.call(e):o;}return e},Fn.round=Ps,Fn.runInContext=rt,Fn.sample=function(t){return (Ho(t)?Yn:Yr)(t)},Fn.size=function(t){if(null==t)return 0;if(Ko(t))return su(t)?dn(t):t.length;var e=ga(t);return e==b||e==D?t.size:Vr(t).length},Fn.snakeCase=Gu,Fn.some=function(e,n,r){var i=Ho(e)?Me:ai;return r&&wa(e,n,r)&&(n=t),i(e,ca(n,3))},Fn.sortedIndex=function(t,e){return oi(t,e)},Fn.sortedIndexBy=function(t,e,n){return ui(t,e,ca(n,2))},Fn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=oi(t,e);if(r<n&&Fo(t[r],e))return r}return  -1},Fn.sortedLastIndex=function(t,e){return oi(t,e,true)},Fn.sortedLastIndexBy=function(t,e,n){return ui(t,e,ca(n,2),true)},Fn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=oi(t,e,true)-1;if(Fo(t[n],e))return n}return  -1},Fn.startCase=Ju,Fn.startsWith=function(t,e,n){return t=_u(t),n=null==n?0:sr(gu(n),0,t.length),e=li(e),t.slice(n,n+e.length)==e},Fn.subtract=xs,Fn.sum=function(t){return t&&t.length?Je(t,is):0},Fn.sumBy=function(t,e){return t&&t.length?Je(t,ca(e,2)):0},Fn.template=function(e,n,r){var i=Fn.templateSettings;r&&wa(e,n,r)&&(n=t),e=_u(e),n=Su({},n,i,Qi);var a,o,u=Su({},n.imports,i.imports,Qi),s=Tu(u),c=Qe(u,s),l=0,f=n.interpolate||mt,p="__p += '",d=Et((n.escape||mt).source+"|"+f.source+"|"+(f===X?lt:mt).source+"|"+(n.evaluate||mt).source+"|$","g"),h="//# sourceURL="+(At.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++ie+"]")+"\n";e.replace(d,(function(t,n,r,i,u,s){return r||(r=i),p+=e.slice(l,s).replace(_t,on),n&&(a=true,p+="' +\n__e("+n+") +\n'"),u&&(o=true,p+="';\n"+u+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=s+t.length,t})),p+="';\n";var g=At.call(n,"variable")&&n.variable;if(g){if(st.test(g))throw new Pt("Invalid `variable` option passed into `_.template`")}else p="with (obj) {\n"+p+"\n}\n";p=(o?p.replace(F,""):p).replace(W,"$1").replace(L,"$1;"),p="function("+(g||"obj")+") {\n"+(g?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(a?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var v=Qu((function(){return xt(s,h+"return "+p).apply(t,c)}));if(v.source=p,Zo(v))throw v;return v},Fn.times=function(t,e){if((t=gu(t))<1||t>l)return [];var n=p,r=wn(t,p);e=ca(e),t-=p;for(var i=Xe(r,e);++n<t;)e(n);return i},Fn.toFinite=hu,Fn.toInteger=gu,Fn.toLength=vu,Fn.toLower=function(t){return _u(t).toLowerCase()},Fn.toNumber=yu,Fn.toSafeInteger=function(t){return t?sr(gu(t),-9007199254740991,l):0===t?t:0},Fn.toString=_u,Fn.toUpper=function(t){return _u(t).toUpperCase()},Fn.trim=function(e,n,r){if((e=_u(e))&&(r||n===t))return Ze(e);if(!e||!(n=li(n)))return e;var i=hn(e),a=hn(n);return Si(i,en(i,a),nn(i,a)+1).join("")},Fn.trimEnd=function(e,n,r){if((e=_u(e))&&(r||n===t))return e.slice(0,gn(e)+1);if(!e||!(n=li(n)))return e;var i=hn(e);return Si(i,0,nn(i,hn(n))+1).join("")},Fn.trimStart=function(e,n,r){if((e=_u(e))&&(r||n===t))return e.replace(nt,"");if(!e||!(n=li(n)))return e;var i=hn(e);return Si(i,en(i,hn(n))).join("")},Fn.truncate=function(e,n){var r=30,i="...";if(eu(n)){var a="separator"in n?n.separator:a;r="length"in n?gu(n.length):r,i="omission"in n?li(n.omission):i;}var o=(e=_u(e)).length;if(un(e)){var u=hn(e);o=u.length;}if(r>=o)return e;var s=r-dn(i);if(s<1)return i;var c=u?Si(u,0,s).join(""):e.slice(0,s);if(a===t)return c+i;if(u&&(s+=c.length-s),ou(a)){if(e.slice(s).search(a)){var l,f=c;for(a.global||(a=Et(a.source,_u(ft.exec(a))+"g")),a.lastIndex=0;l=a.exec(f);)var p=l.index;c=c.slice(0,p===t?s:p);}}else if(e.indexOf(li(a),s)!=s){var d=c.lastIndexOf(a);d>-1&&(c=c.slice(0,d));}return c+i},Fn.unescape=function(t){return (t=_u(t))&&$.test(t)?t.replace(q,vn):t},Fn.uniqueId=function(t){var e=++Vt;return _u(t)+e},Fn.upperCase=Xu,Fn.upperFirst=Zu,Fn.each=_o,Fn.eachRight=wo,Fn.first=$a,ss(Fn,(ms={},br(Fn,(function(t,e){At.call(Fn.prototype,e)||(ms[e]=t);})),ms),{chain:false}),Fn.VERSION="4.17.21",Ee(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Fn[t].placeholder=Fn;})),Ee(["drop","take"],(function(e,n){Hn.prototype[e]=function(r){r=r===t?1:_n(gu(r),0);var i=this.__filtered__&&!n?new Hn(this):this.clone();return i.__filtered__?i.__takeCount__=wn(r,i.__takeCount__):i.__views__.push({size:wn(r,p),type:e+(i.__dir__<0?"Right":"")}),i},Hn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()};})),Ee(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Hn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:ca(t,3),type:n}),e.__filtered__=e.__filtered__||r,e};})),Ee(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Hn.prototype[t]=function(){return this[n](1).value()[0]};})),Ee(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Hn.prototype[t]=function(){return this.__filtered__?new Hn(this):this[n](1)};})),Hn.prototype.compact=function(){return this.filter(is)},Hn.prototype.find=function(t){return this.filter(t).head()},Hn.prototype.findLast=function(t){return this.reverse().find(t)},Hn.prototype.invokeMap=Zr((function(t,e){return "function"==typeof t?new Hn(this):this.map((function(n){return Or(n,t,e)}))})),Hn.prototype.reject=function(t){return this.filter(Ao(ca(t)))},Hn.prototype.slice=function(e,n){e=gu(e);var r=this;return r.__filtered__&&(e>0||n<0)?new Hn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(n=gu(n))<0?r.dropRight(-n):r.take(n-e)),r)},Hn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Hn.prototype.toArray=function(){return this.take(p)},br(Hn.prototype,(function(e,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),i=/^(?:head|last)$/.test(n),a=Fn[i?"take"+("last"==n?"Right":""):n],o=i||/^find/.test(n);a&&(Fn.prototype[n]=function(){var n=this.__wrapped__,u=i?[1]:arguments,s=n instanceof Hn,c=u[0],l=s||Ho(n),f=function(t){var e=a.apply(Fn,Ue([t],u));return i&&p?e[0]:e};l&&r&&"function"==typeof c&&1!=c.length&&(s=l=false);var p=this.__chain__,d=!!this.__actions__.length,h=o&&!p,g=s&&!d;if(!o&&l){n=g?n:new Hn(this);var v=e.apply(n,u);return v.__actions__.push({func:ho,args:[f],thisArg:t}),new qn(v,p)}return h&&g?e.apply(this,u):(v=this.thru(f),h?i?v.value()[0]:v.value():v)});})),Ee(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Ot[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Fn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Ho(i)?i:[],t)}return this[n]((function(n){return e.apply(Ho(n)?n:[],t)}))};})),br(Hn.prototype,(function(t,e){var n=Fn[e];if(n){var r=n.name+"";At.call(Tn,r)||(Tn[r]=[]),Tn[r].push({name:e,func:n});}})),Tn[Fi(t,2).name]=[{name:"wrapper",func:t}],Hn.prototype.clone=function(){var t=new Hn(this.__wrapped__);return t.__actions__=Ni(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ni(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ni(this.__views__),t},Hn.prototype.reverse=function(){if(this.__filtered__){var t=new Hn(this);t.__dir__=-1,t.__filtered__=true;}else (t=this.clone()).__dir__*=-1;return t},Hn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Ho(t),r=e<0,i=n?t.length:0,a=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var a=n[r],o=a.size;switch(a.type){case "drop":t+=o;break;case "dropRight":e-=o;break;case "take":e=wn(e,t+o);break;case "takeRight":t=_n(t,e-o);}}return {start:t,end:e}}(0,i,this.__views__),o=a.start,u=a.end,s=u-o,c=r?u:o-1,l=this.__iteratees__,f=l.length,p=0,d=wn(s,this.__takeCount__);if(!n||!r&&i==s&&d==s)return gi(t,this.__actions__);var h=[];t:for(;s--&&p<d;){for(var g=-1,v=t[c+=e];++g<f;){var y=l[g],m=y.iteratee,_=y.type,w=m(v);if(2==_)v=w;else if(!w){if(1==_)continue t;break t}}h[p++]=v;}return h},Fn.prototype.at=go,Fn.prototype.chain=function(){return po(this)},Fn.prototype.commit=function(){return new qn(this.value(),this.__chain__)},Fn.prototype.next=function(){this.__values__===t&&(this.__values__=du(this.value()));var e=this.__index__>=this.__values__.length;return {done:e,value:e?t:this.__values__[this.__index__++]}},Fn.prototype.plant=function(e){for(var n,r=this;r instanceof Ln;){var i=Ra(r);i.__index__=0,i.__values__=t,n?a.__wrapped__=i:n=i;var a=i;r=r.__wrapped__;}return a.__wrapped__=e,n},Fn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Hn){var n=e;return this.__actions__.length&&(n=new Hn(this)),(n=n.reverse()).__actions__.push({func:ho,args:[to],thisArg:t}),new qn(n,this.__chain__)}return this.thru(to)},Fn.prototype.toJSON=Fn.prototype.valueOf=Fn.prototype.value=function(){return gi(this.__wrapped__,this.__actions__)},Fn.prototype.first=Fn.prototype.head,re&&(Fn.prototype[re]=function(){return this}),Fn}();ve?((ve.exports=yn)._=yn,ge._=yn):he._=yn;}.call(ie.exports)),ie.exports);function se(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}(function(){function t(t,e){this.isCanvasRoot=true,this.DEBUG=false,this.onUpdateFunction=void 0,this.scheduledStateUpdates=[],this.scheduledUpdateIds=[],this.scheduledUpdateNodeMap={},this.currentUpdateId="",this.updateScheduled=false,this.updateRunning=false,this.taintedLayers=[],this.cameraNode=void 0,this.scheduledCameraNode=void 0,this.canvas=e,this.rootNode=t(this),this.rootNode.windowDidMountPrimitive(this.rootNode.props),this.rootNode.setAsPrimaryCamera();}return Object.defineProperty(t.prototype,"windows",{get:function(){var t=function(e){return a([e],i(e.children.flatMap(t)),false)};return ue.orderBy(t(this.rootNode),(function(t){return t.getLayer()}),"asc")},enumerable:false,configurable:true}),t.prototype.logWindows=function(){var t=function(e){var n=e._boxSnapshot,r=[];if(r.push("KEY: ".concat(e.key)),e._isPrimaryCamera&&r.push("[[PRIMARY CAMERA]]"),r.push("LAYER: ".concat(e.getLayer())),r.push("BOX: [".concat(e.o[0],", ").concat(e.o[1],", ").concat(e.w,", ").concat(e.h,"]")),r.push("GLOBAL O: [".concat(e.globalO[0],", ").concat(e.globalO[1],"]")),r.push("CHILDREN:"),e.children.length>0){for(var i=e.children,a=[],o=0;o<i.length;o++){var u=i[o];a.push(t(u));}r.push(" |");for(o=0;o<a.length;o++){for(var s=a[o],c=o===a.length-1?" ":" ",l=0;l<s.length;l++){var f=0===l?c:o===a.length-1?"   ":" | ",p=s[l];r.push("".concat(f,"  ").concat(p));}o<a.length-1&&r.push(" |");}}else r.push("  |"),r.push("   (no children)");return e._boxSnapshot=n,r};console.log(t(this.rootNode).join("\n"));},t.prototype.onUpdate=function(t){this.onUpdateFunction=t;},Object.defineProperty(t.prototype,"cameraSnapshot",{get:function(){return this.cameraNode?new Kt(this.cameraNode.globalO,this.cameraNode.w,this.cameraNode.h):new Kt([0,0],this.canvas.width,this.canvas.height)},enumerable:false,configurable:true}),t.prototype.scheduleStateUpdate=function(t,e){var n=this.scheduleUpdate(t);this.scheduledStateUpdates.push([n,function(){t.state=e;}]);},t.prototype.scheduleContextUpdate=function(t,e,n){var r=this.scheduleUpdate(t);this.scheduledStateUpdates.push([r,function(){t.context[e]=n;}]);},t.prototype.setSingleUpdateFlag=function(t,e){this.scheduledUpdateNodeMap[e]||(this.scheduledUpdateNodeMap[e]={}),this.scheduledUpdateNodeMap[e][t.globalKey]=true;},t.prototype.scheduleUpdate=function(t){var e=this,n=function(){e.DEBUG&&console.log("Scheduling update for ".concat(t.globalKey,". Received id ").concat(e.currentUpdateId));};if(!this.updateRunning&&!this.updateScheduled){this.updateScheduled=true;var r=se();return this.scheduledUpdateIds.push(r),this.currentUpdateId=r,Promise.resolve().then((function(){for(e.DEBUG&&console.log("Executing batched updates: Update Ids are ".concat(JSON.stringify(e.scheduledUpdateIds,null,2),".\n                    ")),e.updateRunning=true;e.scheduledUpdateIds.length>0;)e.updateScheduled=false,e.updateCurrentId();e.updateRunning=false;})),this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId}if(!this.updateRunning&&this.updateScheduled)return this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId;if(this.updateRunning&&!this.updateScheduled){this.updateScheduled=true;r=se();return this.scheduledUpdateIds.push(r),this.currentUpdateId=r,this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId}if(this.updateRunning&&this.updateScheduled)return this.setSingleUpdateFlag(t,this.currentUpdateId),n(),this.currentUpdateId;throw new Error("Invalid state")},t.prototype.onAnimationFrame=function(){try{this.render();}catch(t){console.error(t);}},t.prototype.propogateUpdateFlags=function(t){var e=this,n=function(t,r,i){e.scheduledUpdateNodeMap[r]||(e.scheduledUpdateNodeMap[r]={}),e.scheduledUpdateNodeMap[r][t.globalKey]&&(i=true),e.scheduledUpdateNodeMap[r][t.globalKey]=i,t.children.forEach((function(t){return n(t,r,i)}));};n(this.rootNode,t,false);},t.prototype.updateCurrentId=function(){var t=this,e=this.scheduledUpdateIds[0];Object.keys(this.scheduledUpdateNodeMap[e]).forEach((function(n){t.propogateUpdateFlags(e);})),this.DEBUG&&console.log("STARTING UPDATE: Update with id: ".concat(this.scheduledUpdateIds[0],". \nSTATE UPDATE STAGE. State updates are scheduled for ").concat(this.scheduledStateUpdates.map((function(t){return i(t,1)[0]})),".\n            ")),this.scheduledUpdateIds=this.scheduledUpdateIds.filter((function(t){return t!==e})),this.scheduledStateUpdates.filter((function(t){return i(t,1)[0]===e})).forEach((function(t){var e=i(t,2);return e[0],(0, e[1])()})),this.scheduledStateUpdates=this.scheduledStateUpdates.filter((function(t){return i(t,1)[0]!==e}));var n=this.scheduledUpdateNodeMap[e];this.update(n),delete this.scheduledUpdateNodeMap[e];},t.prototype.taintLayer=function(t){this.taintedLayers.includes(t)||this.taintedLayers.push(t);},t.prototype.findCameraPathRecursive=function(t,e){var r,i;if(t._isPrimaryCamera){var a=t.globalKey;return c=n(n({},e),((r={})[a]=true,r))}for(var o=t.children,u=0;u<o.length;u++){var s=o[u],c=(a=s.globalKey,n(n({},e),((i={})[a]=true,i))),l=this.findCameraPathRecursive(s,c);if(l)return l}},t.prototype.AND_updateMaps=function(t,e){var n={};for(var r in t)e[r]&&(n[r]=true);return n},t.prototype.XOR_updateMaps=function(t,e){var n={};for(var r in t)e[r]||(n[r]=true);for(var r in e)t[r]||(n[r]=true);return n},t.prototype.factorizeUpdateMap=function(t,e){var n=this.AND_updateMaps(t,e);return [n,this.XOR_updateMaps(t,n)]},t.prototype.setNeedsUpdateToMap=function(t){var e=function(n){var r=n.globalKey;t[r]?n._needsUpdate=true:n._needsUpdate=false,n.children.forEach((function(t){return e(t)}));};e(this.rootNode);},t.prototype.setNeedsUpdateToMapAdd=function(t){var e=function(n){var r=n.globalKey;t[r]&&(n._needsUpdate=true),n.children.forEach((function(t){return e(t)}));};e(this.rootNode);},t.prototype.installCamera=function(t){this.cameraNode!==t&&(this.scheduledCameraNode=t,this.scheduleUpdate(this.rootNode));},t.prototype.update=function(t){this.onUpdateFunction&&this.onUpdateFunction(),this.scheduledCameraNode&&(this.cameraNode&&(this.cameraNode._isPrimaryCamera=false),this.cameraNode=this.scheduledCameraNode,this.cameraNode._isPrimaryCamera=true,this.scheduledCameraNode=void 0);var e=this.findCameraPathRecursive(this.rootNode,{});if(!e)throw new Error("No camera found in the tree");var n=i(this.factorizeUpdateMap(t,e),2),r=n[0],a=n[1];this.DEBUG&&console.log("RENDER STAGE. Updates flags are set for: ".concat(JSON.stringify(Object.keys(t),null,2),".\nWill update in the two passes:\nFirst pass: ").concat(JSON.stringify(Object.keys(r),null,2),"\nSecond pass: ").concat(JSON.stringify(Object.keys(a),null,2),"\n            "));var o=function(t,e){t._needsUpdate?e?t.cameraPassUpdateSelf():t.regularPassUpdateSelf():t.children.forEach((function(t){return o(t,e)}));};this.setNeedsUpdateToMap(r),o(this.rootNode,true),this.setNeedsUpdateToMapAdd(a),o(this.rootNode,false),this.setNeedsUpdateToMap({}),this.DEBUG&&(console.log("RENDER STAGE COMPLETE. The new tree will be displayed below.\nDirty layers are ".concat(JSON.stringify(this.taintedLayers,null,2),".\n            ")),this.logWindows());},t.prototype.render=function(){var t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get 2d context from canvas");t.clearRect(0,0,this.canvas.width,this.canvas.height),Xt(this.cameraSnapshot,this.windows,this.canvas,t,this.taintedLayers),this.taintedLayers=[];},t.prototype.mouseDownHandler=function(t,e){Yt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseMoveHandler=function(t,e){Qt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseUpHandler=function(t,e){te(this.cameraSnapshot,this.windows,this.canvas,t,e);},t.prototype.mouseWheelHandler=function(t){ee(this.cameraSnapshot,this.windows,this.canvas,t);},t.prototype.clickHandler=function(t,e){Zt(this.cameraSnapshot,this.windows,this.canvas,t,e);},t})();function fe(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}var pe={type:"saveAsNamedState",namedState:"commit"},de={type:"goToNamedState",namedState:"commit"};function he(t,e,n,r,i,a,o){if(a&&!o){t.timelineData.numberOfFrames;o=[-5,0,5,0];}return {type:"addPin",signalId:e,pinId:n,pinTime:r,pinValue:i,functionString:a,bezierControlPoints:o}}function ge(t,e){var n=t(),r=Object.keys(n.signalData).find((function(t){var r;return null===(r=n.signalData[t])||void 0===r?void 0:r.pinIds.includes(e)}));if(!r)throw new Error("Pin not found");var i=n.signalData[r].type,a="continuous"===i&&"bezier"in n.signalData[r],o=n.signalData[r].pinTimes[e],u=n.signalData[r].pinValues[e],s="continuous"===i?n.signalData[r].curves[e]:void 0,c=a?n.signalData[r].bezierControlPoints[e]:void 0;return {type:"addNextState",forward:[{type:"deletePin",pinId:e}],backward:[he(n,r,e,o,u,s,c)]}}var ve=ut,ye=function(){function t(t){this.outgoingCommands=[],this.worm=s.deserialize(t.worm,ve),this.stateId=t.stateId,this.lastAgreedStateId=t.lastAgreedStateId,this.outgoingCommands=t.outgoingCommands;}return t.prototype.serialize=function(){return {worm:this.worm.serialize(),stateId:this.stateId,lastAgreedStateId:this.lastAgreedStateId,outgoingCommands:this.outgoingCommands}},t.prototype.pushOutgoingCommands=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];0===this.outgoingCommands.length&&(this.lastAgreedStateId=this.stateId,this.stateId=crypto.randomUUID()),(t=this.outgoingCommands).push.apply(t,a([],i(e),false));},t.prototype.transferOutgoingEvent=function(){var t={commands:this.outgoingCommands,lastAgreedStateId:this.lastAgreedStateId,stateId:this.stateId};return this.outgoingCommands=[],t},t.prototype.receiveIncomingEvent=function(t){if(t.lastAgreedStateId!==this.stateId)throw new Error("Trying to apply commands to a worm that is not in sync");this.worm.executeCommands(t.commands),this.stateId=t.stateId;},t}();(function(){function t(t){this.onPushUpdateCallbacks=[],this.dworm=new ye(t);}return t.fromProject=function(e){var n=new s(e,ve),r=crypto.randomUUID();return new t({worm:n.serialize(),stateId:r,lastAgreedStateId:r,outgoingCommands:[]})},t.fromSerializedWorm=function(e){return new t(e)},t.prototype.serialize=function(){return this.dworm.serialize()},t.prototype.receiveIncomingEvent=function(t){this.dworm.receiveIncomingEvent(t);},t.prototype.transferOutgoingEvent=function(){return this.dworm.transferOutgoingEvent()},t.prototype.getWorm=function(){return this.dworm.worm},t.prototype.pushCommand=function(t){try{var e=t();this.dworm.worm.executeCommand(e),this.dworm.pushOutgoingCommands(e);}catch(t){console.error(t);}},t.prototype.pushCommands=function(t){var e;try{var n=t();this.dworm.worm.executeCommands(n),(e=this.dworm).pushOutgoingCommands.apply(e,a([],i(n),!1));}catch(t){console.error(t);}},t.prototype.onPushUpdate=function(t){var e=this;return this.onPushUpdateCallbacks.push(t),function(){e.onPushUpdateCallbacks=e.onPushUpdateCallbacks.filter((function(e){return e!==t}));}},t.prototype.pushUpdate=function(){this.onPushUpdateCallbacks.forEach((function(t){return t()}));},Object.defineProperty(t.prototype,"projectTools",{get:function(){var t=this.pushUpdate.bind(this),e=this.getProject.bind(this),n=this.pushCommand.bind(this);this.pushCommands.bind(this);return function(t,e,n,r){function a(){e((function(){return de}));}function o(){e((function(){return pe}));}return {returnToLastCommit:function(){a();},pushUpdate:t,addPinContinuous:function(n,i,u,s,c,l){l&&a(),e((function(){var t=r(),e=t.signalData[n],a=e.pinTimes,o=e.pinIds.findIndex((function(t){return a[t]===u})),l=[];-1!==o&&l.push({type:"deletePin",pinId:e.pinIds[o]}),l.push(he(t,n,i,u,s,c));var f=[];if(f.push({type:"deletePin",pinId:i}),-1!==o){var p=e.pinIds[o];f.push(he(t,n,p,e.pinTimes[p],e.pinValues[p],e.curves[p]));}return {type:"addNextState",forward:l,backward:f}})),l&&(o(),t());},addPinDiscrete:function(n,i,u,s,c){c&&a(),e((function(){var t=r(),e=t.signalData[n],a=e.pinTimes,o=e.pinIds.findIndex((function(t){return a[t]===u})),c=[];-1!==o&&c.push({type:"deletePin",pinId:e.pinIds[o]}),c.push(he(t,n,i,u,s));var l=[];if(l.push({type:"deletePin",pinId:i}),-1!==o){var f=e.pinIds[o];l.push(he(t,n,f,e.pinTimes[f],e.pinValues[f]));}return {type:"addNextState",forward:c,backward:l}})),c&&(o(),t());},deletePin:function(n){a(),e((function(){return ge(r,n)})),o(),t();},deletePins:function(n){a(),n.forEach((function(t){e((function(){return ge(r,t)}));})),o(),t();},updatePins:function(n,i){i&&a();var u=r(),s={type:"updatePins",pins:[]},c={type:"updatePins",pins:[]};n.forEach((function(t){var e=t.pinId,n=u.orgData.signalIdByPinId[e],r=t.pinTime,i=t.pinValue,a="continuous"===t.pinType?t.functionString:void 0,o=u.signalData[n].pinTimes[e],l=u.signalData[n].pinValues[e],f="continuous"===t.pinType?u.signalData[n].curves[e]:void 0,p={pinId:e,pinTime:null!=r?r:o,pinValue:null!=i?i:l,functionString:null!=a?a:f},d={pinId:e,pinTime:o,pinValue:l,functionString:f};s.pins.push(p),c.pins.push(d);})),e((function(){return {type:"addNextState",forward:[s],backward:[c]}})),i&&o(),t();},updateCurve:function(n,i){a(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update curve of discrete signal");return {type:"addNextState",forward:[{type:"updateCurve",pinId:n,functionString:i}],backward:[{type:"updateCurve",pinId:n,functionString:t.signalData[e].curves[n]}]}})),o(),t();},updatePinBezierControlPoints:function(n,i,u){u&&a(),e((function(){var t=r(),e=Object.keys(t.signalData).find((function(e){var r;return null===(r=t.signalData[e])||void 0===r?void 0:r.pinIds.includes(n)}));if(!e)throw new Error("Pin not found");if("discrete"===t.signalData[e].type)throw new Error("Cannot update bezier control points of discrete signal");if(!("bezier"in t.signalData[e]))throw new Error("Signal is not a bezier signal");return {type:"addNextState",forward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:i}],backward:[{type:"updatePinBezierControlPoints",pinId:n,bezierControlPoints:t.signalData[e].bezierControlPoints[n]}]}})),u&&o(),t();},createDiscreteSignal:function(n,r,i,u){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:i,isStatic:u,displayValues:true}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createDiscreteBeatSignal:function(n,r){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"discrete",signalName:r,defaultValue:"beat"}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createContinuousSignal:function(n,r,i,u,s,c){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},createContinuousBezierSignal:function(n,r,i,u,s,c){a(),e((function(){return {type:"addNextState",forward:[{type:"createSignal",signalId:n,signalType:"continuous",signalName:r,range:i,defaultValue:u,defaultCurve:s,isStatic:c,bezier:true}],backward:[{type:"deleteSignal",signalId:n}]}})),o(),t();},duplicateSignal:function(n){a();var i=fe();e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");var a=t.orgData.signalNames[n],o=e.defaultValue,u="continuous"===e.type?e.defaultCurve:void 0,s=e.isStatic,c="continuous"===e.type&&"bezier"in e,l="discrete"===e.type?e.displayValues:void 0,f=a+"_copy",p="continuous"===e.type?e.range:void 0;return {type:"addNextState",forward:[{type:"createSignal",signalId:i,signalType:e.type,signalName:f,range:p,defaultValue:o,defaultCurve:u,isStatic:s,bezier:!!c||void 0,displayValues:!!l||void 0}],backward:[{type:"deleteSignal",signalId:i}]}})),e((function(){var t=r(),e=t.signalData[n].pinIds,a=t.signalData[n].type,o=e.map((function(e){var r,i=t.signalData[n].pinTimes[e],o=t.signalData[n].pinValues[e];return "continuous"===a&&(r=t.signalData[n].curves[e]),{pinTime:i,pinValue:o,functionString:r,pinId:fe()}}));return {type:"addNextState",forward:o.map((function(e){return he(t,i,e.pinId,e.pinTime,e.pinValue,e.functionString)})),backward:o.map((function(t){return {type:"deletePin",pinId:t.pinId}}))}})),o(),t();},deleteSignal:function(n){a(),e((function(){var t=r(),e=t.signalData[n];if(!e)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"deleteSignal",signalId:n}],backward:[{type:"createSignal",signalId:n,signalType:e.type,signalName:t.orgData.signalNames[n],range:"continuous"===e.type?e.range:void 0,defaultValue:e.defaultValue,defaultCurve:"continuous"===e.type?e.defaultCurve:void 0,isStatic:e.isStatic,bezier:"continuous"===e.type&&"bezier"in e||void 0,bezierControlPoints:"continuous"===e.type&&"bezier"in e?e.bezierControlPoints:void 0,displayValues:"discrete"===e.type?e.displayValues:void 0}]}})),o(),t();},updateSignalDefaultValue:function(n,i){a(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:i}],backward:[{type:"updateSignalDefaultValue",signalId:n,defaultValue:t.defaultValue}]}})),o(),t();},updateSignalName:function(n,i){a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalName",signalId:n,signalName:i}],backward:[{type:"updateSignalName",signalId:n,signalName:t.orgData.signalNames[n]}]}})),o(),t();},updateSignalRange:function(n,i){a(),e((function(){var t=r().signalData[n];if(!t)throw new Error("Signal not found");if("discrete"===t.type)throw new Error("Cannot update range of discrete signal");return {type:"addNextState",forward:[{type:"updateSignalRange",signalId:n,range:i}],backward:[{type:"updateSignalRange",signalId:n,range:t.range}]}})),o(),t();},updateSignalIndex:function(n,i,u){u&&a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalIndex",signalId:n,index:i}],backward:[{type:"updateSignalIndex",signalId:n,index:t.orgData.activeSignalIds.indexOf(n)}]}})),u&&o(),t();},updateSignalActiveStatus:function(n,i){a(),e((function(){var t=r();if(!t.signalData[n])throw new Error("Signal not found");return {type:"addNextState",forward:[{type:"updateSignalActiveStatus",signalId:n,active:i}],backward:[{type:"updateSignalActiveStatus",signalId:n,active:t.orgData.activeSignalIds.includes(n)}]}})),o(),t();},updateFramesPerSecond:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFramesPerSecond",framesPerSecond:n}],backward:[{type:"updateFramesPerSecond",framesPerSecond:t.timelineData.framesPerSecond}]}})),o(),t();},updatePlayheadPosition:function(n,i){i&&a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:t.timelineData.playheadPosition}]}})),i&&o(),t();},playNextFrame:function(n){var o=r(),u=o.timelineData.playheadPosition,s=i(o.timelineData.focusRange,2);s[0],s[1],a(),e((function(){return {type:"addNextState",forward:[{type:"updatePlaying",playing:true},{type:"updatePlayheadPosition",playheadPosition:n}],backward:[{type:"updatePlayheadPosition",playheadPosition:u},{type:"updatePlaying",playing:false}]}})),t();},updateFocusRange:function(n){var u=i(n,2),s=u[0],c=u[1];a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateFocusRange",focusRange:[s,c]}],backward:[{type:"updateFocusRange",focusRange:t.timelineData.focusRange}]}})),o(),t();},updateNumberOfFrames:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateNumberOfFrames",numberOfFrames:n}],backward:[{type:"updateNumberOfFrames",numberOfFrames:t.timelineData.numberOfFrames}]}})),o(),t();},updateProjectName:function(n){a(),e((function(){var t=r();return {type:"addNextState",forward:[{type:"updateProjectName",projectName:n}],backward:[{type:"updateProjectName",projectName:t.metaData.name}]}})),o(),t();},undo:function(){a(),e((function(){return {type:"previous"}})),o(),t();},redo:function(){a(),e((function(){return {type:"next"}})),o(),t();},addCurveTemplate:function(n,r){e((function(){return {type:"appendToCurrentState",forward:[{type:"addCurveTemplate",curveId:n,functionString:r}],backward:[{type:"deleteCurveTemplate",curveId:n}]}})),t();},deleteCurveTemplate:function(n){e((function(){return {type:"appendToCurrentState",forward:[{type:"deleteCurveTemplate",curveId:n}],backward:[{type:"addCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();},updateCurveTemplate:function(n,i){e((function(){return {type:"appendToCurrentState",forward:[{type:"updateCurveTemplate",curveId:n,functionString:i}],backward:[{type:"updateCurveTemplate",curveId:n,functionString:r().templateData[n]}]}})),t();}}}(t,n,0,e)},enumerable:false,configurable:true}),t.prototype.getProject=function(){return this.dworm.worm.content},t.prototype.prettyPrintProject=function(){console.log(JSON.stringify(this.getProject(),null,2));},t.prototype.interpolateSignalValueAtTime=function(t,e){var n=this.getProject();return Rt(n,t,e)},t})();

// class State {
//     controller: PinsAndCurvesProjectController.PinsAndCurvesProjectController;
//     constructor() {
//         const dispatch = (e: any) => this.send(e);
//         this.controller = getController(dispatch);
//     }
//     changeController(worm: any) {
//         const dispatch = (e: any) => this.send(e);
//         this.controller = getController(dispatch, worm);
//     }
//     send(payload: any) {
//         if (this.receiver_id === "") return;
//         if (payload.type === "hostIsConnected") return;
//         this.addToWorkload(this.subscribers[this.receiver_id], "projectNodeEvent", payload, this.receiver_id);
//     }
//     receiver_id: string = "";
//     channel : string = "ProjectState";
//     subscribers : { [instance_id: string]: any } = {};
//     subscribe(receiver : { instance_id: string, modality: string, resource_id: string }, subscriber_id: string) {
//         this.subscribers[subscriber_id] = receiver;
//         this.addToWorkload(receiver, "subscribeConfirmation", true, subscriber_id);
//     }
//     workload : { [thread: string]: any[]} = {};
//     addToWorkload(receiver : {
//         instance_id: string,
//         modality: string,
//         resource_id: string
//     }, request: string, messagePayload: any, subscriber_id: string) {
//         if (!this.workload["default"]) {
//             this.workload["default"] = [];
//         }
//         this.workload["default"].push(
//             {
//                 type: "worker",
//                 receiver,
//                 payload: {
//                     channel: "ProjectState",
//                     request: request,
//                     payload: messagePayload,
//                     subscriber_id,
//                 }
//             }
//         )
//     }
//     emit(payload: any) {
//         Object.keys(this.subscribers).forEach(subscriber_id => {
//             this.addToWorkload(this.subscribers[subscriber_id], "projectNodeEvent", payload, subscriber_id);
//         })
//     }
//     distribute(payload: any) {
//         this.emit(payload);
//         this.controller.receive(payload);
//     }
//     clearWorkload() {
//         this.workload = {};
//     }
// }
// const state = new State()
var client;
var pendingWorkload = {};
function addToWorkload(payload) {
    if (pendingWorkload.default === undefined) {
        pendingWorkload.default = [];
    }
    pendingWorkload.default.push({
        type: "worker",
        receiver: {
            instance_id: "BACKGROUND",
            modality: "wasmjs",
            resource_id: "http://localhost:8000/ProjectState"
        },
        payload: __assign(__assign({}, payload), { subscriber_id: "CopilotEval" }),
    });
}
function onCompute(string) {
    string = decodeURI(string);
    var unit = JSON.parse(string);
    var _a = unit.payload, INIT = _a.INIT, EVAL = _a.EVAL, timelineOperations = _a.timelineOperations, channel = _a.channel, request = _a.request, payload = _a.payload;
    if (channel === "ProjectState" && request === "projectNodeEvent") {
        client.receive(payload);
        return {};
    }
    if (EVAL) {
        if (client === undefined) {
            return false;
        }
        var projectTools = client.projectTools;
        var randomId = function () { return randomUUID().slice(0, 5); };
        randomId();
        if (projectTools === undefined) {
            return false;
        }
        var currentOperation = "";
        try {
            for (var i in timelineOperations) {
                var operation = timelineOperations[i];
                currentOperation = operation;
                eval(operation);
            }
        }
        catch (e) {
            log("Last operation: ".concat(currentOperation, ". Error in eval: ").concat(e));
        }
        var workload = pendingWorkload;
        pendingWorkload = {};
        return workload;
    }
    if (INIT) {
        var dispatch = function (e) { return addToWorkload({ channel: "ProjectState", request: "projectNodeEvent", payload: e }); };
        addToWorkload({ channel: "ProjectState", request: "subscribe", subscriber_id: "CopilotEval" });
        client = wt.PinsAndCurvesProjectController.Client(dispatch);
        client.connectToHost();
        var workload = pendingWorkload;
        pendingWorkload = {};
        return workload;
    }
    return {};
}
onCompute(decodeURI(JSON.stringify({
    payload: {
        channel: "SELF",
        request: "getProject",
        payload: {}
    }
})));
//# sourceMappingURL=index.js.map
